!function (e) { if ("object" == typeof exports && "undefined" != typeof module) module.exports = e(); else if ("function" == typeof define && define.amd) define([], e); else { ("undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : this).SimpleWebRTC = e() } }(function () { return function e(t, n, r) { function i(a, s) { if (!n[a]) { if (!t[a]) { var c = "function" == typeof require && require; if (!s && c) return c(a, !0); if (o) return o(a, !0); var d = new Error("Cannot find module '" + a + "'"); throw d.code = "MODULE_NOT_FOUND", d } var p = n[a] = { exports: {} }; t[a][0].call(p.exports, function (e) { var n = t[a][1][e]; return i(n || e) }, p, p.exports, e, t, n, r) } return n[a].exports } for (var o = "function" == typeof require && require, a = 0; a < r.length; a++)i(r[a]); return i }({ 1: [function (e, t, n) { function r() { } t.exports = function (e, t, n) { var i = !1; return n = n || r, o.count = e, 0 === e ? t() : o; function o(e, r) { if (o.count <= 0) throw new Error("after called too many times"); --o.count, e ? (i = !0, t(e), t = n) : 0 !== o.count || i || t(null, r) } } }, {}], 2: [function (e, t, n) { t.exports = function (e, t, n) { var r = e.byteLength; if (t = t || 0, n = n || r, e.slice) return e.slice(t, n); if (t < 0 && (t += r), n < 0 && (n += r), n > r && (n = r), t >= r || t >= n || 0 === r) return new ArrayBuffer(0); for (var i = new Uint8Array(e), o = new Uint8Array(n - t), a = t, s = 0; a < n; a++ , s++)o[s] = i[a]; return o.buffer } }, {}], 3: [function (e, t, n) { e("webrtc-adapter"); t.exports = function (e, t, n) { window.URL; var r, i = t, o = { autoplay: !0, mirror: !1, muted: !1, audio: !1, disableContextMenu: !1 }; if (n) for (r in n) o[r] = n[r]; return i ? "audio" === i.tagName.toLowerCase() && (o.audio = !0) : i = document.createElement(o.audio ? "audio" : "video"), o.disableContextMenu && (i.oncontextmenu = function (e) { e.preventDefault() }), o.autoplay && (i.autoplay = "autoplay"), o.muted && (i.muted = !0), !o.audio && o.mirror && ["", "moz", "webkit", "o", "ms"].forEach(function (e) { var t = e ? e + "Transform" : "transform"; i.style[t] = "scaleX(-1)" }), i.srcObject = e, i } }, { "webrtc-adapter": 90 }], 4: [function (e, t, n) { function r(e) { e = e || {}, this.ms = e.min || 100, this.max = e.max || 1e4, this.factor = e.factor || 2, this.jitter = e.jitter > 0 && e.jitter <= 1 ? e.jitter : 0, this.attempts = 0 } t.exports = r, r.prototype.duration = function () { var e = this.ms * Math.pow(this.factor, this.attempts++); if (this.jitter) { var t = Math.random(), n = Math.floor(t * this.jitter * e); e = 0 == (1 & Math.floor(10 * t)) ? e - n : e + n } return 0 | Math.min(e, this.max) }, r.prototype.reset = function () { this.attempts = 0 }, r.prototype.setMin = function (e) { this.ms = e }, r.prototype.setMax = function (e) { this.max = e }, r.prototype.setJitter = function (e) { this.jitter = e } }, {}], 5: [function (e, t, n) { !function (e) { "use strict"; n.encode = function (t) { var n, r = new Uint8Array(t), i = r.length, o = ""; for (n = 0; n < i; n += 3)o += e[r[n] >> 2], o += e[(3 & r[n]) << 4 | r[n + 1] >> 4], o += e[(15 & r[n + 1]) << 2 | r[n + 2] >> 6], o += e[63 & r[n + 2]]; return i % 3 == 2 ? o = o.substring(0, o.length - 1) + "=" : i % 3 == 1 && (o = o.substring(0, o.length - 2) + "=="), o }, n.decode = function (t) { var n, r, i, o, a, s = .75 * t.length, c = t.length, d = 0; "=" === t[t.length - 1] && (s-- , "=" === t[t.length - 2] && s--); var p = new ArrayBuffer(s), u = new Uint8Array(p); for (n = 0; n < c; n += 4)r = e.indexOf(t[n]), i = e.indexOf(t[n + 1]), o = e.indexOf(t[n + 2]), a = e.indexOf(t[n + 3]), u[d++] = r << 2 | i >> 4, u[d++] = (15 & i) << 4 | o >> 2, u[d++] = (3 & o) << 6 | 63 & a; return p } }("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/") }, {}], 6: [function (e, t, n) { (function (e) { var n = e.BlobBuilder || e.WebKitBlobBuilder || e.MSBlobBuilder || e.MozBlobBuilder, r = function () { try { return 2 === new Blob(["hi"]).size } catch (e) { return !1 } }(), i = r && function () { try { return 2 === new Blob([new Uint8Array([1, 2])]).size } catch (e) { return !1 } }(), o = n && n.prototype.append && n.prototype.getBlob; function a(e) { for (var t = 0; t < e.length; t++) { var n = e[t]; if (n.buffer instanceof ArrayBuffer) { var r = n.buffer; if (n.byteLength !== r.byteLength) { var i = new Uint8Array(n.byteLength); i.set(new Uint8Array(r, n.byteOffset, n.byteLength)), r = i.buffer } e[t] = r } } } function s(e, t) { t = t || {}; var r = new n; a(e); for (var i = 0; i < e.length; i++)r.append(e[i]); return t.type ? r.getBlob(t.type) : r.getBlob() } function c(e, t) { return a(e), new Blob(e, t || {}) } t.exports = r ? i ? e.Blob : c : o ? s : void 0 }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, {}], 7: [function (e, t, n) { var r = [].slice; t.exports = function (e, t) { if ("string" == typeof t && (t = e[t]), "function" != typeof t) throw new Error("bind() requires a function"); var n = r.call(arguments, 2); return function () { return t.apply(e, n.concat(r.call(arguments))) } } }, {}], 8: [function (e, t, n) { function r(e) { if (e) return function (e) { for (var t in r.prototype) e[t] = r.prototype[t]; return e }(e) } t.exports = r, r.prototype.on = r.prototype.addEventListener = function (e, t) { return this._callbacks = this._callbacks || {}, (this._callbacks[e] = this._callbacks[e] || []).push(t), this }, r.prototype.once = function (e, t) { var n = this; function r() { n.off(e, r), t.apply(this, arguments) } return this._callbacks = this._callbacks || {}, r.fn = t, this.on(e, r), this }, r.prototype.off = r.prototype.removeListener = r.prototype.removeAllListeners = r.prototype.removeEventListener = function (e, t) { if (this._callbacks = this._callbacks || {}, 0 == arguments.length) return this._callbacks = {}, this; var n, r = this._callbacks[e]; if (!r) return this; if (1 == arguments.length) return delete this._callbacks[e], this; for (var i = 0; i < r.length; i++)if ((n = r[i]) === t || n.fn === t) { r.splice(i, 1); break } return this }, r.prototype.emit = function (e) { this._callbacks = this._callbacks || {}; var t = [].slice.call(arguments, 1), n = this._callbacks[e]; if (n) for (var r = 0, i = (n = n.slice(0)).length; r < i; ++r)n[r].apply(this, t); return this }, r.prototype.listeners = function (e) { return this._callbacks = this._callbacks || {}, this._callbacks[e] || [] }, r.prototype.hasListeners = function (e) { return !!this.listeners(e).length } }, {}], 9: [function (e, t, n) { t.exports = function (e, t) { var n = function () { }; n.prototype = t.prototype, e.prototype = new n, e.prototype.constructor = e } }, {}], 10: [function (e, t, n) { t.exports = e("./lib/") }, { "./lib/": 11 }], 11: [function (e, t, n) { t.exports = e("./socket"), t.exports.parser = e("engine.io-parser") }, { "./socket": 12, "engine.io-parser": 24 }], 12: [function (e, t, n) { (function (n) { var r = e("./transports"), i = e("component-emitter"), o = e("debug")("engine.io-client:socket"), a = e("indexof"), s = e("engine.io-parser"), c = e("parseuri"), d = e("parsejson"), p = e("parseqs"); function u(e, t) { if (!(this instanceof u)) return new u(e, t); if (t = t || {}, e && "object" == typeof e && (t = e, e = null), e && (e = c(e), t.host = e.host, t.secure = "https" == e.protocol || "wss" == e.protocol, t.port = e.port, e.query && (t.query = e.query)), this.secure = null != t.secure ? t.secure : n.location && "https:" == location.protocol, t.host) { var r = t.host.split(":"); t.hostname = r.shift(), r.length ? t.port = r.pop() : t.port || (t.port = this.secure ? "443" : "80") } this.agent = t.agent || !1, this.hostname = t.hostname || (n.location ? location.hostname : "localhost"), this.port = t.port || (n.location && location.port ? location.port : this.secure ? 443 : 80), this.query = t.query || {}, "string" == typeof this.query && (this.query = p.decode(this.query)), this.upgrade = !1 !== t.upgrade, this.path = (t.path || "/engine.io").replace(/\/$/, "") + "/", this.forceJSONP = !!t.forceJSONP, this.jsonp = !1 !== t.jsonp, this.forceBase64 = !!t.forceBase64, this.enablesXDR = !!t.enablesXDR, this.timestampParam = t.timestampParam || "t", this.timestampRequests = t.timestampRequests, this.transports = t.transports || ["polling", "websocket"], this.readyState = "", this.writeBuffer = [], this.callbackBuffer = [], this.policyPort = t.policyPort || 843, this.rememberUpgrade = t.rememberUpgrade || !1, this.binaryType = null, this.onlyBinaryUpgrades = t.onlyBinaryUpgrades, this.pfx = t.pfx || null, this.key = t.key || null, this.passphrase = t.passphrase || null, this.cert = t.cert || null, this.ca = t.ca || null, this.ciphers = t.ciphers || null, this.rejectUnauthorized = t.rejectUnauthorized || null, this.open() } t.exports = u, u.priorWebsocketSuccess = !1, i(u.prototype), u.protocol = s.protocol, u.Socket = u, u.Transport = e("./transport"), u.transports = e("./transports"), u.parser = e("engine.io-parser"), u.prototype.createTransport = function (e) { o('creating transport "%s"', e); var t = function (e) { var t = {}; for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]); return t }(this.query); return t.EIO = s.protocol, t.transport = e, this.id && (t.sid = this.id), new r[e]({ agent: this.agent, hostname: this.hostname, port: this.port, secure: this.secure, path: this.path, query: t, forceJSONP: this.forceJSONP, jsonp: this.jsonp, forceBase64: this.forceBase64, enablesXDR: this.enablesXDR, timestampRequests: this.timestampRequests, timestampParam: this.timestampParam, policyPort: this.policyPort, socket: this, pfx: this.pfx, key: this.key, passphrase: this.passphrase, cert: this.cert, ca: this.ca, ciphers: this.ciphers, rejectUnauthorized: this.rejectUnauthorized }) }, u.prototype.open = function () { var e; if (this.rememberUpgrade && u.priorWebsocketSuccess && -1 != this.transports.indexOf("websocket")) e = "websocket"; else { if (0 == this.transports.length) { var t = this; return void setTimeout(function () { t.emit("error", "No transports available") }, 0) } e = this.transports[0] } this.readyState = "opening"; try { e = this.createTransport(e) } catch (e) { return this.transports.shift(), void this.open() } e.open(), this.setTransport(e) }, u.prototype.setTransport = function (e) { o("setting transport %s", e.name); var t = this; this.transport && (o("clearing existing transport %s", this.transport.name), this.transport.removeAllListeners()), this.transport = e, e.on("drain", function () { t.onDrain() }).on("packet", function (e) { t.onPacket(e) }).on("error", function (e) { t.onError(e) }).on("close", function () { t.onClose("transport close") }) }, u.prototype.probe = function (e) { o('probing transport "%s"', e); var t = this.createTransport(e, { probe: 1 }), n = !1, r = this; function i() { if (r.onlyBinaryUpgrades) { var i = !this.supportsBinary && r.transport.supportsBinary; n = n || i } n || (o('probe transport "%s" opened', e), t.send([{ type: "ping", data: "probe" }]), t.once("packet", function (i) { if (!n) if ("pong" == i.type && "probe" == i.data) { if (o('probe transport "%s" pong', e), r.upgrading = !0, r.emit("upgrading", t), !t) return; u.priorWebsocketSuccess = "websocket" == t.name, o('pausing current transport "%s"', r.transport.name), r.transport.pause(function () { n || "closed" != r.readyState && (o("changing transport and sending upgrade packet"), l(), r.setTransport(t), t.send([{ type: "upgrade" }]), r.emit("upgrade", t), t = null, r.upgrading = !1, r.flush()) }) } else { o('probe transport "%s" failed', e); var a = new Error("probe error"); a.transport = t.name, r.emit("upgradeError", a) } })) } function a() { n || (n = !0, l(), t.close(), t = null) } function s(n) { var i = new Error("probe error: " + n); i.transport = t.name, a(), o('probe transport "%s" failed because of error: %s', e, n), r.emit("upgradeError", i) } function c() { s("transport closed") } function d() { s("socket closed") } function p(e) { t && e.name != t.name && (o('"%s" works - aborting "%s"', e.name, t.name), a()) } function l() { t.removeListener("open", i), t.removeListener("error", s), t.removeListener("close", c), r.removeListener("close", d), r.removeListener("upgrading", p) } u.priorWebsocketSuccess = !1, t.once("open", i), t.once("error", s), t.once("close", c), this.once("close", d), this.once("upgrading", p), t.open() }, u.prototype.onOpen = function () { if (o("socket open"), this.readyState = "open", u.priorWebsocketSuccess = "websocket" == this.transport.name, this.emit("open"), this.flush(), "open" == this.readyState && this.upgrade && this.transport.pause) { o("starting upgrade probes"); for (var e = 0, t = this.upgrades.length; e < t; e++)this.probe(this.upgrades[e]) } }, u.prototype.onPacket = function (e) { if ("opening" == this.readyState || "open" == this.readyState) switch (o('socket receive: type "%s", data "%s"', e.type, e.data), this.emit("packet", e), this.emit("heartbeat"), e.type) { case "open": this.onHandshake(d(e.data)); break; case "pong": this.setPing(); break; case "error": var t = new Error("server error"); t.code = e.data, this.emit("error", t); break; case "message": this.emit("data", e.data), this.emit("message", e.data) } else o('packet received with socket readyState "%s"', this.readyState) }, u.prototype.onHandshake = function (e) { this.emit("handshake", e), this.id = e.sid, this.transport.query.sid = e.sid, this.upgrades = this.filterUpgrades(e.upgrades), this.pingInterval = e.pingInterval, this.pingTimeout = e.pingTimeout, this.onOpen(), "closed" != this.readyState && (this.setPing(), this.removeListener("heartbeat", this.onHeartbeat), this.on("heartbeat", this.onHeartbeat)) }, u.prototype.onHeartbeat = function (e) { clearTimeout(this.pingTimeoutTimer); var t = this; t.pingTimeoutTimer = setTimeout(function () { "closed" != t.readyState && t.onClose("ping timeout") }, e || t.pingInterval + t.pingTimeout) }, u.prototype.setPing = function () { var e = this; clearTimeout(e.pingIntervalTimer), e.pingIntervalTimer = setTimeout(function () { o("writing ping packet - expecting pong within %sms", e.pingTimeout), e.ping(), e.onHeartbeat(e.pingTimeout) }, e.pingInterval) }, u.prototype.ping = function () { this.sendPacket("ping") }, u.prototype.onDrain = function () { for (var e = 0; e < this.prevBufferLen; e++)this.callbackBuffer[e] && this.callbackBuffer[e](); this.writeBuffer.splice(0, this.prevBufferLen), this.callbackBuffer.splice(0, this.prevBufferLen), this.prevBufferLen = 0, 0 == this.writeBuffer.length ? this.emit("drain") : this.flush() }, u.prototype.flush = function () { "closed" != this.readyState && this.transport.writable && !this.upgrading && this.writeBuffer.length && (o("flushing %d packets in socket", this.writeBuffer.length), this.transport.send(this.writeBuffer), this.prevBufferLen = this.writeBuffer.length, this.emit("flush")) }, u.prototype.write = u.prototype.send = function (e, t) { return this.sendPacket("message", e, t), this }, u.prototype.sendPacket = function (e, t, n) { if ("closing" != this.readyState && "closed" != this.readyState) { var r = { type: e, data: t }; this.emit("packetCreate", r), this.writeBuffer.push(r), this.callbackBuffer.push(n), this.flush() } }, u.prototype.close = function () { if ("opening" == this.readyState || "open" == this.readyState) { this.readyState = "closing"; var e = this; function t() { e.onClose("forced close"), o("socket closing - telling transport to close"), e.transport.close() } function n() { e.removeListener("upgrade", n), e.removeListener("upgradeError", n), t() } function r() { e.once("upgrade", n), e.once("upgradeError", n) } this.writeBuffer.length ? this.once("drain", function () { this.upgrading ? r() : t() }) : this.upgrading ? r() : t() } return this }, u.prototype.onError = function (e) { o("socket error %j", e), u.priorWebsocketSuccess = !1, this.emit("error", e), this.onClose("transport error", e) }, u.prototype.onClose = function (e, t) { if ("opening" == this.readyState || "open" == this.readyState || "closing" == this.readyState) { o('socket close with reason: "%s"', e); var n = this; clearTimeout(this.pingIntervalTimer), clearTimeout(this.pingTimeoutTimer), setTimeout(function () { n.writeBuffer = [], n.callbackBuffer = [], n.prevBufferLen = 0 }, 0), this.transport.removeAllListeners("close"), this.transport.close(), this.transport.removeAllListeners(), this.readyState = "closed", this.id = null, this.emit("close", e, t) } }, u.prototype.filterUpgrades = function (e) { for (var t = [], n = 0, r = e.length; n < r; n++)~a(this.transports, e[n]) && t.push(e[n]); return t } }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, { "./transport": 13, "./transports": 14, "component-emitter": 8, debug: 20, "engine.io-parser": 24, indexof: 44, parsejson: 52, parseqs: 53, parseuri: 23 }], 13: [function (e, t, n) { var r = e("engine.io-parser"), i = e("component-emitter"); function o(e) { this.path = e.path, this.hostname = e.hostname, this.port = e.port, this.secure = e.secure, this.query = e.query, this.timestampParam = e.timestampParam, this.timestampRequests = e.timestampRequests, this.readyState = "", this.agent = e.agent || !1, this.socket = e.socket, this.enablesXDR = e.enablesXDR, this.pfx = e.pfx, this.key = e.key, this.passphrase = e.passphrase, this.cert = e.cert, this.ca = e.ca, this.ciphers = e.ciphers, this.rejectUnauthorized = e.rejectUnauthorized } t.exports = o, i(o.prototype), o.timestamps = 0, o.prototype.onError = function (e, t) { var n = new Error(e); return n.type = "TransportError", n.description = t, this.emit("error", n), this }, o.prototype.open = function () { return "closed" != this.readyState && "" != this.readyState || (this.readyState = "opening", this.doOpen()), this }, o.prototype.close = function () { return "opening" != this.readyState && "open" != this.readyState || (this.doClose(), this.onClose()), this }, o.prototype.send = function (e) { if ("open" != this.readyState) throw new Error("Transport not open"); this.write(e) }, o.prototype.onOpen = function () { this.readyState = "open", this.writable = !0, this.emit("open") }, o.prototype.onData = function (e) { var t = r.decodePacket(e, this.socket.binaryType); this.onPacket(t) }, o.prototype.onPacket = function (e) { this.emit("packet", e) }, o.prototype.onClose = function () { this.readyState = "closed", this.emit("close") } }, { "component-emitter": 8, "engine.io-parser": 24 }], 14: [function (e, t, n) { (function (t) { var r = e("xmlhttprequest"), i = e("./polling-xhr"), o = e("./polling-jsonp"), a = e("./websocket"); n.polling = function (e) { var n = !1, a = !1, s = !1 !== e.jsonp; if (t.location) { var c = "https:" == location.protocol, d = location.port; d || (d = c ? 443 : 80), n = e.hostname != location.hostname || d != e.port, a = e.secure != c } { if (e.xdomain = n, e.xscheme = a, "open" in new r(e) && !e.forceJSONP) return new i(e); if (!s) throw new Error("JSONP disabled"); return new o(e) } }, n.websocket = a }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, { "./polling-jsonp": 15, "./polling-xhr": 16, "./websocket": 18, xmlhttprequest: 19 }], 15: [function (e, t, n) { (function (n) { var r = e("./polling"), i = e("component-inherit"); t.exports = d; var o, a = /\n/g, s = /\\n/g; function c() { } function d(e) { r.call(this, e), this.query = this.query || {}, o || (n.___eio || (n.___eio = []), o = n.___eio), this.index = o.length; var t = this; o.push(function (e) { t.onData(e) }), this.query.j = this.index, n.document && n.addEventListener && n.addEventListener("beforeunload", function () { t.script && (t.script.onerror = c) }, !1) } i(d, r), d.prototype.supportsBinary = !1, d.prototype.doClose = function () { this.script && (this.script.parentNode.removeChild(this.script), this.script = null), this.form && (this.form.parentNode.removeChild(this.form), this.form = null, this.iframe = null), r.prototype.doClose.call(this) }, d.prototype.doPoll = function () { var e = this, t = document.createElement("script"); this.script && (this.script.parentNode.removeChild(this.script), this.script = null), t.async = !0, t.src = this.uri(), t.onerror = function (t) { e.onError("jsonp poll error", t) }; var n = document.getElementsByTagName("script")[0]; n.parentNode.insertBefore(t, n), this.script = t, "undefined" != typeof navigator && /gecko/i.test(navigator.userAgent) && setTimeout(function () { var e = document.createElement("iframe"); document.body.appendChild(e), document.body.removeChild(e) }, 100) }, d.prototype.doWrite = function (e, t) { var n = this; if (!this.form) { var r, i = document.createElement("form"), o = document.createElement("textarea"), c = this.iframeId = "eio_iframe_" + this.index; i.className = "socketio", i.style.position = "absolute", i.style.top = "-1000px", i.style.left = "-1000px", i.target = c, i.method = "POST", i.setAttribute("accept-charset", "utf-8"), o.name = "d", i.appendChild(o), document.body.appendChild(i), this.form = i, this.area = o } function d() { p(), t() } function p() { if (n.iframe) try { n.form.removeChild(n.iframe) } catch (e) { n.onError("jsonp polling iframe removal error", e) } try { var e = '<iframe src="javascript:0" name="' + n.iframeId + '">'; r = document.createElement(e) } catch (e) { (r = document.createElement("iframe")).name = n.iframeId, r.src = "javascript:0" } r.id = n.iframeId, n.form.appendChild(r), n.iframe = r } this.form.action = this.uri(), p(), e = e.replace(s, "\\\n"), this.area.value = e.replace(a, "\\n"); try { this.form.submit() } catch (e) { } this.iframe.attachEvent ? this.iframe.onreadystatechange = function () { "complete" == n.iframe.readyState && d() } : this.iframe.onload = d } }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, { "./polling": 17, "component-inherit": 9 }], 16: [function (e, t, n) { (function (n) { var r = e("xmlhttprequest"), i = e("./polling"), o = e("component-emitter"), a = e("component-inherit"), s = e("debug")("engine.io-client:polling-xhr"); function c() { } function d(e) { if (i.call(this, e), n.location) { var t = "https:" == location.protocol, r = location.port; r || (r = t ? 443 : 80), this.xd = e.hostname != n.location.hostname || r != e.port, this.xs = e.secure != t } } function p(e) { this.method = e.method || "GET", this.uri = e.uri, this.xd = !!e.xd, this.xs = !!e.xs, this.async = !1 !== e.async, this.data = void 0 != e.data ? e.data : null, this.agent = e.agent, this.isBinary = e.isBinary, this.supportsBinary = e.supportsBinary, this.enablesXDR = e.enablesXDR, this.pfx = e.pfx, this.key = e.key, this.passphrase = e.passphrase, this.cert = e.cert, this.ca = e.ca, this.ciphers = e.ciphers, this.rejectUnauthorized = e.rejectUnauthorized, this.create() } function u() { for (var e in p.requests) p.requests.hasOwnProperty(e) && p.requests[e].abort() } t.exports = d, t.exports.Request = p, a(d, i), d.prototype.supportsBinary = !0, d.prototype.request = function (e) { return (e = e || {}).uri = this.uri(), e.xd = this.xd, e.xs = this.xs, e.agent = this.agent || !1, e.supportsBinary = this.supportsBinary, e.enablesXDR = this.enablesXDR, e.pfx = this.pfx, e.key = this.key, e.passphrase = this.passphrase, e.cert = this.cert, e.ca = this.ca, e.ciphers = this.ciphers, e.rejectUnauthorized = this.rejectUnauthorized, new p(e) }, d.prototype.doWrite = function (e, t) { var n = "string" != typeof e && void 0 !== e, r = this.request({ method: "POST", data: e, isBinary: n }), i = this; r.on("success", t), r.on("error", function (e) { i.onError("xhr post error", e) }), this.sendXhr = r }, d.prototype.doPoll = function () { s("xhr poll"); var e = this.request(), t = this; e.on("data", function (e) { t.onData(e) }), e.on("error", function (e) { t.onError("xhr poll error", e) }), this.pollXhr = e }, o(p.prototype), p.prototype.create = function () { var e = { agent: this.agent, xdomain: this.xd, xscheme: this.xs, enablesXDR: this.enablesXDR }; e.pfx = this.pfx, e.key = this.key, e.passphrase = this.passphrase, e.cert = this.cert, e.ca = this.ca, e.ciphers = this.ciphers, e.rejectUnauthorized = this.rejectUnauthorized; var t = this.xhr = new r(e), i = this; try { if (s("xhr open %s: %s", this.method, this.uri), t.open(this.method, this.uri, this.async), this.supportsBinary && (t.responseType = "arraybuffer"), "POST" == this.method) try { this.isBinary ? t.setRequestHeader("Content-type", "application/octet-stream") : t.setRequestHeader("Content-type", "text/plain;charset=UTF-8") } catch (e) { } "withCredentials" in t && (t.withCredentials = !0), this.hasXDR() ? (t.onload = function () { i.onLoad() }, t.onerror = function () { i.onError(t.responseText) }) : t.onreadystatechange = function () { 4 == t.readyState && (200 == t.status || 1223 == t.status ? i.onLoad() : setTimeout(function () { i.onError(t.status) }, 0)) }, s("xhr data %s", this.data), t.send(this.data) } catch (e) { return void setTimeout(function () { i.onError(e) }, 0) } n.document && (this.index = p.requestsCount++ , p.requests[this.index] = this) }, p.prototype.onSuccess = function () { this.emit("success"), this.cleanup() }, p.prototype.onData = function (e) { this.emit("data", e), this.onSuccess() }, p.prototype.onError = function (e) { this.emit("error", e), this.cleanup(!0) }, p.prototype.cleanup = function (e) { if (void 0 !== this.xhr && null !== this.xhr) { if (this.hasXDR() ? this.xhr.onload = this.xhr.onerror = c : this.xhr.onreadystatechange = c, e) try { this.xhr.abort() } catch (e) { } n.document && delete p.requests[this.index], this.xhr = null } }, p.prototype.onLoad = function () { var e; try { var t; try { t = this.xhr.getResponseHeader("Content-Type").split(";")[0] } catch (e) { } e = "application/octet-stream" === t ? this.xhr.response : this.supportsBinary ? "ok" : this.xhr.responseText } catch (e) { this.onError(e) } null != e && this.onData(e) }, p.prototype.hasXDR = function () { return void 0 !== n.XDomainRequest && !this.xs && this.enablesXDR }, p.prototype.abort = function () { this.cleanup() }, n.document && (p.requestsCount = 0, p.requests = {}, n.attachEvent ? n.attachEvent("onunload", u) : n.addEventListener && n.addEventListener("beforeunload", u, !1)) }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, { "./polling": 17, "component-emitter": 8, "component-inherit": 9, debug: 20, xmlhttprequest: 19 }], 17: [function (e, t, n) { var r = e("../transport"), i = e("parseqs"), o = e("engine.io-parser"), a = e("component-inherit"), s = e("debug")("engine.io-client:polling"); t.exports = d; var c = null != new (e("xmlhttprequest"))({ xdomain: !1 }).responseType; function d(e) { var t = e && e.forceBase64; c && !t || (this.supportsBinary = !1), r.call(this, e) } a(d, r), d.prototype.name = "polling", d.prototype.doOpen = function () { this.poll() }, d.prototype.pause = function (e) { var t = this; function n() { s("paused"), t.readyState = "paused", e() } if (this.readyState = "pausing", this.polling || !this.writable) { var r = 0; this.polling && (s("we are currently polling - waiting to pause"), r++ , this.once("pollComplete", function () { s("pre-pause polling complete"), --r || n() })), this.writable || (s("we are currently writing - waiting to pause"), r++ , this.once("drain", function () { s("pre-pause writing complete"), --r || n() })) } else n() }, d.prototype.poll = function () { s("polling"), this.polling = !0, this.doPoll(), this.emit("poll") }, d.prototype.onData = function (e) { var t = this; s("polling got data %s", e); o.decodePayload(e, this.socket.binaryType, function (e, n, r) { if ("opening" == t.readyState && t.onOpen(), "close" == e.type) return t.onClose(), !1; t.onPacket(e) }), "closed" != this.readyState && (this.polling = !1, this.emit("pollComplete"), "open" == this.readyState ? this.poll() : s('ignoring poll - transport state "%s"', this.readyState)) }, d.prototype.doClose = function () { var e = this; function t() { s("writing close packet"), e.write([{ type: "close" }]) } "open" == this.readyState ? (s("transport open - closing"), t()) : (s("transport not open - deferring close"), this.once("open", t)) }, d.prototype.write = function (e) { var t = this; this.writable = !1; var n = function () { t.writable = !0, t.emit("drain") }; t = this; o.encodePayload(e, this.supportsBinary, function (e) { t.doWrite(e, n) }) }, d.prototype.uri = function () { var e = this.query || {}, t = this.secure ? "https" : "http", n = ""; return !1 !== this.timestampRequests && (e[this.timestampParam] = +new Date + "-" + r.timestamps++), this.supportsBinary || e.sid || (e.b64 = 1), e = i.encode(e), this.port && ("https" == t && 443 != this.port || "http" == t && 80 != this.port) && (n = ":" + this.port), e.length && (e = "?" + e), t + "://" + this.hostname + n + this.path + e } }, { "../transport": 13, "component-inherit": 9, debug: 20, "engine.io-parser": 24, parseqs: 53, xmlhttprequest: 19 }], 18: [function (e, t, n) { var r = e("../transport"), i = e("engine.io-parser"), o = e("parseqs"), a = e("component-inherit"), s = e("debug")("engine.io-client:websocket"), c = e("ws"); function d(e) { e && e.forceBase64 && (this.supportsBinary = !1), r.call(this, e) } t.exports = d, a(d, r), d.prototype.name = "websocket", d.prototype.supportsBinary = !0, d.prototype.doOpen = function () { if (this.check()) { var e = this.uri(), t = { agent: this.agent }; t.pfx = this.pfx, t.key = this.key, t.passphrase = this.passphrase, t.cert = this.cert, t.ca = this.ca, t.ciphers = this.ciphers, t.rejectUnauthorized = this.rejectUnauthorized, this.ws = new c(e, void 0, t), void 0 === this.ws.binaryType && (this.supportsBinary = !1), this.ws.binaryType = "arraybuffer", this.addEventListeners() } }, d.prototype.addEventListeners = function () { var e = this; this.ws.onopen = function () { e.onOpen() }, this.ws.onclose = function () { e.onClose() }, this.ws.onmessage = function (t) { e.onData(t.data) }, this.ws.onerror = function (t) { e.onError("websocket error", t) } }, "undefined" != typeof navigator && /iPad|iPhone|iPod/i.test(navigator.userAgent) && (d.prototype.onData = function (e) { var t = this; setTimeout(function () { r.prototype.onData.call(t, e) }, 0) }), d.prototype.write = function (e) { var t = this; this.writable = !1; for (var n = 0, r = e.length; n < r; n++)i.encodePacket(e[n], this.supportsBinary, function (e) { try { t.ws.send(e) } catch (e) { s("websocket closed before onclose event") } }); setTimeout(function () { t.writable = !0, t.emit("drain") }, 0) }, d.prototype.onClose = function () { r.prototype.onClose.call(this) }, d.prototype.doClose = function () { void 0 !== this.ws && this.ws.close() }, d.prototype.uri = function () { var e = this.query || {}, t = this.secure ? "wss" : "ws", n = ""; return this.port && ("wss" == t && 443 != this.port || "ws" == t && 80 != this.port) && (n = ":" + this.port), this.timestampRequests && (e[this.timestampParam] = +new Date), this.supportsBinary || (e.b64 = 1), (e = o.encode(e)).length && (e = "?" + e), t + "://" + this.hostname + n + this.path + e }, d.prototype.check = function () { return !(!c || "__initialize" in c && this.name === d.prototype.name) } }, { "../transport": 13, "component-inherit": 9, debug: 20, "engine.io-parser": 24, parseqs: 53, ws: 101 }], 19: [function (e, t, n) { var r = e("has-cors"); t.exports = function (e) { var t = e.xdomain, n = e.xscheme, i = e.enablesXDR; try { if ("undefined" != typeof XMLHttpRequest && (!t || r)) return new XMLHttpRequest } catch (e) { } try { if ("undefined" != typeof XDomainRequest && !n && i) return new XDomainRequest } catch (e) { } if (!t) try { return new ActiveXObject("Microsoft.XMLHTTP") } catch (e) { } } }, { "has-cors": 43 }], 20: [function (e, t, n) { function r() { var e; try { e = localStorage.debug } catch (e) { } return e } (n = t.exports = e("./debug")).log = function () { return "object" == typeof console && "function" == typeof console.log && Function.prototype.apply.call(console.log, console, arguments) }, n.formatArgs = function () { var e = arguments, t = this.useColors; if (e[0] = (t ? "%c" : "") + this.namespace + (t ? " %c" : " ") + e[0] + (t ? "%c " : " ") + "+" + n.humanize(this.diff), !t) return e; var r = "color: " + this.color, i = 0, o = 0; return (e = [e[0], r, "color: inherit"].concat(Array.prototype.slice.call(e, 1)))[0].replace(/%[a-z%]/g, function (e) { "%%" !== e && "%c" === e && (o = ++i) }), e.splice(o, 0, r), e }, n.save = function (e) { try { null == e ? localStorage.removeItem("debug") : localStorage.debug = e } catch (e) { } }, n.load = r, n.useColors = function () { return "WebkitAppearance" in document.documentElement.style || window.console && (console.firebug || console.exception && console.table) || navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/) && parseInt(RegExp.$1, 10) >= 31 }, n.colors = ["lightseagreen", "forestgreen", "goldenrod", "dodgerblue", "darkorchid", "crimson"], n.formatters.j = function (e) { return JSON.stringify(e) }, n.enable(r()) }, { "./debug": 21 }], 21: [function (e, t, n) { (n = t.exports = function (e) { function t() { } function o() { var e = o, t = +new Date, a = t - (r || t); e.diff = a, e.prev = r, e.curr = t, r = t, null == e.useColors && (e.useColors = n.useColors()), null == e.color && e.useColors && (e.color = n.colors[i++ % n.colors.length]); var s = Array.prototype.slice.call(arguments); s[0] = n.coerce(s[0]), "string" != typeof s[0] && (s = ["%o"].concat(s)); var c = 0; s[0] = s[0].replace(/%([a-z%])/g, function (t, r) { if ("%%" === t) return t; c++; var i = n.formatters[r]; if ("function" == typeof i) { var o = s[c]; t = i.call(e, o), s.splice(c, 1), c-- } return t }), "function" == typeof n.formatArgs && (s = n.formatArgs.apply(e, s)); var d = o.log || n.log || console.log.bind(console); d.apply(e, s) } t.enabled = !1, o.enabled = !0; var a = n.enabled(e) ? o : t; return a.namespace = e, a }).coerce = function (e) { return e instanceof Error ? e.stack || e.message : e }, n.disable = function () { n.enable("") }, n.enable = function (e) { n.save(e); for (var t = (e || "").split(/[\s,]+/), r = t.length, i = 0; i < r; i++)t[i] && ("-" === (e = t[i].replace(/\*/g, ".*?"))[0] ? n.skips.push(new RegExp("^" + e.substr(1) + "$")) : n.names.push(new RegExp("^" + e + "$"))) }, n.enabled = function (e) { var t, r; for (t = 0, r = n.skips.length; t < r; t++)if (n.skips[t].test(e)) return !1; for (t = 0, r = n.names.length; t < r; t++)if (n.names[t].test(e)) return !0; return !1 }, n.humanize = e("ms"), n.names = [], n.skips = [], n.formatters = {}; var r, i = 0 }, { ms: 22 }], 22: [function (e, t, n) { var r = 1e3, i = 60 * r, o = 60 * i, a = 24 * o, s = 365.25 * a; function c(e, t, n) { if (!(e < t)) return e < 1.5 * t ? Math.floor(e / t) + " " + n : Math.ceil(e / t) + " " + n + "s" } t.exports = function (e, t) { return t = t || {}, "string" == typeof e ? function (e) { var t = /^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(e); if (!t) return; var n = parseFloat(t[1]); switch ((t[2] || "ms").toLowerCase()) { case "years": case "year": case "y": return n * s; case "days": case "day": case "d": return n * a; case "hours": case "hour": case "h": return n * o; case "minutes": case "minute": case "m": return n * i; case "seconds": case "second": case "s": return n * r; case "ms": return n } }(e) : t.long ? c(d = e, a, "day") || c(d, o, "hour") || c(d, i, "minute") || c(d, r, "second") || d + " ms" : (n = e) >= a ? Math.round(n / a) + "d" : n >= o ? Math.round(n / o) + "h" : n >= i ? Math.round(n / i) + "m" : n >= r ? Math.round(n / r) + "s" : n + "ms"; var n, d } }, {}], 23: [function (e, t, n) { var r = /^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/, i = ["source", "protocol", "authority", "userInfo", "user", "password", "host", "port", "relative", "path", "directory", "file", "query", "anchor"]; t.exports = function (e) { var t = e, n = e.indexOf("["), o = e.indexOf("]"); -1 != n && -1 != o && (e = e.substring(0, n) + e.substring(n, o).replace(/:/g, ";") + e.substring(o, e.length)); for (var a = r.exec(e || ""), s = {}, c = 14; c--;)s[i[c]] = a[c] || ""; return -1 != n && -1 != o && (s.source = t, s.host = s.host.substring(1, s.host.length - 1).replace(/;/g, ":"), s.authority = s.authority.replace("[", "").replace("]", "").replace(/;/g, ":"), s.ipv6uri = !0), s } }, {}], 24: [function (e, t, n) { (function (t) { var r = e("./keys"), i = e("has-binary"), o = e("arraybuffer.slice"), a = e("base64-arraybuffer"), s = e("after"), c = e("utf8"), d = navigator.userAgent.match(/Android/i), p = /PhantomJS/i.test(navigator.userAgent), u = d || p; n.protocol = 3; var l = n.packets = { open: 0, close: 1, ping: 2, pong: 3, message: 4, upgrade: 5, noop: 6 }, f = r(l), h = { type: "error", data: "parser error" }, m = e("blob"); function g(e, t, n) { for (var r = new Array(e.length), i = s(e.length, n), o = function (e, n, i) { t(n, function (t, n) { r[e] = n, i(t, r) }) }, a = 0; a < e.length; a++)o(a, e[a], i) } n.encodePacket = function (e, r, i, o) { "function" == typeof r && (o = r, r = !1), "function" == typeof i && (o = i, i = null); var a, s, d, p = void 0 === e.data ? void 0 : e.data.buffer || e.data; if (t.ArrayBuffer && p instanceof ArrayBuffer) return function (e, t, r) { if (!t) return n.encodeBase64Packet(e, r); var i = e.data, o = new Uint8Array(i), a = new Uint8Array(1 + i.byteLength); a[0] = l[e.type]; for (var s = 0; s < o.length; s++)a[s + 1] = o[s]; return r(a.buffer) }(e, r, o); if (m && p instanceof t.Blob) return function (e, t, r) { if (!t) return n.encodeBase64Packet(e, r); if (u) return function (e, t, r) { if (!t) return n.encodeBase64Packet(e, r); var i = new FileReader; return i.onload = function () { e.data = i.result, n.encodePacket(e, t, !0, r) }, i.readAsArrayBuffer(e.data) }(e, t, r); var i = new Uint8Array(1); i[0] = l[e.type]; var o = new m([i.buffer, e.data]); return r(o) }(e, r, o); if (p && p.base64) return a = e, s = o, d = "b" + n.packets[a.type] + a.data.data, s(d); var f = l[e.type]; return void 0 !== e.data && (f += i ? c.encode(String(e.data)) : String(e.data)), o("" + f) }, n.encodeBase64Packet = function (e, r) { var i, o = "b" + n.packets[e.type]; if (m && e.data instanceof m) { var a = new FileReader; return a.onload = function () { var e = a.result.split(",")[1]; r(o + e) }, a.readAsDataURL(e.data) } try { i = String.fromCharCode.apply(null, new Uint8Array(e.data)) } catch (t) { for (var s = new Uint8Array(e.data), c = new Array(s.length), d = 0; d < s.length; d++)c[d] = s[d]; i = String.fromCharCode.apply(null, c) } return o += t.btoa(i), r(o) }, n.decodePacket = function (e, t, r) { if ("string" == typeof e || void 0 === e) { if ("b" == e.charAt(0)) return n.decodeBase64Packet(e.substr(1), t); if (r) try { e = c.decode(e) } catch (e) { return h } var i = e.charAt(0); return Number(i) == i && f[i] ? e.length > 1 ? { type: f[i], data: e.substring(1) } : { type: f[i] } : h } i = new Uint8Array(e)[0]; var a = o(e, 1); return m && "blob" === t && (a = new m([a])), { type: f[i], data: a } }, n.decodeBase64Packet = function (e, n) { var r = f[e.charAt(0)]; if (!t.ArrayBuffer) return { type: r, data: { base64: !0, data: e.substr(1) } }; var i = a.decode(e.substr(1)); return "blob" === n && m && (i = new m([i])), { type: r, data: i } }, n.encodePayload = function (e, t, r) { "function" == typeof t && (r = t, t = null); var o = i(e); if (t && o) return m && !u ? n.encodePayloadAsBlob(e, r) : n.encodePayloadAsArrayBuffer(e, r); if (!e.length) return r("0:"); g(e, function (e, r) { n.encodePacket(e, !!o && t, !0, function (e) { var t; r(null, (t = e).length + ":" + t) }) }, function (e, t) { return r(t.join("")) }) }, n.decodePayload = function (e, t, r) { if ("string" != typeof e) return n.decodePayloadAsBinary(e, t, r); var i; if ("function" == typeof t && (r = t, t = null), "" == e) return r(h, 0, 1); for (var o, a, s = "", c = 0, d = e.length; c < d; c++) { var p = e.charAt(c); if (":" != p) s += p; else { if ("" == s || s != (o = Number(s))) return r(h, 0, 1); if (s != (a = e.substr(c + 1, o)).length) return r(h, 0, 1); if (a.length) { if (i = n.decodePacket(a, t, !0), h.type == i.type && h.data == i.data) return r(h, 0, 1); if (!1 === r(i, c + o, d)) return } c += o, s = "" } } return "" != s ? r(h, 0, 1) : void 0 }, n.encodePayloadAsArrayBuffer = function (e, t) { if (!e.length) return t(new ArrayBuffer(0)); g(e, function (e, t) { n.encodePacket(e, !0, !0, function (e) { return t(null, e) }) }, function (e, n) { var r = n.reduce(function (e, t) { var n; return e + (n = "string" == typeof t ? t.length : t.byteLength).toString().length + n + 2 }, 0), i = new Uint8Array(r), o = 0; return n.forEach(function (e) { var t = "string" == typeof e, n = e; if (t) { for (var r = new Uint8Array(e.length), a = 0; a < e.length; a++)r[a] = e.charCodeAt(a); n = r.buffer } i[o++] = t ? 0 : 1; var s = n.byteLength.toString(); for (a = 0; a < s.length; a++)i[o++] = parseInt(s[a]); i[o++] = 255; for (r = new Uint8Array(n), a = 0; a < r.length; a++)i[o++] = r[a] }), t(i.buffer) }) }, n.encodePayloadAsBlob = function (e, t) { g(e, function (e, t) { n.encodePacket(e, !0, !0, function (e) { var n = new Uint8Array(1); if (n[0] = 1, "string" == typeof e) { for (var r = new Uint8Array(e.length), i = 0; i < e.length; i++)r[i] = e.charCodeAt(i); e = r.buffer, n[0] = 0 } var o = (e instanceof ArrayBuffer ? e.byteLength : e.size).toString(), a = new Uint8Array(o.length + 1); for (i = 0; i < o.length; i++)a[i] = parseInt(o[i]); if (a[o.length] = 255, m) { var s = new m([n.buffer, a.buffer, e]); t(null, s) } }) }, function (e, n) { return t(new m(n)) }) }, n.decodePayloadAsBinary = function (e, t, r) { "function" == typeof t && (r = t, t = null); for (var i = e, a = [], s = !1; i.byteLength > 0;) { for (var c = new Uint8Array(i), d = 0 === c[0], p = "", u = 1; 255 != c[u]; u++) { if (p.length > 310) { s = !0; break } p += c[u] } if (s) return r(h, 0, 1); i = o(i, 2 + p.length), p = parseInt(p); var l = o(i, 0, p); if (d) try { l = String.fromCharCode.apply(null, new Uint8Array(l)) } catch (e) { var f = new Uint8Array(l); l = ""; for (u = 0; u < f.length; u++)l += String.fromCharCode(f[u]) } a.push(l), i = o(i, p) } var m = a.length; a.forEach(function (e, i) { r(n.decodePacket(e, t, !0), i, m) }) } }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, { "./keys": 25, after: 1, "arraybuffer.slice": 2, "base64-arraybuffer": 5, blob: 6, "has-binary": 41, utf8: 86 }], 25: [function (e, t, n) { t.exports = Object.keys || function (e) { var t = [], n = Object.prototype.hasOwnProperty; for (var r in e) n.call(e, r) && t.push(r); return t } }, {}], 26: [function (e, t, n) { var r = e("wildemitter"), i = e("util"); function o(e) { r.call(this); var t, n = e || {}; this.config = { chunksize: 16384, pacing: 0 }; for (t in n) this.config[t] = n[t]; this.file = null, this.channel = null } function a() { r.call(this), this.receiveBuffer = [], this.received = 0, this.metadata = {}, this.channel = null } i.inherits(o, r), o.prototype.send = function (e, t) { var n = this; this.file = e, this.channel = t; var r = "number" != typeof t.bufferedAmountLowThreshold, i = 0, o = function () { var a = new window.FileReader; a.onload = function (a) { n.channel.send(a.target.result), n.emit("progress", i, e.size, a.target.result), e.size > i + a.target.result.byteLength ? r ? window.setTimeout(o, n.config.pacing) : t.bufferedAmount <= t.bufferedAmountLowThreshold && window.setTimeout(o, 0) : (n.emit("progress", e.size, e.size, null), n.emit("sentFile")), i += n.config.chunksize }; var s = e.slice(i, i + n.config.chunksize); a.readAsArrayBuffer(s) }; r || (t.bufferedAmountLowThreshold = 8 * this.config.chunksize, t.addEventListener("bufferedamountlow", o)), window.setTimeout(o, 0) }, i.inherits(a, r), a.prototype.receive = function (e, t) { var n = this; e && (this.metadata = e), this.channel = t, t.binaryType = "arraybuffer", this.channel.onmessage = function (e) { var t = e.data.byteLength; n.received += t, n.receiveBuffer.push(e.data), n.emit("progress", n.received, n.metadata.size, e.data), n.received === n.metadata.size ? (n.emit("receivedFile", new window.Blob(n.receiveBuffer), n.metadata), n.receiveBuffer = []) : n.received > n.metadata.size && (console.error("received more than expected, discarding..."), n.receiveBuffer = []) } }, t.exports = {}, t.exports.support = "undefined" != typeof window && window && window.File && window.FileReader && window.Blob, t.exports.Sender = o, t.exports.Receiver = a }, { util: 89, wildemitter: 100 }], 27: [function (e, t, n) { var r = e("getusermedia"), i = {}; t.exports = function (e, t) { var n, o = 2 === arguments.length, a = o ? t : e; if ("undefined" == typeof window || "http:" === window.location.protocol) return (n = new Error("NavigatorUserMediaError")).name = "HTTPS_REQUIRED", a(n); if (window.navigator.userAgent.match("Chrome")) { var s = parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1], 10), c = 33, d = !window.chrome.webstore; if (window.navigator.userAgent.match("Linux") && (c = 35), sessionStorage.getScreenMediaJSExtensionId) chrome.runtime.sendMessage(sessionStorage.getScreenMediaJSExtensionId, { type: "getScreen", id: 1 }, null, function (t) { if (t && "" !== t.sourceId) (e = o && e || { audio: !1, video: { mandatory: { chromeMediaSource: "desktop", maxWidth: window.screen.width, maxHeight: window.screen.height, maxFrameRate: 3 } } }).video.mandatory.chromeMediaSourceId = t.sourceId, r(e, a); else { var n = new Error("NavigatorUserMediaError"); n.name = "PERMISSION_DENIED", a(n) } }); else if (window.cefGetScreenMedia) window.cefGetScreenMedia(function (t) { if (t) (e = o && e || { audio: !1, video: { mandatory: { chromeMediaSource: "desktop", maxWidth: window.screen.width, maxHeight: window.screen.height, maxFrameRate: 3 }, optional: [{ googLeakyBucket: !0 }, { googTemporalLayeredScreencast: !0 }] } }).video.mandatory.chromeMediaSourceId = t, r(e, a); else { var n = new Error("cefGetScreenMediaError"); n.name = "CEF_GETSCREENMEDIA_CANCELED", a(n) } }); else if (d || s >= 26 && s <= c) e = o && e || { video: { mandatory: { googLeakyBucket: !0, maxWidth: window.screen.width, maxHeight: window.screen.height, maxFrameRate: 3, chromeMediaSource: "screen" } } }, r(e, a); else { var p = window.setTimeout(function () { return (n = new Error("NavigatorUserMediaError")).name = "EXTENSION_UNAVAILABLE", a(n) }, 1e3); i[p] = [a, o ? e : null], window.postMessage({ type: "getScreen", id: p }, "*") } } else if (window.navigator.userAgent.match("Firefox")) { parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1], 10) >= 33 ? r(e = o && e || { video: { mozMediaSource: "screen", mediaSource: "screen" } }, function (e, t) { if (a(e, t), !e) var n = t.currentTime, r = window.setInterval(function () { t || window.clearInterval(r), t.currentTime == n && (window.clearInterval(r), t.onended && t.onended()), n = t.currentTime }, 500) }) : (n = new Error("NavigatorUserMediaError")).name = "EXTENSION_UNAVAILABLE" } }, "undefined" != typeof window && window.addEventListener("message", function (e) { if (e.origin == window.location.origin) if ("gotScreen" == e.data.type && i[e.data.id]) { var t = i[e.data.id], n = t[1], o = t[0]; if (delete i[e.data.id], "" === e.data.sourceId) { var a = new Error("NavigatorUserMediaError"); a.name = "PERMISSION_DENIED", o(a) } else (n = n || { audio: !1, video: { mandatory: { chromeMediaSource: "desktop", maxWidth: window.screen.width, maxHeight: window.screen.height, maxFrameRate: 3 }, optional: [{ googLeakyBucket: !0 }, { googTemporalLayeredScreencast: !0 }] } }).video.mandatory.chromeMediaSourceId = e.data.sourceId, r(n, o) } else "getScreenPending" == e.data.type && window.clearTimeout(e.data.id) }) }, { getusermedia: 28 }], 28: [function (e, t, n) { e("webrtc-adapter"); t.exports = function (e, t) { var n, r = "PermissionDeniedError", i = "ConstraintNotSatisfiedError"; return 2 === arguments.length || (t = e, e = { video: !0, audio: !0 }), "undefined" != typeof navigator && navigator.getUserMedia ? e.audio || e.video ? void navigator.mediaDevices.getUserMedia(e).then(function (e) { t(null, e) }).catch(function (e) { var n; "string" == typeof e ? (n = new Error("MediaStreamError")).name = e === r || "PERMISSION_DENIED" === e ? r : i : (n = e).name || (n[r] ? e.name = r : e.name = i), t(n) }) : ((n = new Error("MediaStreamError")).name = "NoMediaRequestedError", setTimeout(function () { t(n) }, 0)) : ((n = new Error("MediaStreamError")).name = "NotSupportedError", setTimeout(function () { t(n) }, 0)) } }, { "webrtc-adapter": 90 }], 29: [function (e, t, n) { e("webrtc-adapter"); t.exports = function (e, t) { var n, r = "PermissionDeniedError", i = "ConstraintNotSatisfiedError"; return 2 === arguments.length || (t = e, e = { video: !0, audio: !0 }), "undefined" != typeof navigator && navigator.getUserMedia ? e.audio || e.video ? (localStorage && "true" === localStorage.useFirefoxFakeDevice && (e.fake = !0), void navigator.mediaDevices.getUserMedia(e).then(function (e) { t(null, e) }).catch(function (e) { var n; "string" == typeof e ? (n = new Error("MediaStreamError")).name = e === r || "PERMISSION_DENIED" === e ? r : i : (n = e).name || (n[r] ? e.name = r : e.name = i), t(n) })) : ((n = new Error("MediaStreamError")).name = "NoMediaRequestedError", setTimeout(function () { t(n) }, 0)) : ((n = new Error("MediaStreamError")).name = "NotSupportedError", setTimeout(function () { t(n) }, 0)) } }, { "webrtc-adapter": 30 }], 30: [function (e, t, n) { "use strict"; !function () { var n = e("./utils").log, r = e("./utils").browserDetails; t.exports.browserDetails = r, t.exports.extractVersion = e("./utils").extractVersion, t.exports.disableLog = e("./utils").disableLog; var i = e("./chrome/chrome_shim") || null, o = e("./edge/edge_shim") || null, a = e("./firefox/firefox_shim") || null, s = e("./safari/safari_shim") || null; switch (r.browser) { case "opera": case "chrome": if (!i || !i.shimPeerConnection) return void n("Chrome shim is not included in this adapter release."); n("adapter.js shimming chrome."), t.exports.browserShim = i, i.shimGetUserMedia(), i.shimMediaStream(), i.shimSourceObject(), i.shimPeerConnection(), i.shimOnTrack(); break; case "firefox": if (!a || !a.shimPeerConnection) return void n("Firefox shim is not included in this adapter release."); n("adapter.js shimming firefox."), t.exports.browserShim = a, a.shimGetUserMedia(), a.shimSourceObject(), a.shimPeerConnection(), a.shimOnTrack(); break; case "edge": if (!o || !o.shimPeerConnection) return void n("MS edge shim is not included in this adapter release."); n("adapter.js shimming edge."), t.exports.browserShim = o, o.shimGetUserMedia(), o.shimPeerConnection(); break; case "safari": if (!s) return void n("Safari shim is not included in this adapter release."); n("adapter.js shimming safari."), t.exports.browserShim = s, s.shimGetUserMedia(); break; default: n("Unsupported browser!") } }() }, { "./chrome/chrome_shim": 31, "./edge/edge_shim": 33, "./firefox/firefox_shim": 35, "./safari/safari_shim": 37, "./utils": 38 }], 31: [function (e, t, n) { "use strict"; var r = e("../utils.js").log, i = e("../utils.js").browserDetails, o = { shimMediaStream: function () { window.MediaStream = window.MediaStream || window.webkitMediaStream }, shimOnTrack: function () { "object" != typeof window || !window.RTCPeerConnection || "ontrack" in window.RTCPeerConnection.prototype || Object.defineProperty(window.RTCPeerConnection.prototype, "ontrack", { get: function () { return this._ontrack }, set: function (e) { var t = this; this._ontrack && (this.removeEventListener("track", this._ontrack), this.removeEventListener("addstream", this._ontrackpoly)), this.addEventListener("track", this._ontrack = e), this.addEventListener("addstream", this._ontrackpoly = function (e) { e.stream.addEventListener("addtrack", function (n) { var r = new Event("track"); r.track = n.track, r.receiver = { track: n.track }, r.streams = [e.stream], t.dispatchEvent(r) }), e.stream.getTracks().forEach(function (t) { var n = new Event("track"); n.track = t, n.receiver = { track: t }, n.streams = [e.stream], this.dispatchEvent(n) }.bind(this)) }.bind(this)) } }) }, shimSourceObject: function () { "object" == typeof window && (!window.HTMLMediaElement || "srcObject" in window.HTMLMediaElement.prototype || Object.defineProperty(window.HTMLMediaElement.prototype, "srcObject", { get: function () { return this._srcObject }, set: function (e) { var t = this; this._srcObject = e, this.src && URL.revokeObjectURL(this.src), e ? (this.src = URL.createObjectURL(e), e.addEventListener("addtrack", function () { t.src && URL.revokeObjectURL(t.src), t.src = URL.createObjectURL(e) }), e.addEventListener("removetrack", function () { t.src && URL.revokeObjectURL(t.src), t.src = URL.createObjectURL(e) })) : this.src = "" } })) }, shimPeerConnection: function () { window.RTCPeerConnection = function (e, t) { r("PeerConnection"), e && e.iceTransportPolicy && (e.iceTransports = e.iceTransportPolicy); var n = new webkitRTCPeerConnection(e, t), i = n.getStats.bind(n); return n.getStats = function (e, t, n) { var r = this, o = arguments; if (arguments.length > 0 && "function" == typeof e) return i(e, t); var a = function (e) { var t = {}; return e.result().forEach(function (e) { var n = { id: e.id, timestamp: e.timestamp, type: e.type }; e.names().forEach(function (t) { n[t] = e.stat(t) }), t[n.id] = n }), t }, s = function (e, t) { var n = new Map(Object.keys(e).map(function (t) { return [t, e[t]] })); return t = t || e, Object.keys(t).forEach(function (e) { n[e] = t[e] }), n }; if (arguments.length >= 2) { return i.apply(this, [function (e) { o[1](s(a(e))) }, arguments[0]]) } return new Promise(function (t, n) { 1 === o.length && "object" == typeof e ? i.apply(r, [function (e) { t(s(a(e))) }, n]) : i.apply(r, [function (e) { t(s(a(e), e.result())) }, n]) }).then(t, n) }, n }, window.RTCPeerConnection.prototype = webkitRTCPeerConnection.prototype, webkitRTCPeerConnection.generateCertificate && Object.defineProperty(window.RTCPeerConnection, "generateCertificate", { get: function () { return webkitRTCPeerConnection.generateCertificate } }), ["createOffer", "createAnswer"].forEach(function (e) { var t = webkitRTCPeerConnection.prototype[e]; webkitRTCPeerConnection.prototype[e] = function () { var e = this; if (arguments.length < 1 || 1 === arguments.length && "object" == typeof arguments[0]) { var n = 1 === arguments.length ? arguments[0] : void 0; return new Promise(function (r, i) { t.apply(e, [r, i, n]) }) } return t.apply(this, arguments) } }), i.version < 51 && ["setLocalDescription", "setRemoteDescription", "addIceCandidate"].forEach(function (e) { var t = webkitRTCPeerConnection.prototype[e]; webkitRTCPeerConnection.prototype[e] = function () { var e = arguments, n = this, r = new Promise(function (r, i) { t.apply(n, [e[0], r, i]) }); return e.length < 2 ? r : r.then(function () { e[1].apply(null, []) }, function (t) { e.length >= 3 && e[2].apply(null, [t]) }) } }); var e = RTCPeerConnection.prototype.addIceCandidate; RTCPeerConnection.prototype.addIceCandidate = function () { return null === arguments[0] ? Promise.resolve() : e.apply(this, arguments) }, ["setLocalDescription", "setRemoteDescription", "addIceCandidate"].forEach(function (e) { var t = webkitRTCPeerConnection.prototype[e]; webkitRTCPeerConnection.prototype[e] = function () { return arguments[0] = new ("addIceCandidate" === e ? RTCIceCandidate : RTCSessionDescription)(arguments[0]), t.apply(this, arguments) } }) }, attachMediaStream: function (e, t) { r("DEPRECATED, attachMediaStream will soon be removed."), i.version >= 43 ? e.srcObject = t : void 0 !== e.src ? e.src = URL.createObjectURL(t) : r("Error attaching stream to element.") }, reattachMediaStream: function (e, t) { r("DEPRECATED, reattachMediaStream will soon be removed."), i.version >= 43 ? e.srcObject = t.srcObject : e.src = t.src } }; t.exports = { shimMediaStream: o.shimMediaStream, shimOnTrack: o.shimOnTrack, shimSourceObject: o.shimSourceObject, shimPeerConnection: o.shimPeerConnection, shimGetUserMedia: e("./getusermedia"), attachMediaStream: o.attachMediaStream, reattachMediaStream: o.reattachMediaStream } }, { "../utils.js": 38, "./getusermedia": 32 }], 32: [function (e, t, n) { "use strict"; var r = e("../utils.js").log; t.exports = function () { var e = function (e) { if ("object" != typeof e || e.mandatory || e.optional) return e; var t = {}; return Object.keys(e).forEach(function (n) { if ("require" !== n && "advanced" !== n && "mediaSource" !== n) { var r = "object" == typeof e[n] ? e[n] : { ideal: e[n] }; void 0 !== r.exact && "number" == typeof r.exact && (r.min = r.max = r.exact); var i = function (e, t) { return e ? e + t.charAt(0).toUpperCase() + t.slice(1) : "deviceId" === t ? "sourceId" : t }; if (void 0 !== r.ideal) { t.optional = t.optional || []; var o = {}; "number" == typeof r.ideal ? (o[i("min", n)] = r.ideal, t.optional.push(o), (o = {})[i("max", n)] = r.ideal, t.optional.push(o)) : (o[i("", n)] = r.ideal, t.optional.push(o)) } void 0 !== r.exact && "number" != typeof r.exact ? (t.mandatory = t.mandatory || {}, t.mandatory[i("", n)] = r.exact) : ["min", "max"].forEach(function (e) { void 0 !== r[e] && (t.mandatory = t.mandatory || {}, t.mandatory[i(e, n)] = r[e]) }) } }), e.advanced && (t.optional = (t.optional || []).concat(e.advanced)), t }, t = function (t, n) { if ((t = JSON.parse(JSON.stringify(t))) && t.audio && (t.audio = e(t.audio)), t && "object" == typeof t.video) { var i = t.video.facingMode; if ((i = i && ("object" == typeof i ? i : { ideal: i })) && ("user" === i.exact || "environment" === i.exact || "user" === i.ideal || "environment" === i.ideal) && (!navigator.mediaDevices.getSupportedConstraints || !navigator.mediaDevices.getSupportedConstraints().facingMode) && (delete t.video.facingMode, "environment" === i.exact || "environment" === i.ideal)) return navigator.mediaDevices.enumerateDevices().then(function (o) { var a = (o = o.filter(function (e) { return "videoinput" === e.kind })).find(function (e) { return -1 !== e.label.toLowerCase().indexOf("back") }) || o.length && o[o.length - 1]; return a && (t.video.deviceId = i.exact ? { exact: a.deviceId } : { ideal: a.deviceId }), t.video = e(t.video), r("chrome: " + JSON.stringify(t)), n(t) }); t.video = e(t.video) } return r("chrome: " + JSON.stringify(t)), n(t) }, n = function (e) { return { name: { PermissionDeniedError: "NotAllowedError", ConstraintNotSatisfiedError: "OverconstrainedError" }[e.name] || e.name, message: e.message, constraint: e.constraintName, toString: function () { return this.name + (this.message && ": ") + this.message } } }; navigator.getUserMedia = function (e, r, i) { t(e, function (e) { navigator.webkitGetUserMedia(e, r, function (e) { i(n(e)) }) }) }; var i = function (e) { return new Promise(function (t, n) { navigator.getUserMedia(e, t, n) }) }; if (navigator.mediaDevices || (navigator.mediaDevices = { getUserMedia: i, enumerateDevices: function () { return new Promise(function (e) { var t = { audio: "audioinput", video: "videoinput" }; return MediaStreamTrack.getSources(function (n) { e(n.map(function (e) { return { label: e.label, kind: t[e.kind], deviceId: e.id, groupId: "" } })) }) }) } }), navigator.mediaDevices.getUserMedia) { var o = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices); navigator.mediaDevices.getUserMedia = function (e) { return t(e, function (e) { return o(e).catch(function (e) { return Promise.reject(n(e)) }) }) } } else navigator.mediaDevices.getUserMedia = function (e) { return i(e) }; void 0 === navigator.mediaDevices.addEventListener && (navigator.mediaDevices.addEventListener = function () { r("Dummy mediaDevices.addEventListener called.") }), void 0 === navigator.mediaDevices.removeEventListener && (navigator.mediaDevices.removeEventListener = function () { r("Dummy mediaDevices.removeEventListener called.") }) } }, { "../utils.js": 38 }], 33: [function (e, t, n) { "use strict"; var r = e("sdp"), i = e("../utils").log, o = { shimPeerConnection: function () { window.RTCIceGatherer && (window.RTCIceCandidate || (window.RTCIceCandidate = function (e) { return e }), window.RTCSessionDescription || (window.RTCSessionDescription = function (e) { return e })), window.RTCPeerConnection = function (e) { var t = this, n = document.createDocumentFragment(); if (["addEventListener", "removeEventListener", "dispatchEvent"].forEach(function (e) { t[e] = n[e].bind(n) }), this.onicecandidate = null, this.onaddstream = null, this.ontrack = null, this.onremovestream = null, this.onsignalingstatechange = null, this.oniceconnectionstatechange = null, this.onnegotiationneeded = null, this.ondatachannel = null, this.localStreams = [], this.remoteStreams = [], this.getLocalStreams = function () { return t.localStreams }, this.getRemoteStreams = function () { return t.remoteStreams }, this.localDescription = new RTCSessionDescription({ type: "", sdp: "" }), this.remoteDescription = new RTCSessionDescription({ type: "", sdp: "" }), this.signalingState = "stable", this.iceConnectionState = "new", this.iceGatheringState = "new", this.iceOptions = { gatherPolicy: "all", iceServers: [] }, e && e.iceTransportPolicy) switch (e.iceTransportPolicy) { case "all": case "relay": this.iceOptions.gatherPolicy = e.iceTransportPolicy; break; case "none": throw new TypeError('iceTransportPolicy "none" not supported') }if (this.usingBundle = e && "max-bundle" === e.bundlePolicy, e && e.iceServers) { var r = JSON.parse(JSON.stringify(e.iceServers)); this.iceOptions.iceServers = r.filter(function (e) { if (e && e.urls) { var t = e.urls; return "string" == typeof t && (t = [t]), !!(t = t.filter(function (e) { return 0 === e.indexOf("turn:") && -1 !== e.indexOf("transport=udp") })[0]) } return !1 }) } this.transceivers = [], this._localIceCandidatesBuffer = [] }, window.RTCPeerConnection.prototype._emitBufferedCandidates = function () { var e = this, t = r.splitSections(e.localDescription.sdp); this._localIceCandidatesBuffer.forEach(function (n) { if (!n.candidate || 0 === Object.keys(n.candidate).length) for (var r = 1; r < t.length; r++)-1 === t[r].indexOf("\r\na=end-of-candidates\r\n") && (t[r] += "a=end-of-candidates\r\n"); else -1 === n.candidate.candidate.indexOf("typ endOfCandidates") && (t[n.candidate.sdpMLineIndex + 1] += "a=" + n.candidate.candidate + "\r\n"); (e.localDescription.sdp = t.join(""), e.dispatchEvent(n), null !== e.onicecandidate && e.onicecandidate(n), n.candidate || "complete" === e.iceGatheringState) || e.transceivers.every(function (e) { return e.iceGatherer && "completed" === e.iceGatherer.state }) && (e.iceGatheringState = "complete") }), this._localIceCandidatesBuffer = [] }, window.RTCPeerConnection.prototype.addStream = function (e) { this.localStreams.push(e.clone()), this._maybeFireNegotiationNeeded() }, window.RTCPeerConnection.prototype.removeStream = function (e) { var t = this.localStreams.indexOf(e); t > -1 && (this.localStreams.splice(t, 1), this._maybeFireNegotiationNeeded()) }, window.RTCPeerConnection.prototype.getSenders = function () { return this.transceivers.filter(function (e) { return !!e.rtpSender }).map(function (e) { return e.rtpSender }) }, window.RTCPeerConnection.prototype.getReceivers = function () { return this.transceivers.filter(function (e) { return !!e.rtpReceiver }).map(function (e) { return e.rtpReceiver }) }, window.RTCPeerConnection.prototype._getCommonCapabilities = function (e, t) { var n = { codecs: [], headerExtensions: [], fecMechanisms: [] }; return e.codecs.forEach(function (e) { for (var r = 0; r < t.codecs.length; r++) { var i = t.codecs[r]; if (e.name.toLowerCase() === i.name.toLowerCase() && e.clockRate === i.clockRate && e.numChannels === i.numChannels) { n.codecs.push(i); break } } }), e.headerExtensions.forEach(function (e) { for (var r = 0; r < t.headerExtensions.length; r++) { var i = t.headerExtensions[r]; if (e.uri === i.uri) { n.headerExtensions.push(i); break } } }), n }, window.RTCPeerConnection.prototype._createIceAndDtlsTransports = function (e, t) { var n = this, i = new RTCIceGatherer(n.iceOptions), o = new RTCIceTransport(i); i.onlocalcandidate = function (a) { var s = new Event("icecandidate"); s.candidate = { sdpMid: e, sdpMLineIndex: t }; var c = a.candidate, d = !c || 0 === Object.keys(c).length; d ? (void 0 === i.state && (i.state = "completed"), s.candidate.candidate = "candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates") : (c.component = "RTCP" === o.component ? 2 : 1, s.candidate.candidate = r.writeCandidate(c)); var p = r.splitSections(n.localDescription.sdp); -1 === s.candidate.candidate.indexOf("typ endOfCandidates") ? p[s.candidate.sdpMLineIndex + 1] += "a=" + s.candidate.candidate + "\r\n" : p[s.candidate.sdpMLineIndex + 1] += "a=end-of-candidates\r\n", n.localDescription.sdp = p.join(""); var u = n.transceivers.every(function (e) { return e.iceGatherer && "completed" === e.iceGatherer.state }); switch (n.iceGatheringState) { case "new": n._localIceCandidatesBuffer.push(s), d && u && n._localIceCandidatesBuffer.push(new Event("icecandidate")); break; case "gathering": n._emitBufferedCandidates(), n.dispatchEvent(s), null !== n.onicecandidate && n.onicecandidate(s), u && (n.dispatchEvent(new Event("icecandidate")), null !== n.onicecandidate && n.onicecandidate(new Event("icecandidate")), n.iceGatheringState = "complete") } }, o.onicestatechange = function () { n._updateConnectionState() }; var a = new RTCDtlsTransport(o); return a.ondtlsstatechange = function () { n._updateConnectionState() }, a.onerror = function () { a.state = "failed", n._updateConnectionState() }, { iceGatherer: i, iceTransport: o, dtlsTransport: a } }, window.RTCPeerConnection.prototype._transceive = function (e, t, n) { var i = this._getCommonCapabilities(e.localCapabilities, e.remoteCapabilities); t && e.rtpSender && (i.encodings = e.sendEncodingParameters, i.rtcp = { cname: r.localCName }, e.recvEncodingParameters.length && (i.rtcp.ssrc = e.recvEncodingParameters[0].ssrc), e.rtpSender.send(i)), n && e.rtpReceiver && (i.encodings = e.recvEncodingParameters, i.rtcp = { cname: e.cname }, e.sendEncodingParameters.length && (i.rtcp.ssrc = e.sendEncodingParameters[0].ssrc), e.rtpReceiver.receive(i)) }, window.RTCPeerConnection.prototype.setLocalDescription = function (e) { var t, n, i = this; if ("offer" === e.type) this._pendingOffer && (t = r.splitSections(e.sdp), n = t.shift(), t.forEach(function (e, t) { var n = r.parseRtpParameters(e); i._pendingOffer[t].localCapabilities = n }), this.transceivers = this._pendingOffer, delete this._pendingOffer); else if ("answer" === e.type) { t = r.splitSections(i.remoteDescription.sdp), n = t.shift(); var o = r.matchPrefix(n, "a=ice-lite").length > 0; t.forEach(function (e, t) { var a = i.transceivers[t], s = a.iceGatherer, c = a.iceTransport, d = a.dtlsTransport, p = a.localCapabilities, u = a.remoteCapabilities; if (!("0" === e.split("\n", 1)[0].split(" ", 2)[1])) { var l = r.getIceParameters(e, n); if (o) { var f = r.matchPrefix(e, "a=candidate:").map(function (e) { return r.parseCandidate(e) }).filter(function (e) { return "1" === e.component }); f.length && c.setRemoteCandidates(f) } var h = r.getDtlsParameters(e, n); o && (h.role = "server"), i.usingBundle && 0 !== t || (c.start(s, l, o ? "controlling" : "controlled"), d.start(h)); var m = i._getCommonCapabilities(p, u); i._transceive(a, m.codecs.length > 0, !1) } }) } switch (this.localDescription = { type: e.type, sdp: e.sdp }, e.type) { case "offer": this._updateSignalingState("have-local-offer"); break; case "answer": this._updateSignalingState("stable"); break; default: throw new TypeError('unsupported type "' + e.type + '"') }var a = arguments.length > 1 && "function" == typeof arguments[1]; if (a) { var s = arguments[1]; window.setTimeout(function () { s(), "new" === i.iceGatheringState && (i.iceGatheringState = "gathering"), i._emitBufferedCandidates() }, 0) } var c = Promise.resolve(); return c.then(function () { a || ("new" === i.iceGatheringState && (i.iceGatheringState = "gathering"), window.setTimeout(i._emitBufferedCandidates.bind(i), 500)) }), c }, window.RTCPeerConnection.prototype.setRemoteDescription = function (e) { var t = this, n = new MediaStream, i = [], o = r.splitSections(e.sdp), a = o.shift(), s = r.matchPrefix(a, "a=ice-lite").length > 0; switch (this.usingBundle = r.matchPrefix(a, "a=group:BUNDLE ").length > 0, o.forEach(function (o, c) { var d, p, u, l, f, h, m, g, v, y, w, b, C = r.splitLines(o)[0].substr(2).split(" "), S = C[0], k = "0" === C[1], T = r.getDirection(o, a), E = r.parseRtpParameters(o); k || (w = r.getIceParameters(o, a), (b = r.getDtlsParameters(o, a)).role = "client"), g = r.parseRtpEncodingParameters(o); var P, x = r.matchPrefix(o, "a=mid:"); x = x.length ? x[0].substr(6) : r.generateIdentifier(); var R = r.matchPrefix(o, "a=ssrc:").map(function (e) { return r.parseSsrcMedia(e) }).filter(function (e) { return "cname" === e.attribute })[0]; R && (P = R.value); var O = r.matchPrefix(o, "a=end-of-candidates").length > 0, D = r.matchPrefix(o, "a=candidate:").map(function (e) { return r.parseCandidate(e) }).filter(function (e) { return "1" === e.component }); if ("offer" !== e.type || k) "answer" !== e.type || k || (p = (d = t.transceivers[c]).iceGatherer, u = d.iceTransport, l = d.dtlsTransport, f = d.rtpSender, h = d.rtpReceiver, m = d.sendEncodingParameters, v = d.localCapabilities, t.transceivers[c].recvEncodingParameters = g, t.transceivers[c].remoteCapabilities = E, t.transceivers[c].cname = P, (s || O) && D.length && u.setRemoteCandidates(D), t.usingBundle && 0 !== c || (u.start(p, w, "controlling"), l.start(b)), t._transceive(d, "sendrecv" === T || "recvonly" === T, "sendrecv" === T || "sendonly" === T), !h || "sendrecv" !== T && "sendonly" !== T ? delete d.rtpReceiver : (y = h.track, i.push([y, h]), n.addTrack(y))); else { var j = t.usingBundle && c > 0 ? { iceGatherer: t.transceivers[0].iceGatherer, iceTransport: t.transceivers[0].iceTransport, dtlsTransport: t.transceivers[0].dtlsTransport } : t._createIceAndDtlsTransports(x, c); if (O && j.iceTransport.setRemoteCandidates(D), v = RTCRtpReceiver.getCapabilities(S), m = [{ ssrc: 1001 * (2 * c + 2) }], y = (h = new RTCRtpReceiver(j.dtlsTransport, S)).track, i.push([y, h]), n.addTrack(y), t.localStreams.length > 0 && t.localStreams[0].getTracks().length >= c) { var M = t.localStreams[0].getTracks()[c]; f = new RTCRtpSender(M, j.dtlsTransport) } t.transceivers[c] = { iceGatherer: j.iceGatherer, iceTransport: j.iceTransport, dtlsTransport: j.dtlsTransport, localCapabilities: v, remoteCapabilities: E, rtpSender: f, rtpReceiver: h, kind: S, mid: x, cname: P, sendEncodingParameters: m, recvEncodingParameters: g }, t._transceive(t.transceivers[c], !1, "sendrecv" === T || "sendonly" === T) } }), this.remoteDescription = { type: e.type, sdp: e.sdp }, e.type) { case "offer": this._updateSignalingState("have-remote-offer"); break; case "answer": this._updateSignalingState("stable"); break; default: throw new TypeError('unsupported type "' + e.type + '"') }return n.getTracks().length && (t.remoteStreams.push(n), window.setTimeout(function () { var e = new Event("addstream"); e.stream = n, t.dispatchEvent(e), null !== t.onaddstream && window.setTimeout(function () { t.onaddstream(e) }, 0), i.forEach(function (r) { var i = r[0], o = r[1], a = new Event("track"); a.track = i, a.receiver = o, a.streams = [n], t.dispatchEvent(e), null !== t.ontrack && window.setTimeout(function () { t.ontrack(a) }, 0) }) }, 0)), arguments.length > 1 && "function" == typeof arguments[1] && window.setTimeout(arguments[1], 0), Promise.resolve() }, window.RTCPeerConnection.prototype.close = function () { this.transceivers.forEach(function (e) { e.iceTransport && e.iceTransport.stop(), e.dtlsTransport && e.dtlsTransport.stop(), e.rtpSender && e.rtpSender.stop(), e.rtpReceiver && e.rtpReceiver.stop() }), this._updateSignalingState("closed") }, window.RTCPeerConnection.prototype._updateSignalingState = function (e) { this.signalingState = e; var t = new Event("signalingstatechange"); this.dispatchEvent(t), null !== this.onsignalingstatechange && this.onsignalingstatechange(t) }, window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function () { var e = new Event("negotiationneeded"); this.dispatchEvent(e), null !== this.onnegotiationneeded && this.onnegotiationneeded(e) }, window.RTCPeerConnection.prototype._updateConnectionState = function () { var e, t = { new: 0, closed: 0, connecting: 0, checking: 0, connected: 0, completed: 0, failed: 0 }; if (this.transceivers.forEach(function (e) { t[e.iceTransport.state]++ , t[e.dtlsTransport.state]++ }), t.connected += t.completed, e = "new", t.failed > 0 ? e = "failed" : t.connecting > 0 || t.checking > 0 ? e = "connecting" : t.disconnected > 0 ? e = "disconnected" : t.new > 0 ? e = "new" : (t.connected > 0 || t.completed > 0) && (e = "connected"), e !== this.iceConnectionState) { this.iceConnectionState = e; var n = new Event("iceconnectionstatechange"); this.dispatchEvent(n), null !== this.oniceconnectionstatechange && this.oniceconnectionstatechange(n) } }, window.RTCPeerConnection.prototype.createOffer = function () { var e, t = this; if (this._pendingOffer) throw new Error("createOffer called while there is a pending offer."); 1 === arguments.length && "function" != typeof arguments[0] ? e = arguments[0] : 3 === arguments.length && (e = arguments[2]); var n = [], i = 0, o = 0; if (this.localStreams.length && (i = this.localStreams[0].getAudioTracks().length, o = this.localStreams[0].getVideoTracks().length), e) { if (e.mandatory || e.optional) throw new TypeError("Legacy mandatory/optional constraints not supported."); void 0 !== e.offerToReceiveAudio && (i = e.offerToReceiveAudio), void 0 !== e.offerToReceiveVideo && (o = e.offerToReceiveVideo) } for (this.localStreams.length && this.localStreams[0].getTracks().forEach(function (e) { n.push({ kind: e.kind, track: e, wantReceive: "audio" === e.kind ? i > 0 : o > 0 }), "audio" === e.kind ? i-- : "video" === e.kind && o-- }); i > 0 || o > 0;)i > 0 && (n.push({ kind: "audio", wantReceive: !0 }), i--), o > 0 && (n.push({ kind: "video", wantReceive: !0 }), o--); var a = r.writeSessionBoilerplate(), s = []; n.forEach(function (e, n) { var i, o, a = e.track, c = e.kind, d = r.generateIdentifier(), p = t.usingBundle && n > 0 ? { iceGatherer: s[0].iceGatherer, iceTransport: s[0].iceTransport, dtlsTransport: s[0].dtlsTransport } : t._createIceAndDtlsTransports(d, n), u = RTCRtpSender.getCapabilities(c), l = [{ ssrc: 1001 * (2 * n + 1) }]; a && (i = new RTCRtpSender(a, p.dtlsTransport)), e.wantReceive && (o = new RTCRtpReceiver(p.dtlsTransport, c)), s[n] = { iceGatherer: p.iceGatherer, iceTransport: p.iceTransport, dtlsTransport: p.dtlsTransport, localCapabilities: u, remoteCapabilities: null, rtpSender: i, rtpReceiver: o, kind: c, mid: d, sendEncodingParameters: l, recvEncodingParameters: null } }), this.usingBundle && (a += "a=group:BUNDLE " + s.map(function (e) { return e.mid }).join(" ") + "\r\n"), n.forEach(function (e, n) { var i = s[n]; a += r.writeMediaSection(i, i.localCapabilities, "offer", t.localStreams[0]) }), this._pendingOffer = s; var c = new RTCSessionDescription({ type: "offer", sdp: a }); return arguments.length && "function" == typeof arguments[0] && window.setTimeout(arguments[0], 0, c), Promise.resolve(c) }, window.RTCPeerConnection.prototype.createAnswer = function () { var e = this, t = r.writeSessionBoilerplate(); this.usingBundle && (t += "a=group:BUNDLE " + this.transceivers.map(function (e) { return e.mid }).join(" ") + "\r\n"), this.transceivers.forEach(function (n) { var i = e._getCommonCapabilities(n.localCapabilities, n.remoteCapabilities); t += r.writeMediaSection(n, i, "answer", e.localStreams[0]) }); var n = new RTCSessionDescription({ type: "answer", sdp: t }); return arguments.length && "function" == typeof arguments[0] && window.setTimeout(arguments[0], 0, n), Promise.resolve(n) }, window.RTCPeerConnection.prototype.addIceCandidate = function (e) { if (null === e) this.transceivers.forEach(function (e) { e.iceTransport.addRemoteCandidate({}) }); else { var t = e.sdpMLineIndex; if (e.sdpMid) for (var n = 0; n < this.transceivers.length; n++)if (this.transceivers[n].mid === e.sdpMid) { t = n; break } var i = this.transceivers[t]; if (i) { var o = Object.keys(e.candidate).length > 0 ? r.parseCandidate(e.candidate) : {}; if ("tcp" === o.protocol && 0 === o.port) return; if ("1" !== o.component) return; "endOfCandidates" === o.type && (o = {}), i.iceTransport.addRemoteCandidate(o); var a = r.splitSections(this.remoteDescription.sdp); a[t + 1] += (o.type ? e.candidate.trim() : "a=end-of-candidates") + "\r\n", this.remoteDescription.sdp = a.join("") } } return arguments.length > 1 && "function" == typeof arguments[1] && window.setTimeout(arguments[1], 0), Promise.resolve() }, window.RTCPeerConnection.prototype.getStats = function () { var e = []; this.transceivers.forEach(function (t) { ["rtpSender", "rtpReceiver", "iceGatherer", "iceTransport", "dtlsTransport"].forEach(function (n) { t[n] && e.push(t[n].getStats()) }) }); var t = arguments.length > 1 && "function" == typeof arguments[1] && arguments[1]; return new Promise(function (n) { var r = new Map; Promise.all(e).then(function (e) { e.forEach(function (e) { Object.keys(e).forEach(function (t) { r.set(t, e[t]), r[t] = e[t] }) }), t && window.setTimeout(t, 0, r), n(r) }) }) } }, attachMediaStream: function (e, t) { i("DEPRECATED, attachMediaStream will soon be removed."), e.srcObject = t }, reattachMediaStream: function (e, t) { i("DEPRECATED, reattachMediaStream will soon be removed."), e.srcObject = t.srcObject } }; t.exports = { shimPeerConnection: o.shimPeerConnection, shimGetUserMedia: e("./getusermedia"), attachMediaStream: o.attachMediaStream, reattachMediaStream: o.reattachMediaStream } }, { "../utils": 38, "./getusermedia": 34, sdp: 62 }], 34: [function (e, t, n) { "use strict"; t.exports = function () { var e = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices); navigator.mediaDevices.getUserMedia = function (t) { return e(t).catch(function (e) { return Promise.reject({ name: { PermissionDeniedError: "NotAllowedError" }[(t = e).name] || t.name, message: t.message, constraint: t.constraint, toString: function () { return this.name } }); var t }) } } }, {}], 35: [function (e, t, n) { "use strict"; var r = e("../utils").log, i = e("../utils").browserDetails, o = { shimOnTrack: function () { "object" != typeof window || !window.RTCPeerConnection || "ontrack" in window.RTCPeerConnection.prototype || Object.defineProperty(window.RTCPeerConnection.prototype, "ontrack", { get: function () { return this._ontrack }, set: function (e) { this._ontrack && (this.removeEventListener("track", this._ontrack), this.removeEventListener("addstream", this._ontrackpoly)), this.addEventListener("track", this._ontrack = e), this.addEventListener("addstream", this._ontrackpoly = function (e) { e.stream.getTracks().forEach(function (t) { var n = new Event("track"); n.track = t, n.receiver = { track: t }, n.streams = [e.stream], this.dispatchEvent(n) }.bind(this)) }.bind(this)) } }) }, shimSourceObject: function () { "object" == typeof window && (!window.HTMLMediaElement || "srcObject" in window.HTMLMediaElement.prototype || Object.defineProperty(window.HTMLMediaElement.prototype, "srcObject", { get: function () { return this.mozSrcObject }, set: function (e) { this.mozSrcObject = e } })) }, shimPeerConnection: function () { if ("object" == typeof window && (window.RTCPeerConnection || window.mozRTCPeerConnection)) { window.RTCPeerConnection || (window.RTCPeerConnection = function (e, t) { if (i.version < 38 && e && e.iceServers) { for (var n = [], r = 0; r < e.iceServers.length; r++) { var o = e.iceServers[r]; if (o.hasOwnProperty("urls")) for (var a = 0; a < o.urls.length; a++) { var s = { url: o.urls[a] }; 0 === o.urls[a].indexOf("turn") && (s.username = o.username, s.credential = o.credential), n.push(s) } else n.push(e.iceServers[r]) } e.iceServers = n } return new mozRTCPeerConnection(e, t) }, window.RTCPeerConnection.prototype = mozRTCPeerConnection.prototype, mozRTCPeerConnection.generateCertificate && Object.defineProperty(window.RTCPeerConnection, "generateCertificate", { get: function () { return mozRTCPeerConnection.generateCertificate } }), window.RTCSessionDescription = mozRTCSessionDescription, window.RTCIceCandidate = mozRTCIceCandidate), ["setLocalDescription", "setRemoteDescription", "addIceCandidate"].forEach(function (e) { var t = RTCPeerConnection.prototype[e]; RTCPeerConnection.prototype[e] = function () { return arguments[0] = new ("addIceCandidate" === e ? RTCIceCandidate : RTCSessionDescription)(arguments[0]), t.apply(this, arguments) } }); var e = RTCPeerConnection.prototype.addIceCandidate; RTCPeerConnection.prototype.addIceCandidate = function () { return null === arguments[0] ? Promise.resolve() : e.apply(this, arguments) }; var t = RTCPeerConnection.prototype.getStats; RTCPeerConnection.prototype.getStats = function (e, n, r) { return t.apply(this, [e || null]).then(function (e) { return t = e, n = new Map, Object.keys(t).forEach(function (e) { n.set(e, t[e]), n[e] = t[e] }), n; var t, n }).then(n, r) } } }, attachMediaStream: function (e, t) { r("DEPRECATED, attachMediaStream will soon be removed."), e.srcObject = t }, reattachMediaStream: function (e, t) { r("DEPRECATED, reattachMediaStream will soon be removed."), e.srcObject = t.srcObject } }; t.exports = { shimOnTrack: o.shimOnTrack, shimSourceObject: o.shimSourceObject, shimPeerConnection: o.shimPeerConnection, shimGetUserMedia: e("./getusermedia"), attachMediaStream: o.attachMediaStream, reattachMediaStream: o.reattachMediaStream } }, { "../utils": 38, "./getusermedia": 36 }], 36: [function (e, t, n) { "use strict"; var r = e("../utils").log, i = e("../utils").browserDetails; t.exports = function () { var e = function (e) { return { name: { SecurityError: "NotAllowedError", PermissionDeniedError: "NotAllowedError" }[e.name] || e.name, message: { "The operation is insecure.": "The request is not allowed by the user agent or the platform in the current context." }[e.message] || e.message, constraint: e.constraint, toString: function () { return this.name + (this.message && ": ") + this.message } } }, t = function (t, n, o) { var a = function (e) { if ("object" != typeof e || e.require) return e; var t = []; return Object.keys(e).forEach(function (n) { if ("require" !== n && "advanced" !== n && "mediaSource" !== n) { var r = e[n] = "object" == typeof e[n] ? e[n] : { ideal: e[n] }; if (void 0 === r.min && void 0 === r.max && void 0 === r.exact || t.push(n), void 0 !== r.exact && ("number" == typeof r.exact ? r.min = r.max = r.exact : e[n] = r.exact, delete r.exact), void 0 !== r.ideal) { e.advanced = e.advanced || []; var i = {}; "number" == typeof r.ideal ? i[n] = { min: r.ideal, max: r.ideal } : i[n] = r.ideal, e.advanced.push(i), delete r.ideal, Object.keys(r).length || delete e[n] } } }), t.length && (e.require = t), e }; return t = JSON.parse(JSON.stringify(t)), i.version < 38 && (r("spec: " + JSON.stringify(t)), t.audio && (t.audio = a(t.audio)), t.video && (t.video = a(t.video)), r("ff37: " + JSON.stringify(t))), navigator.mozGetUserMedia(t, n, function (t) { o(e(t)) }) }; if (navigator.mediaDevices || (navigator.mediaDevices = { getUserMedia: function (e) { return new Promise(function (n, r) { t(e, n, r) }) }, addEventListener: function () { }, removeEventListener: function () { } }), navigator.mediaDevices.enumerateDevices = navigator.mediaDevices.enumerateDevices || function () { return new Promise(function (e) { e([{ kind: "audioinput", deviceId: "default", label: "", groupId: "" }, { kind: "videoinput", deviceId: "default", label: "", groupId: "" }]) }) }, i.version < 41) { var n = navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices); navigator.mediaDevices.enumerateDevices = function () { return n().then(void 0, function (e) { if ("NotFoundError" === e.name) return []; throw e }) } } if (i.version < 49) { var o = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices); navigator.mediaDevices.getUserMedia = function (t) { return o(t).catch(function (t) { return Promise.reject(e(t)) }) } } navigator.getUserMedia = function (e, n, r) { if (i.version < 44) return t(e, n, r); console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"), navigator.mediaDevices.getUserMedia(e).then(n, r) } } }, { "../utils": 38 }], 37: [function (e, t, n) { "use strict"; var r = { shimGetUserMedia: function () { navigator.getUserMedia = navigator.webkitGetUserMedia } }; t.exports = { shimGetUserMedia: r.shimGetUserMedia } }, {}], 38: [function (e, t, n) { "use strict"; var r = !0, i = { disableLog: function (e) { return "boolean" != typeof e ? new Error("Argument type: " + typeof e + ". Please use a boolean.") : (r = e, e ? "adapter.js logging disabled" : "adapter.js logging enabled") }, log: function () { if ("object" == typeof window) { if (r) return; "undefined" != typeof console && "function" == typeof console.log && console.log.apply(console, arguments) } }, extractVersion: function (e, t, n) { var r = e.match(t); return r && r.length >= n && parseInt(r[n], 10) }, detectBrowser: function () { var e = {}; if (e.browser = null, e.version = null, e.minVersion = null, "undefined" == typeof window || !window.navigator) return e.browser = "Not a browser.", e; if (navigator.mozGetUserMedia) e.browser = "firefox", e.version = this.extractVersion(navigator.userAgent, /Firefox\/([0-9]+)\./, 1), e.minVersion = 31; else if (navigator.webkitGetUserMedia) if (window.webkitRTCPeerConnection) e.browser = "chrome", e.version = this.extractVersion(navigator.userAgent, /Chrom(e|ium)\/([0-9]+)\./, 2), e.minVersion = 38; else { if (!navigator.userAgent.match(/Version\/(\d+).(\d+)/)) return e.browser = "Unsupported webkit-based browser with GUM support but no WebRTC support.", e; e.browser = "safari", e.version = this.extractVersion(navigator.userAgent, /AppleWebKit\/([0-9]+)\./, 1), e.minVersion = 602 } else { if (!navigator.mediaDevices || !navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)) return e.browser = "Not a supported browser.", e; e.browser = "edge", e.version = this.extractVersion(navigator.userAgent, /Edge\/(\d+).(\d+)$/, 2), e.minVersion = 10547 } return e.version < e.minVersion && i.log("Browser: " + e.browser + " Version: " + e.version + " < minimum supported version: " + e.minVersion + "\n some things might not work!"), e } }; t.exports = { log: i.log, disableLog: i.disableLog, browserDetails: i.detectBrowser(), extractVersion: i.extractVersion } }, {}], 39: [function (e, t, n) { t.exports = function () { return this }() }, {}], 40: [function (e, t, n) { var r, i = e("wildemitter"); "undefined" != typeof window && (r = window.AudioContext || window.webkitAudioContext); var o = null; t.exports = function (e, t) { var n = new i; if (!r) return n; var a, s, c, d = (t = t || {}).smoothing || .1, p = t.interval || 50, u = t.threshold, l = t.play, f = t.history || 10, h = !0; o || (o = new r), (c = o.createAnalyser()).fftSize = 512, c.smoothingTimeConstant = d, s = new Float32Array(c.frequencyBinCount), e.jquery && (e = e[0]), e instanceof HTMLAudioElement || e instanceof HTMLVideoElement ? (a = o.createMediaElementSource(e), void 0 === l && (l = !0), u = u || -50) : (a = o.createMediaStreamSource(e), u = u || -50), a.connect(c), l && c.connect(o.destination), n.speaking = !1, n.setThreshold = function (e) { u = e }, n.setInterval = function (e) { p = e }, n.stop = function () { h = !1, n.emit("volume_change", -100, u), n.speaking && (n.speaking = !1, n.emit("stopped_speaking")), c.disconnect(), a.disconnect() }, n.speakingHistory = []; for (var m = 0; m < f; m++)n.speakingHistory.push(0); var g = function () { setTimeout(function () { if (h) { var e = function (e, t) { var n = -1 / 0; e.getFloatFrequencyData(t); for (var r = 4, i = t.length; r < i; r++)t[r] > n && t[r] < 0 && (n = t[r]); return n }(c, s); n.emit("volume_change", e, u); var t = 0; if (e > u && !n.speaking) { for (var r = n.speakingHistory.length - 3; r < n.speakingHistory.length; r++)t += n.speakingHistory[r]; t >= 2 && (n.speaking = !0, n.emit("speaking")) } else if (e < u && n.speaking) { for (r = 0; r < n.speakingHistory.length; r++)t += n.speakingHistory[r]; 0 == t && (n.speaking = !1, n.emit("stopped_speaking")) } n.speakingHistory.shift(), n.speakingHistory.push(0 + (e > u)), g() } }, p) }; return g(), n } }, { wildemitter: 100 }], 41: [function (e, t, n) { (function (n) { var r = e("isarray"); t.exports = function (e) { return function e(t) { if (!t) return !1; if (n.Buffer && n.Buffer.isBuffer(t) || n.ArrayBuffer && t instanceof ArrayBuffer || n.Blob && t instanceof Blob || n.File && t instanceof File) return !0; if (r(t)) { for (var i = 0; i < t.length; i++)if (e(t[i])) return !0 } else if (t && "object" == typeof t) { t.toJSON && (t = t.toJSON()); for (var o in t) if (Object.prototype.hasOwnProperty.call(t, o) && e(t[o])) return !0 } return !1 }(e) } }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, { isarray: 42 }], 42: [function (e, t, n) { t.exports = Array.isArray || function (e) { return "[object Array]" == Object.prototype.toString.call(e) } }, {}], 43: [function (e, t, n) { var r = e("global"); try { t.exports = "XMLHttpRequest" in r && "withCredentials" in new r.XMLHttpRequest } catch (e) { t.exports = !1 } }, { global: 39 }], 44: [function (e, t, n) { var r = [].indexOf; t.exports = function (e, t) { if (r) return e.indexOf(t); for (var n = 0; n < e.length; ++n)if (e[n] === t) return n; return -1 } }, {}], 45: [function (e, t, n) { !function (e) { var t, r, i, o = {}.toString, a = "object" == typeof JSON && JSON, s = "object" == typeof n && n && !n.nodeType && n; s && a ? (s.stringify = a.stringify, s.parse = a.parse) : s = e.JSON = a || {}; var c = new Date(-0xc782b5b800cec); try { c = -109252 == c.getUTCFullYear() && 0 === c.getUTCMonth() && 1 === c.getUTCDate() && 10 == c.getUTCHours() && 37 == c.getUTCMinutes() && 6 == c.getUTCSeconds() && 708 == c.getUTCMilliseconds() } catch (e) { } function d(e) { if (d[e] !== i) return d[e]; var t; if ("bug-string-char-index" == e) t = "a" != "a"[0]; else if ("json" == e) t = d("json-stringify") && d("json-parse"); else { var n, r = '{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'; if ("json-stringify" == e) { var a = s.stringify, p = "function" == typeof a && c; if (p) { (n = function () { return 1 }).toJSON = n; try { p = "0" === a(0) && "0" === a(new Number) && '""' == a(new String) && a(o) === i && a(i) === i && a() === i && "1" === a(n) && "[1]" == a([n]) && "[null]" == a([i]) && "null" == a(null) && "[null,null,null]" == a([i, o, null]) && a({ a: [n, !0, !1, null, "\0\b\n\f\r\t"] }) == r && "1" === a(null, n) && "[\n 1,\n 2\n]" == a([1, 2], null, 1) && '"-271821-04-20T00:00:00.000Z"' == a(new Date(-864e13)) && '"+275760-09-13T00:00:00.000Z"' == a(new Date(864e13)) && '"-000001-01-01T00:00:00.000Z"' == a(new Date(-621987552e5)) && '"1969-12-31T23:59:59.999Z"' == a(new Date(-1)) } catch (e) { p = !1 } } t = p } if ("json-parse" == e) { var u = s.parse; if ("function" == typeof u) try { if (0 === u("0") && !u(!1)) { var l = 5 == (n = u(r)).a.length && 1 === n.a[0]; if (l) { try { l = !u('"\t"') } catch (e) { } if (l) try { l = 1 !== u("01") } catch (e) { } if (l) try { l = 1 !== u("1.") } catch (e) { } } } } catch (e) { l = !1 } t = l } } return d[e] = !!t } if (!d("json")) { var p = "[object Function]", u = "[object Number]", l = "[object String]", f = "[object Array]", h = d("bug-string-char-index"); if (!c) var m = Math.floor, g = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334], v = function (e, t) { return g[t] + 365 * (e - 1970) + m((e - 1969 + (t = +(t > 1))) / 4) - m((e - 1901 + t) / 100) + m((e - 1601 + t) / 400) }; (t = {}.hasOwnProperty) || (t = function (e) { var n, r = {}; return (r.__proto__ = null, r.__proto__ = { toString: 1 }, r).toString != o ? t = function (e) { var t = this.__proto__, n = e in (this.__proto__ = null, this); return this.__proto__ = t, n } : (n = r.constructor, t = function (e) { var t = (this.constructor || n).prototype; return e in this && !(e in t && this[e] === t[e]) }), r = null, t.call(this, e) }); var y = { boolean: 1, number: 1, string: 1, undefined: 1 }; if (r = function (e, n) { var i, a, s, c = 0; (i = function () { this.valueOf = 0 }).prototype.valueOf = 0, a = new i; for (s in a) t.call(a, s) && c++; return i = a = null, c ? r = 2 == c ? function (e, n) { var r, i = {}, a = o.call(e) == p; for (r in e) a && "prototype" == r || t.call(i, r) || !(i[r] = 1) || !t.call(e, r) || n(r) } : function (e, n) { var r, i, a = o.call(e) == p; for (r in e) a && "prototype" == r || !t.call(e, r) || (i = "constructor" === r) || n(r); (i || t.call(e, r = "constructor")) && n(r) } : (a = ["valueOf", "toString", "toLocaleString", "propertyIsEnumerable", "isPrototypeOf", "hasOwnProperty", "constructor"], r = function (e, n) { var r, i, s, c, d, u = o.call(e) == p, l = u || "function" == typeof e.constructor || ("object" == (d = typeof (s = e)[c = "hasOwnProperty"]) ? !s[c] : y[d]) ? t : e.hasOwnProperty; for (r in e) u && "prototype" == r || !l.call(e, r) || n(r); for (i = a.length; r = a[--i]; l.call(e, r) && n(r)); }), r(e, n) }, !d("json-stringify")) { var w = { 92: "\\\\", 34: '\\"', 8: "\\b", 12: "\\f", 10: "\\n", 13: "\\r", 9: "\\t" }, b = function (e, t) { return ("000000" + (t || 0)).slice(-e) }, C = function (e) { var t, n = '"', r = 0, i = e.length, o = i > 10 && h; for (o && (t = e.split("")); r < i; r++) { var a = e.charCodeAt(r); switch (a) { case 8: case 9: case 10: case 12: case 13: case 34: case 92: n += w[a]; break; default: if (a < 32) { n += "\\u00" + b(2, a.toString(16)); break } n += o ? t[r] : h ? e.charAt(r) : e[r] } } return n + '"' }, S = function (e, n, a, s, c, d, p) { var h, g, y, w, k, T, E, P, x, R, O, D, j, M, _, A; try { h = n[e] } catch (e) { } if ("object" == typeof h && h) if ("[object Date]" != (g = o.call(h)) || t.call(h, "toJSON")) "function" == typeof h.toJSON && (g != u && g != l && g != f || t.call(h, "toJSON")) && (h = h.toJSON(e)); else if (h > -1 / 0 && h < 1 / 0) { if (v) { for (k = m(h / 864e5), y = m(k / 365.2425) + 1970 - 1; v(y + 1, 0) <= k; y++); for (w = m((k - v(y, 0)) / 30.42); v(y, w + 1) <= k; w++); k = 1 + k - v(y, w), E = m((T = (h % 864e5 + 864e5) % 864e5) / 36e5) % 24, P = m(T / 6e4) % 60, x = m(T / 1e3) % 60, R = T % 1e3 } else y = h.getUTCFullYear(), w = h.getUTCMonth(), k = h.getUTCDate(), E = h.getUTCHours(), P = h.getUTCMinutes(), x = h.getUTCSeconds(), R = h.getUTCMilliseconds(); h = (y <= 0 || y >= 1e4 ? (y < 0 ? "-" : "+") + b(6, y < 0 ? -y : y) : b(4, y)) + "-" + b(2, w + 1) + "-" + b(2, k) + "T" + b(2, E) + ":" + b(2, P) + ":" + b(2, x) + "." + b(3, R) + "Z" } else h = null; if (a && (h = a.call(n, e, h)), null === h) return "null"; if ("[object Boolean]" == (g = o.call(h))) return "" + h; if (g == u) return h > -1 / 0 && h < 1 / 0 ? "" + h : "null"; if (g == l) return C("" + h); if ("object" == typeof h) { for (M = p.length; M--;)if (p[M] === h) throw TypeError(); if (p.push(h), O = [], _ = d, d += c, g == f) { for (j = 0, M = h.length; j < M; j++)D = S(j, h, a, s, c, d, p), O.push(D === i ? "null" : D); A = O.length ? c ? "[\n" + d + O.join(",\n" + d) + "\n" + _ + "]" : "[" + O.join(",") + "]" : "[]" } else r(s || h, function (e) { var t = S(e, h, a, s, c, d, p); t !== i && O.push(C(e) + ":" + (c ? " " : "") + t) }), A = O.length ? c ? "{\n" + d + O.join(",\n" + d) + "\n" + _ + "}" : "{" + O.join(",") + "}" : "{}"; return p.pop(), A } }; s.stringify = function (e, t, n) { var r, i, a, s; if ("function" == typeof t || "object" == typeof t && t) if ((s = o.call(t)) == p) i = t; else if (s == f) { a = {}; for (var c, d = 0, h = t.length; d < h; c = t[d++], ((s = o.call(c)) == l || s == u) && (a[c] = 1)); } if (n) if ((s = o.call(n)) == u) { if ((n -= n % 1) > 0) for (r = "", n > 10 && (n = 10); r.length < n; r += " "); } else s == l && (r = n.length <= 10 ? n : n.slice(0, 10)); return S("", ((c = {})[""] = e, c), i, a, r, "", []) } } if (!d("json-parse")) { var k, T, E = String.fromCharCode, P = { 92: "\\", 34: '"', 47: "/", 98: "\b", 116: "\t", 110: "\n", 102: "\f", 114: "\r" }, x = function () { throw k = T = null, SyntaxError() }, R = function () { for (var e, t, n, r, i, o = T, a = o.length; k < a;)switch (i = o.charCodeAt(k)) { case 9: case 10: case 13: case 32: k++; break; case 123: case 125: case 91: case 93: case 58: case 44: return e = h ? o.charAt(k) : o[k], k++ , e; case 34: for (e = "@", k++; k < a;)if ((i = o.charCodeAt(k)) < 32) x(); else if (92 == i) switch (i = o.charCodeAt(++k)) { case 92: case 34: case 47: case 98: case 116: case 110: case 102: case 114: e += P[i], k++; break; case 117: for (t = ++k, n = k + 4; k < n; k++)(i = o.charCodeAt(k)) >= 48 && i <= 57 || i >= 97 && i <= 102 || i >= 65 && i <= 70 || x(); e += E("0x" + o.slice(t, k)); break; default: x() } else { if (34 == i) break; for (i = o.charCodeAt(k), t = k; i >= 32 && 92 != i && 34 != i;)i = o.charCodeAt(++k); e += o.slice(t, k) } if (34 == o.charCodeAt(k)) return k++ , e; x(); default: if (t = k, 45 == i && (r = !0, i = o.charCodeAt(++k)), i >= 48 && i <= 57) { for (48 == i && ((i = o.charCodeAt(k + 1)) >= 48 && i <= 57) && x(), r = !1; k < a && ((i = o.charCodeAt(k)) >= 48 && i <= 57); k++); if (46 == o.charCodeAt(k)) { for (n = ++k; n < a && ((i = o.charCodeAt(n)) >= 48 && i <= 57); n++); n == k && x(), k = n } if (101 == (i = o.charCodeAt(k)) || 69 == i) { for (43 != (i = o.charCodeAt(++k)) && 45 != i || k++ , n = k; n < a && ((i = o.charCodeAt(n)) >= 48 && i <= 57); n++); n == k && x(), k = n } return +o.slice(t, k) } if (r && x(), "true" == o.slice(k, k + 4)) return k += 4, !0; if ("false" == o.slice(k, k + 5)) return k += 5, !1; if ("null" == o.slice(k, k + 4)) return k += 4, null; x() }return "$" }, O = function (e) { var t, n; if ("$" == e && x(), "string" == typeof e) { if ("@" == (h ? e.charAt(0) : e[0])) return e.slice(1); if ("[" == e) { for (t = []; "]" != (e = R()); n || (n = !0))n && ("," == e ? "]" == (e = R()) && x() : x()), "," == e && x(), t.push(O(e)); return t } if ("{" == e) { for (t = {}; "}" != (e = R()); n || (n = !0))n && ("," == e ? "}" == (e = R()) && x() : x()), "," != e && "string" == typeof e && "@" == (h ? e.charAt(0) : e[0]) && ":" == R() || x(), t[e.slice(1)] = O(R()); return t } x() } return e }, D = function (e, t, n) { var r = j(e, t, n); r === i ? delete e[t] : e[t] = r }, j = function (e, t, n) { var i, a = e[t]; if ("object" == typeof a && a) if (o.call(a) == f) for (i = a.length; i--;)D(a, i, n); else r(a, function (e) { D(a, e, n) }); return n.call(e, t, a) }; s.parse = function (e, t) { var n, r; return k = 0, T = "" + e, n = O(R()), "$" != R() && x(), k = T = null, t && o.call(t) == p ? j(((r = {})[""] = n, r), "", t) : n } } } }(this) }, {}], 46: [function (e, t, n) { var r = e("util"), i = e("hark"), o = e("webrtcsupport"), a = e("getusermedia"), s = e("getscreenmedia"), c = e("wildemitter"), d = e("mediastream-gain"), p = e("mockconsole"); function u(e) { var t = !0; return e.getTracks().forEach(function (e) { t = "ended" === e.readyState && t }), t } function l(e) { c.call(this); var t, n = this.config = { autoAdjustMic: !1, detectSpeakingEvents: !1, audioFallback: !1, media: { audio: !0, video: !0 }, logger: p }; for (t in e) e.hasOwnProperty(t) && (this.config[t] = e[t]); this.logger = n.logger, this._log = this.logger.log.bind(this.logger, "LocalMedia:"), this._logerror = this.logger.error.bind(this.logger, "LocalMedia:"), this.screenSharingSupport = o.supportScreenSharing, this.localStreams = [], this.localScreens = [], o.supportGetUserMedia || this._logerror("Your browser does not support local media capture.") } r.inherits(l, c), l.prototype.start = function (e, t) { var n = this, r = e || this.config.media; a(r, function (e, i) { if (e) { if (n.config.audioFallback && "DevicesNotFoundError" === e.name && !1 !== r.video) return r.video = !1, void n.start(r, t) } else r.audio && n.config.detectSpeakingEvents && n.setupAudioMonitor(i, n.config.harkOptions), n.localStreams.push(i), n.config.autoAdjustMic && (n.gainController = new d(i), n.setMicIfEnabled(.5)), i.getTracks().forEach(function (e) { e.addEventListener("ended", function () { u(i) && n.emit("localStreamStopped", i) }) }), n.emit("localStream", i); if (t) return t(e, i) }) }, l.prototype.stop = function (e) { if (e) { e.getTracks().forEach(function (e) { e.stop() }); var t = this.localStreams.indexOf(e); t > -1 ? (this.localStreams.splice(t, 1), "moz" === o.prefix && this.emit("localStreamStopped", e)) : (t = this.localScreens.indexOf(e)) > -1 && (this.localScreens.splice(t, 1), "moz" === o.prefix && this.emit("localScreenStopped", e)) } else this.stopStreams(), this.stopScreenShare() }, l.prototype.stopStreams = function () { var e = this; this.audioMonitor && (this.audioMonitor.stop(), delete this.audioMonitor); var t = this.localStreams; this.localStreams = [], t.forEach(function (t) { t.getTracks().forEach(function (e) { e.stop() }), "moz" === o.prefix && e.emit("localStreamStopped", t) }) }, l.prototype.startScreenShare = function (e) { var t = this; s(function (n, r) { if (n || (t.localScreens.push(r), r.getTracks().forEach(function (e) { e.addEventListener("ended", function () { u(r) && t.emit("localScreenStopped", r) }) }), t.emit("localScreen", r)), e) return e(n, r) }) }, l.prototype.stopScreenShare = function (e) { var t = this; if (e) { e.getTracks().forEach(function (e) { e.stop() }); var n = this.localScreens.indexOf(e); n > -1 && (this.localScreens.splice(n, 1), "moz" === o.prefix && this.emit("localScreenStopped", e)) } else { var r = this.localScreens; this.localScreens = [], r.forEach(function (e) { e.getTracks().forEach(function (e) { e.stop() }), "moz" === o.prefix && t.emit("localScreenStopped", e) }) } }, l.prototype.mute = function () { this._audioEnabled(!1), this.hardMuted = !0, this.emit("audioOff") }, l.prototype.unmute = function () { this._audioEnabled(!0), this.hardMuted = !1, this.emit("audioOn") }, l.prototype.setupAudioMonitor = function (e, t) { this._log("Setup audio"); var n, r = this.audioMonitor = i(e, t), o = this; r.on("speaking", function () { o.emit("speaking"), o.hardMuted || o.setMicIfEnabled(1) }), r.on("stopped_speaking", function () { n && clearTimeout(n), n = setTimeout(function () { o.emit("stoppedSpeaking"), o.hardMuted || o.setMicIfEnabled(.5) }, 1e3) }), r.on("volume_change", function (e, t) { o.emit("volumeChange", e, t) }) }, l.prototype.setMicIfEnabled = function (e) { this.config.autoAdjustMic && this.gainController.setGain(e) }, l.prototype.pauseVideo = function () { this._videoEnabled(!1), this.emit("videoOff") }, l.prototype.resumeVideo = function () { this._videoEnabled(!0), this.emit("videoOn") }, l.prototype.pause = function () { this.mute(), this.pauseVideo() }, l.prototype.resume = function () { this.unmute(), this.resumeVideo() }, l.prototype._audioEnabled = function (e) { this.setMicIfEnabled(e ? 1 : 0), this.localStreams.forEach(function (t) { t.getAudioTracks().forEach(function (t) { t.enabled = !!e }) }) }, l.prototype._videoEnabled = function (e) { this.localStreams.forEach(function (t) { t.getVideoTracks().forEach(function (t) { t.enabled = !!e }) }) }, l.prototype.isAudioEnabled = function () { var e = !0; return this.localStreams.forEach(function (t) { t.getAudioTracks().forEach(function (t) { e = e && t.enabled }) }), e }, l.prototype.isVideoEnabled = function () { var e = !0; return this.localStreams.forEach(function (t) { t.getVideoTracks().forEach(function (t) { e = e && t.enabled }) }), e }, l.prototype.startLocalMedia = l.prototype.start, l.prototype.stopLocalMedia = l.prototype.stop, Object.defineProperty(l.prototype, "localStream", { get: function () { return this.localStreams.length > 0 ? this.localStreams[0] : null } }), Object.defineProperty(l.prototype, "localScreen", { get: function () { return this.localScreens.length > 0 ? this.localScreens[0] : null } }), t.exports = l }, { getscreenmedia: 27, getusermedia: 29, hark: 40, "mediastream-gain": 48, mockconsole: 50, util: 89, webrtcsupport: 99, wildemitter: 100 }], 47: [function (e, t, n) { (function (e) { var r = 200, i = "__lodash_hash_undefined__", o = 9007199254740991, a = "[object Arguments]", s = "[object Boolean]", c = "[object Date]", d = "[object Function]", p = "[object GeneratorFunction]", u = "[object Map]", l = "[object Number]", f = "[object Object]", h = "[object Promise]", m = "[object RegExp]", g = "[object Set]", v = "[object String]", y = "[object Symbol]", w = "[object WeakMap]", b = "[object ArrayBuffer]", C = "[object DataView]", S = "[object Float32Array]", k = "[object Float64Array]", T = "[object Int8Array]", E = "[object Int16Array]", P = "[object Int32Array]", x = "[object Uint8Array]", R = "[object Uint8ClampedArray]", O = "[object Uint16Array]", D = "[object Uint32Array]", j = /\w*$/, M = /^\[object .+?Constructor\]$/, _ = /^(?:0|[1-9]\d*)$/, A = {}; A[a] = A["[object Array]"] = A[b] = A[C] = A[s] = A[c] = A[S] = A[k] = A[T] = A[E] = A[P] = A[u] = A[l] = A[f] = A[m] = A[g] = A[v] = A[y] = A[x] = A[R] = A[O] = A[D] = !0, A["[object Error]"] = A[d] = A[w] = !1; var I = "object" == typeof e && e && e.Object === Object && e, L = "object" == typeof self && self && self.Object === Object && self, N = I || L || Function("return this")(), B = "object" == typeof n && n && !n.nodeType && n, U = B && "object" == typeof t && t && !t.nodeType && t, F = U && U.exports === B; function G(e, t) { return e.set(t[0], t[1]), e } function z(e, t) { return e.add(t), e } function V(e, t, n, r) { var i = -1, o = e ? e.length : 0; for (r && o && (n = e[++i]); ++i < o;)n = t(n, e[i], i, e); return n } function J(e) { var t = !1; if (null != e && "function" != typeof e.toString) try { t = !!(e + "") } catch (e) { } return t } function q(e) { var t = -1, n = Array(e.size); return e.forEach(function (e, r) { n[++t] = [r, e] }), n } function H(e, t) { return function (n) { return e(t(n)) } } function W(e) { var t = -1, n = Array(e.size); return e.forEach(function (e) { n[++t] = e }), n } var X, $ = Array.prototype, Y = Function.prototype, K = Object.prototype, Z = N["__core-js_shared__"], Q = (X = /[^.]+$/.exec(Z && Z.keys && Z.keys.IE_PROTO || "")) ? "Symbol(src)_1." + X : "", ee = Y.toString, te = K.hasOwnProperty, ne = K.toString, re = RegExp("^" + ee.call(te).replace(/[\\^$.*+?()[\]{}|]/g, "\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, "$1.*?") + "$"), ie = F ? N.Buffer : void 0, oe = N.Symbol, ae = N.Uint8Array, se = H(Object.getPrototypeOf, Object), ce = Object.create, de = K.propertyIsEnumerable, pe = $.splice, ue = Object.getOwnPropertySymbols, le = ie ? ie.isBuffer : void 0, fe = H(Object.keys, Object), he = Ue(N, "DataView"), me = Ue(N, "Map"), ge = Ue(N, "Promise"), ve = Ue(N, "Set"), ye = Ue(N, "WeakMap"), we = Ue(Object, "create"), be = Je(he), Ce = Je(me), Se = Je(ge), ke = Je(ve), Te = Je(ye), Ee = oe ? oe.prototype : void 0, Pe = Ee ? Ee.valueOf : void 0; function xe(e) { var t = -1, n = e ? e.length : 0; for (this.clear(); ++t < n;) { var r = e[t]; this.set(r[0], r[1]) } } function Re(e) { var t = -1, n = e ? e.length : 0; for (this.clear(); ++t < n;) { var r = e[t]; this.set(r[0], r[1]) } } function Oe(e) { var t = -1, n = e ? e.length : 0; for (this.clear(); ++t < n;) { var r = e[t]; this.set(r[0], r[1]) } } function De(e) { this.__data__ = new Re(e) } function je(e, t) { var n, r, i, o = He(e) || (i = r = n = e) && "object" == typeof i && We(r) && te.call(n, "callee") && (!de.call(n, "callee") || ne.call(n) == a) ? function (e, t) { for (var n = -1, r = Array(e); ++n < e;)r[n] = t(n); return r }(e.length, String) : [], s = o.length, c = !!s; for (var d in e) !t && !te.call(e, d) || c && ("length" == d || ze(d, s)) || o.push(d); return o } function Me(e, t, n) { var r = e[t]; te.call(e, t) && qe(r, n) && (void 0 !== n || t in e) || (e[t] = n) } function _e(e, t) { for (var n = e.length; n--;)if (qe(e[n][0], t)) return n; return -1 } function Ae(e, t, n, r, i, o, h) { var w; if (r && (w = o ? r(e, i, o, h) : r(e)), void 0 !== w) return w; if (!Ye(e)) return e; var M, _, I, L, N, B, U = He(e); if (U) { if (w = function (e) { var t = e.length, n = e.constructor(t); t && "string" == typeof e[0] && te.call(e, "index") && (n.index = e.index, n.input = e.input); return n }(e), !t) return function (e, t) { var n = -1, r = e.length; t || (t = Array(r)); for (; ++n < r;)t[n] = e[n]; return t }(e, w) } else { var F = Ge(e), H = F == d || F == p; if (Xe(e)) return function (e, t) { if (t) return e.slice(); var n = new e.constructor(e.length); return e.copy(n), n }(e, t); if (F == f || F == a || H && !o) { if (J(e)) return o ? e : {}; if (w = "function" != typeof (N = H ? {} : e).constructor || Ve(N) ? {} : Ye(B = se(N)) ? ce(B) : {}, !t) return M = e, L = e, _ = (I = w) && Ne(L, Ke(L), I), Ne(M, Fe(M), _) } else { if (!A[F]) return o ? e : {}; w = function (e, t, n, r) { var i = e.constructor; switch (t) { case b: return Le(e); case s: case c: return new i(+e); case C: return M = e, _ = r ? Le(M.buffer) : M.buffer, new M.constructor(_, M.byteOffset, M.byteLength); case S: case k: case T: case E: case P: case x: case R: case O: case D: return h = e, w = r ? Le(h.buffer) : h.buffer, new h.constructor(w, h.byteOffset, h.length); case u: return f = e, V(r ? n(q(f), !0) : q(f), G, new f.constructor); case l: case v: return new i(e); case m: return (p = new (d = e).constructor(d.source, j.exec(d))).lastIndex = d.lastIndex, p; case g: return a = e, V(r ? n(W(a), !0) : W(a), z, new a.constructor); case y: return o = e, Pe ? Object(Pe.call(o)) : {} }var o; var a; var d, p; var f; var h, w; var M, _ }(e, F, Ae, t) } } h || (h = new De); var X, $, Y, K = h.get(e); if (K) return K; if (h.set(e, w), !U) var Z = n ? ($ = Fe, Y = Ke(X = e), He(X) ? Y : function (e, t) { for (var n = -1, r = t.length, i = e.length; ++n < r;)e[i + n] = t[n]; return e }(Y, $(X))) : Ke(e); return function (e, t) { for (var n = -1, r = e ? e.length : 0; ++n < r && !1 !== t(e[n], n, e);); }(Z || e, function (i, o) { Z && (i = e[o = i]), Me(w, o, Ae(i, t, n, r, o, e, h)) }), w } function Ie(e) { return !(!Ye(e) || Q && Q in e) && ($e(e) || J(e) ? re : M).test(Je(e)) } function Le(e) { var t = new e.constructor(e.byteLength); return new ae(t).set(new ae(e)), t } function Ne(e, t, n, r) { n || (n = {}); for (var i = -1, o = t.length; ++i < o;) { var a = t[i], s = r ? r(n[a], e[a], a, n, e) : void 0; Me(n, a, void 0 === s ? e[a] : s) } return n } function Be(e, t) { var n, r, i = e.__data__; return ("string" == (r = typeof (n = t)) || "number" == r || "symbol" == r || "boolean" == r ? "__proto__" !== n : null === n) ? i["string" == typeof t ? "string" : "hash"] : i.map } function Ue(e, t) { var n, r = null == (n = e) ? void 0 : n[t]; return Ie(r) ? r : void 0 } xe.prototype.clear = function () { this.__data__ = we ? we(null) : {} }, xe.prototype.delete = function (e) { return this.has(e) && delete this.__data__[e] }, xe.prototype.get = function (e) { var t = this.__data__; if (we) { var n = t[e]; return n === i ? void 0 : n } return te.call(t, e) ? t[e] : void 0 }, xe.prototype.has = function (e) { var t = this.__data__; return we ? void 0 !== t[e] : te.call(t, e) }, xe.prototype.set = function (e, t) { return this.__data__[e] = we && void 0 === t ? i : t, this }, Re.prototype.clear = function () { this.__data__ = [] }, Re.prototype.delete = function (e) { var t = this.__data__, n = _e(t, e); return !(n < 0 || (n == t.length - 1 ? t.pop() : pe.call(t, n, 1), 0)) }, Re.prototype.get = function (e) { var t = this.__data__, n = _e(t, e); return n < 0 ? void 0 : t[n][1] }, Re.prototype.has = function (e) { return _e(this.__data__, e) > -1 }, Re.prototype.set = function (e, t) { var n = this.__data__, r = _e(n, e); return r < 0 ? n.push([e, t]) : n[r][1] = t, this }, Oe.prototype.clear = function () { this.__data__ = { hash: new xe, map: new (me || Re), string: new xe } }, Oe.prototype.delete = function (e) { return Be(this, e).delete(e) }, Oe.prototype.get = function (e) { return Be(this, e).get(e) }, Oe.prototype.has = function (e) { return Be(this, e).has(e) }, Oe.prototype.set = function (e, t) { return Be(this, e).set(e, t), this }, De.prototype.clear = function () { this.__data__ = new Re }, De.prototype.delete = function (e) { return this.__data__.delete(e) }, De.prototype.get = function (e) { return this.__data__.get(e) }, De.prototype.has = function (e) { return this.__data__.has(e) }, De.prototype.set = function (e, t) { var n = this.__data__; if (n instanceof Re) { var i = n.__data__; if (!me || i.length < r - 1) return i.push([e, t]), this; n = this.__data__ = new Oe(i) } return n.set(e, t), this }; var Fe = ue ? H(ue, Object) : function () { return [] }, Ge = function (e) { return ne.call(e) }; function ze(e, t) { return !!(t = null == t ? o : t) && ("number" == typeof e || _.test(e)) && e > -1 && e % 1 == 0 && e < t } function Ve(e) { var t = e && e.constructor; return e === ("function" == typeof t && t.prototype || K) } function Je(e) { if (null != e) { try { return ee.call(e) } catch (e) { } try { return e + "" } catch (e) { } } return "" } function qe(e, t) { return e === t || e != e && t != t } (he && Ge(new he(new ArrayBuffer(1))) != C || me && Ge(new me) != u || ge && Ge(ge.resolve()) != h || ve && Ge(new ve) != g || ye && Ge(new ye) != w) && (Ge = function (e) { var t = ne.call(e), n = t == f ? e.constructor : void 0, r = n ? Je(n) : void 0; if (r) switch (r) { case be: return C; case Ce: return u; case Se: return h; case ke: return g; case Te: return w }return t }); var He = Array.isArray; function We(e) { return null != e && ("number" == typeof (t = e.length) && t > -1 && t % 1 == 0 && t <= o) && !$e(e); var t } var Xe = le || function () { return !1 }; function $e(e) { var t = Ye(e) ? ne.call(e) : ""; return t == d || t == p } function Ye(e) { var t = typeof e; return !!e && ("object" == t || "function" == t) } function Ke(e) { return We(e) ? je(e) : function (e) { if (!Ve(e)) return fe(e); var t = []; for (var n in Object(e)) te.call(e, n) && "constructor" != n && t.push(n); return t }(e) } t.exports = function (e) { return Ae(e, !0, !0) } }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, {}], 48: [function (e, t, n) { var r = e("webrtcsupport"); function i(e) { if (this.support = r.webAudio && r.mediaStream, this.gain = 1, this.support) { var t = this.context = new r.AudioContext; this.microphone = t.createMediaStreamSource(e), this.gainFilter = t.createGain(), this.destination = t.createMediaStreamDestination(), this.outputStream = this.destination.stream, this.microphone.connect(this.gainFilter), this.gainFilter.connect(this.destination), e.addTrack(this.outputStream.getAudioTracks()[0]), e.removeTrack(e.getAudioTracks()[0]) } this.stream = e } i.prototype.setGain = function (e) { this.support && (this.gainFilter.gain.value = e, this.gain = e) }, i.prototype.getGain = function () { return this.gain }, i.prototype.off = function () { return this.setGain(0) }, i.prototype.on = function () { this.setGain(1) }, t.exports = i }, { webrtcsupport: 49 }], 49: [function (e, t, n) { var r, i; window.mozRTCPeerConnection || navigator.mozGetUserMedia ? (r = "moz", i = parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1], 10)) : (window.webkitRTCPeerConnection || navigator.webkitGetUserMedia) && (r = "webkit", i = navigator.userAgent.match(/Chrom(e|ium)/) && parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2], 10)); var o = window.mozRTCPeerConnection || window.webkitRTCPeerConnection, a = window.mozRTCIceCandidate || window.RTCIceCandidate, s = window.mozRTCSessionDescription || window.RTCSessionDescription, c = window.webkitMediaStream || window.MediaStream, d = "https:" === window.location.protocol && ("webkit" === r && i >= 26 || "moz" === r && i >= 33), p = window.AudioContext || window.webkitAudioContext, u = document.createElement("video"), l = u && u.canPlayType && "probably" === u.canPlayType('video/webm; codecs="vp8", vorbis'), f = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.msGetUserMedia || navigator.mozGetUserMedia; t.exports = { prefix: r, browserVersion: i, support: !!o && l && !!f, supportRTCPeerConnection: !!o, supportVp8: l, supportGetUserMedia: !!f, supportDataChannel: !!(o && o.prototype && o.prototype.createDataChannel), supportWebAudio: !(!p || !p.prototype.createMediaStreamSource), supportMediaStream: !(!c || !c.prototype.removeTrack), supportScreenSharing: !!d, dataChannel: !!(o && o.prototype && o.prototype.createDataChannel), webAudio: !(!p || !p.prototype.createMediaStreamSource), mediaStream: !(!c || !c.prototype.removeTrack), screenSharing: !!d, AudioContext: p, PeerConnection: o, SessionDescription: s, IceCandidate: a, MediaStream: c, getUserMedia: f } }, {}], 50: [function (e, t, n) { for (var r = "assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","), i = r.length, o = function () { }, a = {}; i--;)a[r[i]] = o; t.exports = a }, {}], 51: [function (e, t, n) { var r = Object.prototype.hasOwnProperty; n.keys = Object.keys || function (e) { var t = []; for (var n in e) r.call(e, n) && t.push(n); return t }, n.values = function (e) { var t = []; for (var n in e) r.call(e, n) && t.push(e[n]); return t }, n.merge = function (e, t) { for (var n in t) r.call(t, n) && (e[n] = t[n]); return e }, n.length = function (e) { return n.keys(e).length }, n.isEmpty = function (e) { return 0 == n.length(e) } }, {}], 52: [function (e, t, n) { (function (e) { var n = /^[\],:{}\s]*$/, r = /\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, i = /"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, o = /(?:^|:|,)(?:\s*\[)+/g, a = /^\s+/, s = /\s+$/; t.exports = function (t) { return "string" == typeof t && t ? (t = t.replace(a, "").replace(s, ""), e.JSON && JSON.parse ? JSON.parse(t) : n.test(t.replace(r, "@").replace(i, "]").replace(o, "")) ? new Function("return " + t)() : void 0) : null } }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, {}], 53: [function (e, t, n) { n.encode = function (e) { var t = ""; for (var n in e) e.hasOwnProperty(n) && (t.length && (t += "&"), t += encodeURIComponent(n) + "=" + encodeURIComponent(e[n])); return t }, n.decode = function (e) { for (var t = {}, n = e.split("&"), r = 0, i = n.length; r < i; r++) { var o = n[r].split("="); t[decodeURIComponent(o[0])] = decodeURIComponent(o[1]) } return t } }, {}], 54: [function (e, t, n) { var r = /^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/, i = ["source", "protocol", "authority", "userInfo", "user", "password", "host", "port", "relative", "path", "directory", "file", "query", "anchor"]; t.exports = function (e) { for (var t = r.exec(e || ""), n = {}, o = 14; o--;)n[i[o]] = t[o] || ""; return n } }, {}], 55: [function (e, t, n) { var r, i, o = t.exports = {}; function a() { throw new Error("setTimeout has not been defined") } function s() { throw new Error("clearTimeout has not been defined") } function c(e) { if (r === setTimeout) return setTimeout(e, 0); if ((r === a || !r) && setTimeout) return r = setTimeout, setTimeout(e, 0); try { return r(e, 0) } catch (t) { try { return r.call(null, e, 0) } catch (t) { return r.call(this, e, 0) } } } !function () { try { r = "function" == typeof setTimeout ? setTimeout : a } catch (e) { r = a } try { i = "function" == typeof clearTimeout ? clearTimeout : s } catch (e) { i = s } }(); var d, p = [], u = !1, l = -1; function f() { u && d && (u = !1, d.length ? p = d.concat(p) : l = -1, p.length && h()) } function h() { if (!u) { var e = c(f); u = !0; for (var t = p.length; t;) { for (d = p, p = []; ++l < t;)d && d[l].run(); l = -1, t = p.length } d = null, u = !1, function (e) { if (i === clearTimeout) return clearTimeout(e); if ((i === s || !i) && clearTimeout) return i = clearTimeout, clearTimeout(e); try { i(e) } catch (t) { try { return i.call(null, e) } catch (t) { return i.call(this, e) } } }(e) } } function m(e, t) { this.fun = e, this.array = t } function g() { } o.nextTick = function (e) { var t = new Array(arguments.length - 1); if (arguments.length > 1) for (var n = 1; n < arguments.length; n++)t[n - 1] = arguments[n]; p.push(new m(e, t)), 1 !== p.length || u || c(h) }, m.prototype.run = function () { this.fun.apply(null, this.array) }, o.title = "browser", o.browser = !0, o.env = {}, o.argv = [], o.version = "", o.versions = {}, o.on = g, o.addListener = g, o.once = g, o.off = g, o.removeListener = g, o.removeAllListeners = g, o.emit = g, o.binding = function (e) { throw new Error("process.binding is not supported") }, o.cwd = function () { return "/" }, o.chdir = function (e) { throw new Error("process.chdir is not supported") }, o.umask = function () { return 0 } }, {}], 56: [function (e, t, n) { var r = e("util"), i = e("sdp-jingle-json"), o = e("wildemitter"), a = e("traceablepeerconnection"), s = e("webrtc-adapter"), c = e("lodash.clonedeep"); function d(e, t) { var n, r = this; o.call(this), (e = e || {}).iceServers = e.iceServers || []; var i = s.browserDetails.browser; this.enableChromeNativeSimulcast = !1, t && t.optional && "chrome" === i && null === navigator.appVersion.match(/Chromium\//) && t.optional.forEach(function (e) { e.enableChromeNativeSimulcast && (r.enableChromeNativeSimulcast = !0) }), this.enableMultiStreamHacks = !1, t && t.optional && "chrome" === i && t.optional.forEach(function (e) { e.enableMultiStreamHacks && (r.enableMultiStreamHacks = !0) }), this.restrictBandwidth = 0, t && t.optional && t.optional.forEach(function (e) { e.andyetRestrictBandwidth && (r.restrictBandwidth = e.andyetRestrictBandwidth) }), this.batchIceCandidates = 0, t && t.optional && t.optional.forEach(function (e) { e.andyetBatchIce && (r.batchIceCandidates = e.andyetBatchIce) }), this.batchedIceCandidates = [], t && t.optional && "chrome" === i && t.optional.forEach(function (e) { e.andyetFasterICE && (r.eliminateDuplicateCandidates = e.andyetFasterICE) }), t && t.optional && t.optional.forEach(function (e) { e.andyetDontSignalCandidates && (r.dontSignalCandidates = e.andyetDontSignalCandidates) }), this.assumeSetLocalSuccess = !1, t && t.optional && t.optional.forEach(function (e) { e.andyetAssumeSetLocalSuccess && (r.assumeSetLocalSuccess = e.andyetAssumeSetLocalSuccess) }), "firefox" === i && t && t.optional && (this.wtFirefox = 0, t.optional.forEach(function (e) { e.andyetFirefoxMakesMeSad && (r.wtFirefox = e.andyetFirefoxMakesMeSad, r.wtFirefox > 0 && (r.firefoxcandidatebuffer = [])) })), this.pc = new a(e, t), this.getLocalStreams = this.pc.getLocalStreams.bind(this.pc), this.getRemoteStreams = this.pc.getRemoteStreams.bind(this.pc), this.addStream = this.pc.addStream.bind(this.pc), this.removeStream = this.pc.removeStream.bind(this.pc), this.pc.on("*", function () { r.emit.apply(r, arguments) }), this.pc.onremovestream = this.emit.bind(this, "removeStream"), this.pc.onaddstream = this.emit.bind(this, "addStream"), this.pc.onnegotiationneeded = this.emit.bind(this, "negotiationNeeded"), this.pc.oniceconnectionstatechange = this.emit.bind(this, "iceConnectionStateChange"), this.pc.onsignalingstatechange = this.emit.bind(this, "signalingStateChange"), this.pc.onicecandidate = this._onIce.bind(this), this.pc.ondatachannel = this._onDataChannel.bind(this), this.localDescription = { contents: [] }, this.remoteDescription = { contents: [] }, this.config = { debug: !1, sid: "", isInitiator: !0, sdpSessionID: Date.now(), useJingle: !1 }, this.iceCredentials = { local: {}, remote: {} }; for (n in e) this.config[n] = e[n]; this.config.debug && this.on("*", function () { (e.logger || console).log("PeerConnection event:", arguments) }), this.hadLocalStunCandidate = !1, this.hadRemoteStunCandidate = !1, this.hadLocalRelayCandidate = !1, this.hadRemoteRelayCandidate = !1, this.hadLocalIPv6Candidate = !1, this.hadRemoteIPv6Candidate = !1, this._remoteDataChannels = [], this._localDataChannels = [], this._candidateBuffer = [] } r.inherits(d, o), Object.defineProperty(d.prototype, "signalingState", { get: function () { return this.pc.signalingState } }), Object.defineProperty(d.prototype, "iceConnectionState", { get: function () { return this.pc.iceConnectionState } }), d.prototype._role = function () { return this.isInitiator ? "initiator" : "responder" }, d.prototype.addStream = function (e) { this.localStream = e, this.pc.addStream(e) }, d.prototype._checkLocalCandidate = function (e) { var t = i.toCandidateJSON(e); "srflx" == t.type ? this.hadLocalStunCandidate = !0 : "relay" == t.type && (this.hadLocalRelayCandidate = !0), -1 != t.ip.indexOf(":") && (this.hadLocalIPv6Candidate = !0) }, d.prototype._checkRemoteCandidate = function (e) { var t = i.toCandidateJSON(e); "srflx" == t.type ? this.hadRemoteStunCandidate = !0 : "relay" == t.type && (this.hadRemoteRelayCandidate = !0), -1 != t.ip.indexOf(":") && (this.hadRemoteIPv6Candidate = !0) }, d.prototype.processIce = function (e, t) { t = t || function () { }; var n = this; if ("closed" === this.pc.signalingState) return t(); if (e.contents || e.jingle && e.jingle.contents) { var r = this.remoteDescription.contents.map(function (e) { return e.name }); (e.contents || e.jingle.contents).forEach(function (e) { var o = e.transport || {}, a = o.candidates || [], s = r.indexOf(e.name), c = e.name, d = n.remoteDescription.contents.find(function (t) { return t.name === e.name }), p = function () { a.forEach(function (e) { var t = i.toCandidateSDP(e) + "\r\n"; n.pc.addIceCandidate(new RTCIceCandidate({ candidate: t, sdpMLineIndex: s, sdpMid: c }), function () { }, function (e) { n.emit("error", e) }), n._checkRemoteCandidate(t) }), t() }; if (n.iceCredentials.remote[e.name] && o.ufrag && n.iceCredentials.remote[e.name].ufrag !== o.ufrag) if (d) { d.transport.ufrag = o.ufrag, d.transport.pwd = o.pwd; var u = { type: "offer", jingle: n.remoteDescription }; u.sdp = i.toSessionSDP(u.jingle, { sid: n.config.sdpSessionID, role: n._role(), direction: "incoming" }), n.pc.setRemoteDescription(new RTCSessionDescription(u), function () { p() }, function (e) { n.emit("error", e) }) } else n.emit("error", "ice restart failed to find matching content"); else p() }) } else { if (e.candidate && 0 !== e.candidate.candidate.indexOf("a=") && (e.candidate.candidate = "a=" + e.candidate.candidate), this.wtFirefox && null !== this.firefoxcandidatebuffer && this.pc.localDescription && "offer" === this.pc.localDescription.type) return this.firefoxcandidatebuffer.push(e.candidate), t(); n.pc.addIceCandidate(new RTCIceCandidate(e.candidate), function () { }, function (e) { n.emit("error", e) }), n._checkRemoteCandidate(e.candidate.candidate), t() } }, d.prototype.offer = function (e, t) { var n = this, r = 2 === arguments.length, o = r && e ? e : { offerToReceiveAudio: 1, offerToReceiveVideo: 1 }; if (t = (t = r ? t : e) || function () { }, "closed" === this.pc.signalingState) return t("Already closed"); this.pc.createOffer(function (e) { var r = { type: "offer", sdp: e.sdp }; n.assumeSetLocalSuccess && (n.emit("offer", r), t(null, r)), n._candidateBuffer = [], n.pc.setLocalDescription(e, function () { var o; n.config.useJingle && ((o = i.toSessionJSON(e.sdp, { role: n._role(), direction: "outgoing" })).sid = n.config.sid, n.localDescription = o, o.contents.forEach(function (e) { var t = e.transport || {}; t.ufrag && (n.iceCredentials.local[e.name] = { ufrag: t.ufrag, pwd: t.pwd }) }), r.jingle = o), r.sdp.split("\r\n").forEach(function (e) { 0 === e.indexOf("a=candidate:") && n._checkLocalCandidate(e) }), n.assumeSetLocalSuccess || (n.emit("offer", r), t(null, r)) }, function (e) { n.emit("error", e), t(e) }) }, function (e) { n.emit("error", e), t(e) }, o) }, d.prototype.handleOffer = function (e, t) { t = t || function () { }; var n = this; if (e.type = "offer", e.jingle) { if (this.enableChromeNativeSimulcast && e.jingle.contents.forEach(function (e) { "video" === e.name && (e.application.googConferenceFlag = !0) }), this.enableMultiStreamHacks && e.jingle.contents.forEach(function (e) { if ("video" === e.name) { var t = e.application.sources || []; 0 !== t.length && "3735928559" === t[0].ssrc || (t.unshift({ ssrc: "3735928559", parameters: [{ key: "cname", value: "deadbeef" }, { key: "msid", value: "mixyourfecintothis please" }] }), e.application.sources = t) } }), n.restrictBandwidth > 0 && e.jingle.contents.length >= 2 && "video" === e.jingle.contents[1].name) { var r = e.jingle.contents[1]; r.application && r.application.bandwidth && r.application.bandwidth.bandwidth || (e.jingle.contents[1].application.bandwidth = { type: "AS", bandwidth: n.restrictBandwidth.toString() }, e.sdp = i.toSessionSDP(e.jingle, { sid: n.config.sdpSessionID, role: n._role(), direction: "outgoing" })) } e.jingle.contents.forEach(function (e) { var t = e.transport || {}; t.ufrag && (n.iceCredentials.remote[e.name] = { ufrag: t.ufrag, pwd: t.pwd }) }), e.sdp = i.toSessionSDP(e.jingle, { sid: n.config.sdpSessionID, role: n._role(), direction: "incoming" }), n.remoteDescription = e.jingle } e.sdp.split("\r\n").forEach(function (e) { 0 === e.indexOf("a=candidate:") && n._checkRemoteCandidate(e) }), n.pc.setRemoteDescription(new RTCSessionDescription(e), function () { t() }, t) }, d.prototype.answerAudioOnly = function (e) { this._answer({ mandatory: { OfferToReceiveAudio: !0, OfferToReceiveVideo: !1 } }, e) }, d.prototype.answerBroadcastOnly = function (e) { this._answer({ mandatory: { OfferToReceiveAudio: !1, OfferToReceiveVideo: !1 } }, e) }, d.prototype.answer = function (e, t) { var n = 2 === arguments.length, r = n ? t : e, i = n && e ? e : { mandatory: { OfferToReceiveAudio: !0, OfferToReceiveVideo: !0 } }; this._answer(i, r) }, d.prototype.handleAnswer = function (e, t) { t = t || function () { }; var n = this; e.jingle && (e.sdp = i.toSessionSDP(e.jingle, { sid: n.config.sdpSessionID, role: n._role(), direction: "incoming" }), n.remoteDescription = e.jingle, e.jingle.contents.forEach(function (e) { var t = e.transport || {}; t.ufrag && (n.iceCredentials.remote[e.name] = { ufrag: t.ufrag, pwd: t.pwd }) })), e.sdp.split("\r\n").forEach(function (e) { 0 === e.indexOf("a=candidate:") && n._checkRemoteCandidate(e) }), n.pc.setRemoteDescription(new RTCSessionDescription(e), function () { n.wtFirefox && window.setTimeout(function () { n.firefoxcandidatebuffer.forEach(function (e) { n.pc.addIceCandidate(new RTCIceCandidate(e), function () { }, function (e) { n.emit("error", e) }), n._checkRemoteCandidate(e.candidate) }), n.firefoxcandidatebuffer = null }, n.wtFirefox), t(null) }, t) }, d.prototype.close = function () { this.pc.close(), this._localDataChannels = [], this._remoteDataChannels = [], this.emit("close") }, d.prototype._answer = function (e, t) { t = t || function () { }; var n = this; if (!this.pc.remoteDescription) throw new Error("remoteDescription not set"); if ("closed" === this.pc.signalingState) return t("Already closed"); n.pc.createAnswer(function (e) { var r = []; if (n.enableChromeNativeSimulcast && (e.jingle = i.toSessionJSON(e.sdp, { role: n._role(), direction: "outgoing" }), e.jingle.contents.length >= 2 && "video" === e.jingle.contents[1].name)) { var o = e.jingle.contents[1].application.sourceGroups || [], a = !1; if (o.forEach(function (e) { "SIM" == e.semantics && (a = !0) }), !a && e.jingle.contents[1].application.sources.length) { var s = JSON.parse(JSON.stringify(e.jingle.contents[1].application.sources[0])); s.ssrc = "" + Math.floor(4294967295 * Math.random()), e.jingle.contents[1].application.sources.push(s), r.push(e.jingle.contents[1].application.sources[0].ssrc), r.push(s.ssrc), o.push({ semantics: "SIM", sources: r }); var d = JSON.parse(JSON.stringify(s)); d.ssrc = "" + Math.floor(4294967295 * Math.random()), e.jingle.contents[1].application.sources.push(d), o.push({ semantics: "FID", sources: [s.ssrc, d.ssrc] }), e.jingle.contents[1].application.sourceGroups = o, e.sdp = i.toSessionSDP(e.jingle, { sid: n.config.sdpSessionID, role: n._role(), direction: "outgoing" }) } } var p = { type: "answer", sdp: e.sdp }; if (n.assumeSetLocalSuccess) { var u = c(p); n.emit("answer", u), t(null, u) } n._candidateBuffer = [], n.pc.setLocalDescription(e, function () { if (n.config.useJingle) { var r = i.toSessionJSON(e.sdp, { role: n._role(), direction: "outgoing" }); r.sid = n.config.sid, n.localDescription = r, p.jingle = r } if (n.enableChromeNativeSimulcast && (p.jingle || (p.jingle = i.toSessionJSON(e.sdp, { role: n._role(), direction: "outgoing" })), p.jingle.contents[1].application.sources.forEach(function (e, t) { e.parameters = e.parameters.map(function (e) { return "msid" === e.key && (e.value += "-" + Math.floor(t / 2)), e }) }), p.sdp = i.toSessionSDP(p.jingle, { sid: n.sdpSessionID, role: n._role(), direction: "outgoing" })), p.sdp.split("\r\n").forEach(function (e) { 0 === e.indexOf("a=candidate:") && n._checkLocalCandidate(e) }), !n.assumeSetLocalSuccess) { var o = c(p); n.emit("answer", o), t(null, o) } }, function (e) { n.emit("error", e), t(e) }) }, function (e) { n.emit("error", e), t(e) }, e) }, d.prototype._onIce = function (e) { var t = this; if (e.candidate) { if (this.dontSignalCandidates) return; var n = e.candidate, r = { candidate: { candidate: n.candidate, sdpMid: n.sdpMid, sdpMLineIndex: n.sdpMLineIndex } }; this._checkLocalCandidate(n.candidate); var o, a, s = i.toCandidateJSON(n.candidate); if (this.eliminateDuplicateCandidates && "relay" === s.type && (a = (o = this._candidateBuffer.filter(function (e) { return "relay" === e.type }).map(function (e) { return e.foundation + ":" + e.component })).indexOf(s.foundation + ":" + s.component)) > -1 && s.priority >> 24 >= o[a].priority >> 24) return; if ("max-bundle" === this.config.bundlePolicy && (a = (o = this._candidateBuffer.filter(function (e) { return s.type === e.type }).map(function (e) { return e.address + ":" + e.port })).indexOf(s.address + ":" + s.port)) > -1) return; if ("require" === this.config.rtcpMuxPolicy && "2" === s.component) return; if (this._candidateBuffer.push(s), t.config.useJingle) { if (n.sdpMid || (t.pc.remoteDescription && "offer" === t.pc.remoteDescription.type ? n.sdpMid = t.remoteDescription.contents[n.sdpMLineIndex].name : n.sdpMid = t.localDescription.contents[n.sdpMLineIndex].name), !t.iceCredentials.local[n.sdpMid]) i.toSessionJSON(t.pc.localDescription.sdp, { role: t._role(), direction: "outgoing" }).contents.forEach(function (e) { var n = e.transport || {}; n.ufrag && (t.iceCredentials.local[e.name] = { ufrag: n.ufrag, pwd: n.pwd }) }); if (r.jingle = { contents: [{ name: n.sdpMid, creator: t._role(), transport: { transportType: "iceUdp", ufrag: t.iceCredentials.local[n.sdpMid].ufrag, pwd: t.iceCredentials.local[n.sdpMid].pwd, candidates: [s] } }] }, t.batchIceCandidates > 0) return 0 === t.batchedIceCandidates.length && window.setTimeout(function () { var e = {}; t.batchedIceCandidates.forEach(function (t) { t = t.contents[0], e[t.name] || (e[t.name] = t), e[t.name].transport.candidates.push(t.transport.candidates[0]) }); var n = { jingle: { contents: [] } }; Object.keys(e).forEach(function (t) { n.jingle.contents.push(e[t]) }), t.batchedIceCandidates = [], t.emit("ice", n) }, t.batchIceCandidates), void t.batchedIceCandidates.push(r.jingle) } this.emit("ice", r) } else this.emit("endOfCandidates") }, d.prototype._onDataChannel = function (e) { var t = e.channel; this._remoteDataChannels.push(t), this.emit("addChannel", t) }, d.prototype.createDataChannel = function (e, t) { var n = this.pc.createDataChannel(e, t); return this._localDataChannels.push(n), n }, d.prototype.getStats = function (e) { this.pc.getStats(null, function (t) { e(null, t) }, function (t) { e(t) }) }, t.exports = d }, { "lodash.clonedeep": 47, "sdp-jingle-json": 57, traceablepeerconnection: 76, util: 89, "webrtc-adapter": 90, wildemitter: 100 }], 57: [function (e, t, n) { var r = e("./lib/tosdp"), i = e("./lib/tojson"); n.toIncomingSDPOffer = function (e) { return r.toSessionSDP(e, { role: "responder", direction: "incoming" }) }, n.toOutgoingSDPOffer = function (e) { return r.toSessionSDP(e, { role: "initiator", direction: "outgoing" }) }, n.toIncomingSDPAnswer = function (e) { return r.toSessionSDP(e, { role: "initiator", direction: "incoming" }) }, n.toOutgoingSDPAnswer = function (e) { return r.toSessionSDP(e, { role: "responder", direction: "outgoing" }) }, n.toIncomingMediaSDPOffer = function (e) { return r.toMediaSDP(e, { role: "responder", direction: "incoming" }) }, n.toOutgoingMediaSDPOffer = function (e) { return r.toMediaSDP(e, { role: "initiator", direction: "outgoing" }) }, n.toIncomingMediaSDPAnswer = function (e) { return r.toMediaSDP(e, { role: "initiator", direction: "incoming" }) }, n.toOutgoingMediaSDPAnswer = function (e) { return r.toMediaSDP(e, { role: "responder", direction: "outgoing" }) }, n.toCandidateSDP = r.toCandidateSDP, n.toMediaSDP = r.toMediaSDP, n.toSessionSDP = r.toSessionSDP, n.toIncomingJSONOffer = function (e, t) { return i.toSessionJSON(e, { role: "responder", direction: "incoming", creators: t }) }, n.toOutgoingJSONOffer = function (e, t) { return i.toSessionJSON(e, { role: "initiator", direction: "outgoing", creators: t }) }, n.toIncomingJSONAnswer = function (e, t) { return i.toSessionJSON(e, { role: "initiator", direction: "incoming", creators: t }) }, n.toOutgoingJSONAnswer = function (e, t) { return i.toSessionJSON(e, { role: "responder", direction: "outgoing", creators: t }) }, n.toIncomingMediaJSONOffer = function (e, t) { return i.toMediaJSON(e, { role: "responder", direction: "incoming", creator: t }) }, n.toOutgoingMediaJSONOffer = function (e, t) { return i.toMediaJSON(e, { role: "initiator", direction: "outgoing", creator: t }) }, n.toIncomingMediaJSONAnswer = function (e, t) { return i.toMediaJSON(e, { role: "initiator", direction: "incoming", creator: t }) }, n.toOutgoingMediaJSONAnswer = function (e, t) { return i.toMediaJSON(e, { role: "responder", direction: "outgoing", creator: t }) }, n.toCandidateJSON = i.toCandidateJSON, n.toMediaJSON = i.toMediaJSON, n.toSessionJSON = i.toSessionJSON }, { "./lib/tojson": 60, "./lib/tosdp": 61 }], 58: [function (e, t, n) { n.lines = function (e) { return e.split("\r\n").filter(function (e) { return e.length > 0 }) }, n.findLine = function (e, t, n) { for (var r = e.length, i = 0; i < t.length; i++)if (t[i].substr(0, r) === e) return t[i]; if (!n) return !1; for (var o = 0; o < n.length; o++)if (n[o].substr(0, r) === e) return n[o]; return !1 }, n.findLines = function (e, t, n) { for (var r = [], i = e.length, o = 0; o < t.length; o++)t[o].substr(0, i) === e && r.push(t[o]); if (r.length || !n) return r; for (var a = 0; a < n.length; a++)n[a].substr(0, i) === e && r.push(n[a]); return r }, n.mline = function (e) { for (var t = e.substr(2).split(" "), n = { media: t[0], port: t[1], proto: t[2], formats: [] }, r = 3; r < t.length; r++)t[r] && n.formats.push(t[r]); return n }, n.rtpmap = function (e) { var t = e.substr(9).split(" "), n = { id: t.shift() }; return t = t[0].split("/"), n.name = t[0], n.clockrate = t[1], n.channels = 3 == t.length ? t[2] : "1", n }, n.sctpmap = function (e) { var t = e.substr(10).split(" "); return { number: t.shift(), protocol: t.shift(), streams: t.shift() } }, n.fmtp = function (e) { for (var t, n, r, i = e.substr(e.indexOf(" ") + 1).split(";"), o = [], a = 0; a < i.length; a++)n = (t = i[a].split("="))[0].trim(), r = t[1], n && r ? o.push({ key: n, value: r }) : n && o.push({ key: "", value: n }); return o }, n.crypto = function (e) { var t = e.substr(9).split(" "); return { tag: t[0], cipherSuite: t[1], keyParams: t[2], sessionParams: t.slice(3).join(" ") } }, n.fingerprint = function (e) { var t = e.substr(14).split(" "); return { hash: t[0], value: t[1] } }, n.extmap = function (e) { var t = e.substr(9).split(" "), n = {}, r = t.shift(), i = r.indexOf("/"); return i >= 0 ? (n.id = r.substr(0, i), n.senders = r.substr(i + 1)) : (n.id = r, n.senders = "sendrecv"), n.uri = t.shift() || "", n }, n.rtcpfb = function (e) { var t = e.substr(10).split(" "), n = {}; return n.id = t.shift(), n.type = t.shift(), "trr-int" === n.type ? n.value = t.shift() : n.subtype = t.shift() || "", n.parameters = t, n }, n.candidate = function (e) { for (var t, n = { foundation: (t = 0 === e.indexOf("a=candidate:") ? e.substring(12).split(" ") : e.substring(10).split(" "))[0], component: t[1], protocol: t[2].toLowerCase(), priority: t[3], ip: t[4], port: t[5], type: t[7], generation: "0" }, r = 8; r < t.length; r += 2)"raddr" === t[r] ? n.relAddr = t[r + 1] : "rport" === t[r] ? n.relPort = t[r + 1] : "generation" === t[r] ? n.generation = t[r + 1] : "tcptype" === t[r] && (n.tcpType = t[r + 1]); return n.network = "1", n }, n.sourceGroups = function (e) { for (var t = [], n = 0; n < e.length; n++) { var r = e[n].substr(13).split(" "); t.push({ semantics: r.shift(), sources: r }) } return t }, n.sources = function (e) { for (var t = [], n = {}, r = 0; r < e.length; r++) { var i = e[r].substr(7).split(" "), o = i.shift(); if (!n[o]) { var a = { ssrc: o, parameters: [] }; t.push(a), n[o] = a } var s = (i = i.join(" ").split(":")).shift(), c = i.join(":") || null; n[o].parameters.push({ key: s, value: c }) } return t }, n.groups = function (e) { for (var t, n = [], r = 0; r < e.length; r++)t = e[r].substr(8).split(" "), n.push({ semantics: t.shift(), contents: t }); return n }, n.bandwidth = function (e) { var t = e.substr(2).split(":"), n = {}; return n.type = t.shift(), n.bandwidth = t.shift(), n }, n.msid = function (e) { var t = e.substr(7), n = t.split(" "); return { msid: t, mslabel: n[0], label: n[1] } } }, {}], 59: [function (e, t, n) { t.exports = { initiator: { incoming: { initiator: "recvonly", responder: "sendonly", both: "sendrecv", none: "inactive", recvonly: "initiator", sendonly: "responder", sendrecv: "both", inactive: "none" }, outgoing: { initiator: "sendonly", responder: "recvonly", both: "sendrecv", none: "inactive", recvonly: "responder", sendonly: "initiator", sendrecv: "both", inactive: "none" } }, responder: { incoming: { initiator: "sendonly", responder: "recvonly", both: "sendrecv", none: "inactive", recvonly: "responder", sendonly: "initiator", sendrecv: "both", inactive: "none" }, outgoing: { initiator: "recvonly", responder: "sendonly", both: "sendrecv", none: "inactive", recvonly: "initiator", sendonly: "responder", sendrecv: "both", inactive: "none" } } } }, {}], 60: [function (e, t, n) { var r = e("./senders"), i = e("./parsers"), o = Math.random(); n._setIdCounter = function (e) { o = e }, n.toSessionJSON = function (e, t) { var r, o = t.creators || [], a = t.role || "initiator", s = t.direction || "outgoing", c = e.split("\r\nm="); for (r = 1; r < c.length; r++)c[r] = "m=" + c[r], r !== c.length - 1 && (c[r] += "\r\n"); var d = c.shift() + "\r\n", p = i.lines(d), u = {}, l = []; for (r = 0; r < c.length; r++)l.push(n.toMediaJSON(c[r], d, { role: a, direction: s, creator: o[r] || "initiator" })); u.contents = l; var f = i.findLines("a=group:", p); return f.length && (u.groups = i.groups(f)), u }, n.toMediaJSON = function (e, t, o) { var a = o.creator || "initiator", s = o.role || "initiator", c = o.direction || "outgoing", d = i.lines(e), p = i.lines(t), u = i.mline(d[0]), l = { creator: a, name: u.media, application: { applicationType: "rtp", media: u.media, payloads: [], encryption: [], feedback: [], headerExtensions: [] }, transport: { transportType: "iceUdp", candidates: [], fingerprints: [] } }; "application" == u.media && (l.application = { applicationType: "datachannel" }, l.transport.sctp = []); var f = l.application, h = l.transport, m = i.findLine("a=mid:", d); if (m && (l.name = m.substr(6)), i.findLine("a=sendrecv", d, p) ? l.senders = "both" : i.findLine("a=sendonly", d, p) ? l.senders = r[s][c].sendonly : i.findLine("a=recvonly", d, p) ? l.senders = r[s][c].recvonly : i.findLine("a=inactive", d, p) && (l.senders = "none"), "rtp" == f.applicationType) { var g = i.findLine("b=", d); g && (f.bandwidth = i.bandwidth(g)); var v = i.findLine("a=ssrc:", d); v && (f.ssrc = v.substr(7).split(" ")[0]), i.findLines("a=rtpmap:", d).forEach(function (e) { var t = i.rtpmap(e); t.parameters = [], t.feedback = [], i.findLines("a=fmtp:" + t.id, d).forEach(function (e) { t.parameters = i.fmtp(e) }), i.findLines("a=rtcp-fb:" + t.id, d).forEach(function (e) { t.feedback.push(i.rtcpfb(e)) }), f.payloads.push(t) }), i.findLines("a=crypto:", d, p).forEach(function (e) { f.encryption.push(i.crypto(e)) }), i.findLine("a=rtcp-mux", d) && (f.mux = !0), i.findLines("a=rtcp-fb:*", d).forEach(function (e) { f.feedback.push(i.rtcpfb(e)) }), i.findLines("a=extmap:", d).forEach(function (e) { var t = i.extmap(e); t.senders = r[s][c][t.senders], f.headerExtensions.push(t) }); var y = i.findLines("a=ssrc-group:", d); f.sourceGroups = i.sourceGroups(y || []); var w = i.findLines("a=ssrc:", d), b = f.sources = i.sources(w || []), C = i.findLine("a=msid:", d); if (C) { var S = i.msid(C);["msid", "mslabel", "label"].forEach(function (e) { for (var t = 0; t < b.length; t++) { for (var n = !1, r = 0; r < b[t].parameters.length; r++)b[t].parameters[r].key === e && (n = !0); n || b[t].parameters.push({ key: e, value: S[e] }) } }) } i.findLine("a=x-google-flag:conference", d, p) && (f.googConferenceFlag = !0) } var k = i.findLines("a=fingerprint:", d, p), T = i.findLine("a=setup:", d, p); k.forEach(function (e) { var t = i.fingerprint(e); T && (t.setup = T.substr(8)), h.fingerprints.push(t) }); var E = i.findLine("a=ice-ufrag:", d, p), P = i.findLine("a=ice-pwd:", d, p); E && P && (h.ufrag = E.substr(12), h.pwd = P.substr(10), h.candidates = [], i.findLines("a=candidate:", d, p).forEach(function (e) { h.candidates.push(n.toCandidateJSON(e)) })); "datachannel" == f.applicationType && i.findLines("a=sctpmap:", d).forEach(function (e) { var t = i.sctpmap(e); h.sctp.push(t) }); return l }, n.toCandidateJSON = function (e) { var t = i.candidate(e.split("\r\n")[0]); return t.id = (o++).toString(36).substr(0, 12), t } }, { "./parsers": 58, "./senders": 59 }], 61: [function (e, t, n) { var r = e("./senders"); n.toSessionSDP = function (e, t) { t.role, t.direction; var r = ["v=0", "o=- " + (t.sid || e.sid || Date.now()) + " " + (t.time || Date.now()) + " IN IP4 0.0.0.0", "s=-", "t=0 0"], i = e.contents || [], o = !1; return i.forEach(function (e) { e.application.sources && e.application.sources.length && (o = !0) }), o && r.push("a=msid-semantic: WMS *"), (e.groups || []).forEach(function (e) { r.push("a=group:" + e.semantics + " " + e.contents.join(" ")) }), i.forEach(function (e) { r.push(n.toMediaSDP(e, t)) }), r.join("\r\n") + "\r\n" }, n.toMediaSDP = function (e, t) { var i = [], o = t.role || "initiator", a = t.direction || "outgoing", s = e.application, c = e.transport, d = s.payloads || [], p = c && c.fingerprints || [], u = []; if ("datachannel" == s.applicationType ? (u.push("application"), u.push("1"), u.push("DTLS/SCTP"), c.sctp && c.sctp.forEach(function (e) { u.push(e.number) })) : (u.push(s.media), u.push("1"), p.length > 0 ? u.push("UDP/TLS/RTP/SAVPF") : s.encryption && s.encryption.length > 0 ? u.push("RTP/SAVPF") : u.push("RTP/AVPF"), d.forEach(function (e) { u.push(e.id) })), i.push("m=" + u.join(" ")), i.push("c=IN IP4 0.0.0.0"), s.bandwidth && s.bandwidth.type && s.bandwidth.bandwidth && i.push("b=" + s.bandwidth.type + ":" + s.bandwidth.bandwidth), "rtp" == s.applicationType && i.push("a=rtcp:1 IN IP4 0.0.0.0"), c) { c.ufrag && i.push("a=ice-ufrag:" + c.ufrag), c.pwd && i.push("a=ice-pwd:" + c.pwd); p.forEach(function (e) { i.push("a=fingerprint:" + e.hash + " " + e.value), e.setup && i.push("a=setup:" + e.setup) }), c.sctp && c.sctp.forEach(function (e) { i.push("a=sctpmap:" + e.number + " " + e.protocol + " " + e.streams) }) } return "rtp" == s.applicationType && i.push("a=" + (r[o][a][e.senders] || "sendrecv")), i.push("a=mid:" + e.name), s.sources && s.sources.length && (s.sources[0].parameters || []).forEach(function (e) { "msid" === e.key && i.push("a=msid:" + e.value) }), s.mux && i.push("a=rtcp-mux"), (s.encryption || []).forEach(function (e) { i.push("a=crypto:" + e.tag + " " + e.cipherSuite + " " + e.keyParams + (e.sessionParams ? " " + e.sessionParams : "")) }), s.googConferenceFlag && i.push("a=x-google-flag:conference"), d.forEach(function (e) { var t = "a=rtpmap:" + e.id + " " + e.name + "/" + e.clockrate; if (e.channels && "1" != e.channels && (t += "/" + e.channels), i.push(t), e.parameters && e.parameters.length) { var n = ["a=fmtp:" + e.id], r = []; e.parameters.forEach(function (e) { r.push((e.key ? e.key + "=" : "") + e.value) }), n.push(r.join(";")), i.push(n.join(" ")) } e.feedback && e.feedback.forEach(function (t) { "trr-int" === t.type ? i.push("a=rtcp-fb:" + e.id + " trr-int " + (t.value ? t.value : "0")) : i.push("a=rtcp-fb:" + e.id + " " + t.type + (t.subtype ? " " + t.subtype : "")) }) }), s.feedback && s.feedback.forEach(function (e) { "trr-int" === e.type ? i.push("a=rtcp-fb:* trr-int " + (e.value ? e.value : "0")) : i.push("a=rtcp-fb:* " + e.type + (e.subtype ? " " + e.subtype : "")) }), (s.headerExtensions || []).forEach(function (e) { i.push("a=extmap:" + e.id + (e.senders ? "/" + r[o][a][e.senders] : "") + " " + e.uri) }), (s.sourceGroups || []).forEach(function (e) { i.push("a=ssrc-group:" + e.semantics + " " + e.sources.join(" ")) }), (s.sources || []).forEach(function (e) { for (var t = 0; t < e.parameters.length; t++) { var n = e.parameters[t]; i.push("a=ssrc:" + (e.ssrc || s.ssrc) + " " + n.key + (n.value ? ":" + n.value : "")) } }), (c.candidates || []).forEach(function (e) { i.push(n.toCandidateSDP(e)) }), i.join("\r\n") }, n.toCandidateSDP = function (e) { var t = []; t.push(e.foundation), t.push(e.component), t.push(e.protocol.toUpperCase()), t.push(e.priority), t.push(e.ip), t.push(e.port); var n = e.type; return t.push("typ"), t.push(n), "srflx" !== n && "prflx" !== n && "relay" !== n || e.relAddr && e.relPort && (t.push("raddr"), t.push(e.relAddr), t.push("rport"), t.push(e.relPort)), e.tcpType && "TCP" == e.protocol.toUpperCase() && (t.push("tcptype"), t.push(e.tcpType)), t.push("generation"), t.push(e.generation || "0"), "a=candidate:" + t.join(" ") } }, { "./senders": 59 }], 62: [function (e, t, n) { "use strict"; var r = { generateIdentifier: function () { return Math.random().toString(36).substr(2, 10) } }; r.localCName = r.generateIdentifier(), r.splitLines = function (e) { return e.trim().split("\n").map(function (e) { return e.trim() }) }, r.splitSections = function (e) { return e.split("\nm=").map(function (e, t) { return (t > 0 ? "m=" + e : e).trim() + "\r\n" }) }, r.matchPrefix = function (e, t) { return r.splitLines(e).filter(function (e) { return 0 === e.indexOf(t) }) }, r.parseCandidate = function (e) { for (var t, n = { foundation: (t = 0 === e.indexOf("a=candidate:") ? e.substring(12).split(" ") : e.substring(10).split(" "))[0], component: t[1], protocol: t[2].toLowerCase(), priority: parseInt(t[3], 10), ip: t[4], port: parseInt(t[5], 10), type: t[7] }, r = 8; r < t.length; r += 2)switch (t[r]) { case "raddr": n.relatedAddress = t[r + 1]; break; case "rport": n.relatedPort = parseInt(t[r + 1], 10); break; case "tcptype": n.tcpType = t[r + 1] }return n }, r.writeCandidate = function (e) { var t = []; t.push(e.foundation), t.push(e.component), t.push(e.protocol.toUpperCase()), t.push(e.priority), t.push(e.ip), t.push(e.port); var n = e.type; return t.push("typ"), t.push(n), "host" !== n && e.relatedAddress && e.relatedPort && (t.push("raddr"), t.push(e.relatedAddress), t.push("rport"), t.push(e.relatedPort)), e.tcpType && "tcp" === e.protocol.toLowerCase() && (t.push("tcptype"), t.push(e.tcpType)), "candidate:" + t.join(" ") }, r.parseRtpMap = function (e) { var t = e.substr(9).split(" "), n = { payloadType: parseInt(t.shift(), 10) }; return t = t[0].split("/"), n.name = t[0], n.clockRate = parseInt(t[1], 10), n.numChannels = 3 === t.length ? parseInt(t[2], 10) : 1, n }, r.writeRtpMap = function (e) { var t = e.payloadType; return void 0 !== e.preferredPayloadType && (t = e.preferredPayloadType), "a=rtpmap:" + t + " " + e.name + "/" + e.clockRate + (1 !== e.numChannels ? "/" + e.numChannels : "") + "\r\n" }, r.parseExtmap = function (e) { var t = e.substr(9).split(" "); return { id: parseInt(t[0], 10), uri: t[1] } }, r.writeExtmap = function (e) { return "a=extmap:" + (e.id || e.preferredId) + " " + e.uri + "\r\n" }, r.parseFmtp = function (e) { for (var t, n = {}, r = e.substr(e.indexOf(" ") + 1).split(";"), i = 0; i < r.length; i++)n[(t = r[i].trim().split("="))[0].trim()] = t[1]; return n }, r.writeFmtp = function (e) { var t = "", n = e.payloadType; if (void 0 !== e.preferredPayloadType && (n = e.preferredPayloadType), e.parameters && Object.keys(e.parameters).length) { var r = []; Object.keys(e.parameters).forEach(function (t) { r.push(t + "=" + e.parameters[t]) }), t += "a=fmtp:" + n + " " + r.join(";") + "\r\n" } return t }, r.parseRtcpFb = function (e) { var t = e.substr(e.indexOf(" ") + 1).split(" "); return { type: t.shift(), parameter: t.join(" ") } }, r.writeRtcpFb = function (e) { var t = "", n = e.payloadType; return void 0 !== e.preferredPayloadType && (n = e.preferredPayloadType), e.rtcpFeedback && e.rtcpFeedback.length && e.rtcpFeedback.forEach(function (e) { t += "a=rtcp-fb:" + n + " " + e.type + (e.parameter && e.parameter.length ? " " + e.parameter : "") + "\r\n" }), t }, r.parseSsrcMedia = function (e) { var t = e.indexOf(" "), n = { ssrc: parseInt(e.substr(7, t - 7), 10) }, r = e.indexOf(":", t); return r > -1 ? (n.attribute = e.substr(t + 1, r - t - 1), n.value = e.substr(r + 1)) : n.attribute = e.substr(t + 1), n }, r.getDtlsParameters = function (e, t) { var n = r.splitLines(e), i = (n = n.concat(r.splitLines(t))).filter(function (e) { return 0 === e.indexOf("a=fingerprint:") })[0].substr(14); return { role: "auto", fingerprints: [{ algorithm: i.split(" ")[0], value: i.split(" ")[1] }] } }, r.writeDtlsParameters = function (e, t) { var n = "a=setup:" + t + "\r\n"; return e.fingerprints.forEach(function (e) { n += "a=fingerprint:" + e.algorithm + " " + e.value + "\r\n" }), n }, r.getIceParameters = function (e, t) { var n = r.splitLines(e); return { usernameFragment: (n = n.concat(r.splitLines(t))).filter(function (e) { return 0 === e.indexOf("a=ice-ufrag:") })[0].substr(12), password: n.filter(function (e) { return 0 === e.indexOf("a=ice-pwd:") })[0].substr(10) } }, r.writeIceParameters = function (e) { return "a=ice-ufrag:" + e.usernameFragment + "\r\na=ice-pwd:" + e.password + "\r\n" }, r.parseRtpParameters = function (e) { for (var t = { codecs: [], headerExtensions: [], fecMechanisms: [], rtcp: [] }, n = r.splitLines(e)[0].split(" "), i = 3; i < n.length; i++) { var o = n[i], a = r.matchPrefix(e, "a=rtpmap:" + o + " ")[0]; if (a) { var s = r.parseRtpMap(a), c = r.matchPrefix(e, "a=fmtp:" + o + " "); switch (s.parameters = c.length ? r.parseFmtp(c[0]) : {}, s.rtcpFeedback = r.matchPrefix(e, "a=rtcp-fb:" + o + " ").map(r.parseRtcpFb), t.codecs.push(s), s.name.toUpperCase()) { case "RED": case "ULPFEC": t.fecMechanisms.push(s.name.toUpperCase()) } } } return r.matchPrefix(e, "a=extmap:").forEach(function (e) { t.headerExtensions.push(r.parseExtmap(e)) }), t }, r.writeRtpDescription = function (e, t) { var n = ""; n += "m=" + e + " ", n += t.codecs.length > 0 ? "9" : "0", n += " UDP/TLS/RTP/SAVPF ", n += t.codecs.map(function (e) { return void 0 !== e.preferredPayloadType ? e.preferredPayloadType : e.payloadType }).join(" ") + "\r\n", n += "c=IN IP4 0.0.0.0\r\n", n += "a=rtcp:9 IN IP4 0.0.0.0\r\n", t.codecs.forEach(function (e) { n += r.writeRtpMap(e), n += r.writeFmtp(e), n += r.writeRtcpFb(e) }); var i = 0; return t.codecs.forEach(function (e) { e.maxptime > i && (i = e.maxptime) }), i > 0 && (n += "a=maxptime:" + i + "\r\n"), n += "a=rtcp-mux\r\n", t.headerExtensions.forEach(function (e) { n += r.writeExtmap(e) }), n }, r.parseRtpEncodingParameters = function (e) { var t, n = [], i = r.parseRtpParameters(e), o = -1 !== i.fecMechanisms.indexOf("RED"), a = -1 !== i.fecMechanisms.indexOf("ULPFEC"), s = r.matchPrefix(e, "a=ssrc:").map(function (e) { return r.parseSsrcMedia(e) }).filter(function (e) { return "cname" === e.attribute }), c = s.length > 0 && s[0].ssrc, d = r.matchPrefix(e, "a=ssrc-group:FID").map(function (e) { var t = e.split(" "); return t.shift(), t.map(function (e) { return parseInt(e, 10) }) }); d.length > 0 && d[0].length > 1 && d[0][0] === c && (t = d[0][1]), i.codecs.forEach(function (e) { if ("RTX" === e.name.toUpperCase() && e.parameters.apt) { var r = { ssrc: c, codecPayloadType: parseInt(e.parameters.apt, 10), rtx: { ssrc: t } }; n.push(r), o && ((r = JSON.parse(JSON.stringify(r))).fec = { ssrc: t, mechanism: a ? "red+ulpfec" : "red" }, n.push(r)) } }), 0 === n.length && c && n.push({ ssrc: c }); var p = r.matchPrefix(e, "b="); return p.length && (0 === p[0].indexOf("b=TIAS:") ? p = parseInt(p[0].substr(7), 10) : 0 === p[0].indexOf("b=AS:") && (p = parseInt(p[0].substr(5), 10)), n.forEach(function (e) { e.maxBitrate = p })), n }, r.writeSessionBoilerplate = function () { return "v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n" }, r.writeMediaSection = function (e, t, n, i) { var o = r.writeRtpDescription(e.kind, t); if (o += r.writeIceParameters(e.iceGatherer.getLocalParameters()), o += r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(), "offer" === n ? "actpass" : "active"), o += "a=mid:" + e.mid + "\r\n", e.rtpSender && e.rtpReceiver ? o += "a=sendrecv\r\n" : e.rtpSender ? o += "a=sendonly\r\n" : e.rtpReceiver ? o += "a=recvonly\r\n" : o += "a=inactive\r\n", e.rtpSender) { var a = "msid:" + i.id + " " + e.rtpSender.track.id + "\r\n"; o += "a=" + a, o += "a=ssrc:" + e.sendEncodingParameters[0].ssrc + " " + a, e.sendEncodingParameters[0].rtx && (o += "a=ssrc:" + e.sendEncodingParameters[0].rtx.ssrc + " " + a, o += "a=ssrc-group:FID " + e.sendEncodingParameters[0].ssrc + " " + e.sendEncodingParameters[0].rtx.ssrc + "\r\n") } return o += "a=ssrc:" + e.sendEncodingParameters[0].ssrc + " cname:" + r.localCName + "\r\n", e.rtpSender && e.sendEncodingParameters[0].rtx && (o += "a=ssrc:" + e.sendEncodingParameters[0].rtx.ssrc + " cname:" + r.localCName + "\r\n"), o }, r.getDirection = function (e, t) { for (var n = r.splitLines(e), i = 0; i < n.length; i++)switch (n[i]) { case "a=sendrecv": case "a=sendonly": case "a=recvonly": case "a=inactive": return n[i].substr(2) }return t ? r.getDirection(t) : "sendrecv" }, t.exports = r }, {}], 63: [function (e, t, n) { t.exports = e("./lib/") }, { "./lib/": 64 }], 64: [function (e, t, n) { var r = e("./url"), i = e("socket.io-parser"), o = e("./manager"), a = e("debug")("socket.io-client"); t.exports = n = c; var s = n.managers = {}; function c(e, t) { "object" == typeof e && (t = e, e = void 0), t = t || {}; var n, i = r(e), c = i.source, d = i.id; return t.forceNew || t["force new connection"] || !1 === t.multiplex ? (a("ignoring socket cache for %s", c), n = o(c, t)) : (s[d] || (a("new io instance for %s", c), s[d] = o(c, t)), n = s[d]), n.socket(i.path) } n.protocol = i.protocol, n.connect = c, n.Manager = e("./manager"), n.Socket = e("./socket") }, { "./manager": 65, "./socket": 67, "./url": 68, debug: 69, "socket.io-parser": 71 }], 65: [function (e, t, n) { e("./url"); var r = e("engine.io-client"), i = e("./socket"), o = e("component-emitter"), a = e("socket.io-parser"), s = e("./on"), c = e("component-bind"), d = (e("object-component"), e("debug")("socket.io-client:manager")), p = e("indexof"), u = e("backo2"); function l(e, t) { if (!(this instanceof l)) return new l(e, t); e && "object" == typeof e && (t = e, e = void 0), (t = t || {}).path = t.path || "/socket.io", this.nsps = {}, this.subs = [], this.opts = t, this.reconnection(!1 !== t.reconnection), this.reconnectionAttempts(t.reconnectionAttempts || 1 / 0), this.reconnectionDelay(t.reconnectionDelay || 1e3), this.reconnectionDelayMax(t.reconnectionDelayMax || 5e3), this.randomizationFactor(t.randomizationFactor || .5), this.backoff = new u({ min: this.reconnectionDelay(), max: this.reconnectionDelayMax(), jitter: this.randomizationFactor() }), this.timeout(null == t.timeout ? 2e4 : t.timeout), this.readyState = "closed", this.uri = e, this.connected = [], this.encoding = !1, this.packetBuffer = [], this.encoder = new a.Encoder, this.decoder = new a.Decoder, this.autoConnect = !1 !== t.autoConnect, this.autoConnect && this.open() } t.exports = l, l.prototype.emitAll = function () { this.emit.apply(this, arguments); for (var e in this.nsps) this.nsps[e].emit.apply(this.nsps[e], arguments) }, l.prototype.updateSocketIds = function () { for (var e in this.nsps) this.nsps[e].id = this.engine.id }, o(l.prototype), l.prototype.reconnection = function (e) { return arguments.length ? (this._reconnection = !!e, this) : this._reconnection }, l.prototype.reconnectionAttempts = function (e) { return arguments.length ? (this._reconnectionAttempts = e, this) : this._reconnectionAttempts }, l.prototype.reconnectionDelay = function (e) { return arguments.length ? (this._reconnectionDelay = e, this.backoff && this.backoff.setMin(e), this) : this._reconnectionDelay }, l.prototype.randomizationFactor = function (e) { return arguments.length ? (this._randomizationFactor = e, this.backoff && this.backoff.setJitter(e), this) : this._randomizationFactor }, l.prototype.reconnectionDelayMax = function (e) { return arguments.length ? (this._reconnectionDelayMax = e, this.backoff && this.backoff.setMax(e), this) : this._reconnectionDelayMax }, l.prototype.timeout = function (e) { return arguments.length ? (this._timeout = e, this) : this._timeout }, l.prototype.maybeReconnectOnOpen = function () { !this.reconnecting && this._reconnection && 0 === this.backoff.attempts && this.reconnect() }, l.prototype.open = l.prototype.connect = function (e) { if (d("readyState %s", this.readyState), ~this.readyState.indexOf("open")) return this; d("opening %s", this.uri), this.engine = r(this.uri, this.opts); var t = this.engine, n = this; this.readyState = "opening", this.skipReconnect = !1; var i = s(t, "open", function () { n.onopen(), e && e() }), o = s(t, "error", function (t) { if (d("connect_error"), n.cleanup(), n.readyState = "closed", n.emitAll("connect_error", t), e) { var r = new Error("Connection error"); r.data = t, e(r) } else n.maybeReconnectOnOpen() }); if (!1 !== this._timeout) { var a = this._timeout; d("connect attempt will timeout after %d", a); var c = setTimeout(function () { d("connect attempt timed out after %d", a), i.destroy(), t.close(), t.emit("error", "timeout"), n.emitAll("connect_timeout", a) }, a); this.subs.push({ destroy: function () { clearTimeout(c) } }) } return this.subs.push(i), this.subs.push(o), this }, l.prototype.onopen = function () { d("open"), this.cleanup(), this.readyState = "open", this.emit("open"); var e = this.engine; this.subs.push(s(e, "data", c(this, "ondata"))), this.subs.push(s(this.decoder, "decoded", c(this, "ondecoded"))), this.subs.push(s(e, "error", c(this, "onerror"))), this.subs.push(s(e, "close", c(this, "onclose"))) }, l.prototype.ondata = function (e) { this.decoder.add(e) }, l.prototype.ondecoded = function (e) { this.emit("packet", e) }, l.prototype.onerror = function (e) { d("error", e), this.emitAll("error", e) }, l.prototype.socket = function (e) { var t = this.nsps[e]; if (!t) { t = new i(this, e), this.nsps[e] = t; var n = this; t.on("connect", function () { t.id = n.engine.id, ~p(n.connected, t) || n.connected.push(t) }) } return t }, l.prototype.destroy = function (e) { var t = p(this.connected, e); ~t && this.connected.splice(t, 1), this.connected.length || this.close() }, l.prototype.packet = function (e) { d("writing packet %j", e); var t = this; t.encoding ? t.packetBuffer.push(e) : (t.encoding = !0, this.encoder.encode(e, function (e) { for (var n = 0; n < e.length; n++)t.engine.write(e[n]); t.encoding = !1, t.processPacketQueue() })) }, l.prototype.processPacketQueue = function () { if (this.packetBuffer.length > 0 && !this.encoding) { var e = this.packetBuffer.shift(); this.packet(e) } }, l.prototype.cleanup = function () { for (var e; e = this.subs.shift();)e.destroy(); this.packetBuffer = [], this.encoding = !1, this.decoder.destroy() }, l.prototype.close = l.prototype.disconnect = function () { this.skipReconnect = !0, this.backoff.reset(), this.readyState = "closed", this.engine && this.engine.close() }, l.prototype.onclose = function (e) { d("close"), this.cleanup(), this.backoff.reset(), this.readyState = "closed", this.emit("close", e), this._reconnection && !this.skipReconnect && this.reconnect() }, l.prototype.reconnect = function () { if (this.reconnecting || this.skipReconnect) return this; var e = this; if (this.backoff.attempts >= this._reconnectionAttempts) d("reconnect failed"), this.backoff.reset(), this.emitAll("reconnect_failed"), this.reconnecting = !1; else { var t = this.backoff.duration(); d("will wait %dms before reconnect attempt", t), this.reconnecting = !0; var n = setTimeout(function () { e.skipReconnect || (d("attempting reconnect"), e.emitAll("reconnect_attempt", e.backoff.attempts), e.emitAll("reconnecting", e.backoff.attempts), e.skipReconnect || e.open(function (t) { t ? (d("reconnect attempt error"), e.reconnecting = !1, e.reconnect(), e.emitAll("reconnect_error", t.data)) : (d("reconnect success"), e.onreconnect()) })) }, t); this.subs.push({ destroy: function () { clearTimeout(n) } }) } }, l.prototype.onreconnect = function () { var e = this.backoff.attempts; this.reconnecting = !1, this.backoff.reset(), this.updateSocketIds(), this.emitAll("reconnect", e) } }, { "./on": 66, "./socket": 67, "./url": 68, backo2: 4, "component-bind": 7, "component-emitter": 8, debug: 69, "engine.io-client": 10, indexof: 44, "object-component": 51, "socket.io-parser": 71 }], 66: [function (e, t, n) { t.exports = function (e, t, n) { return e.on(t, n), { destroy: function () { e.removeListener(t, n) } } } }, {}], 67: [function (e, t, n) { var r = e("socket.io-parser"), i = e("component-emitter"), o = e("to-array"), a = e("./on"), s = e("component-bind"), c = e("debug")("socket.io-client:socket"), d = e("has-binary"); t.exports = l; var p = { connect: 1, connect_error: 1, connect_timeout: 1, disconnect: 1, error: 1, reconnect: 1, reconnect_attempt: 1, reconnect_failed: 1, reconnect_error: 1, reconnecting: 1 }, u = i.prototype.emit; function l(e, t) { this.io = e, this.nsp = t, this.json = this, this.ids = 0, this.acks = {}, this.io.autoConnect && this.open(), this.receiveBuffer = [], this.sendBuffer = [], this.connected = !1, this.disconnected = !0 } i(l.prototype), l.prototype.subEvents = function () { if (!this.subs) { var e = this.io; this.subs = [a(e, "open", s(this, "onopen")), a(e, "packet", s(this, "onpacket")), a(e, "close", s(this, "onclose"))] } }, l.prototype.open = l.prototype.connect = function () { return this.connected ? this : (this.subEvents(), this.io.open(), "open" == this.io.readyState && this.onopen(), this) }, l.prototype.send = function () { var e = o(arguments); return e.unshift("message"), this.emit.apply(this, e), this }, l.prototype.emit = function (e) { if (p.hasOwnProperty(e)) return u.apply(this, arguments), this; var t = o(arguments), n = r.EVENT; d(t) && (n = r.BINARY_EVENT); var i = { type: n, data: t }; return "function" == typeof t[t.length - 1] && (c("emitting packet with ack id %d", this.ids), this.acks[this.ids] = t.pop(), i.id = this.ids++), this.connected ? this.packet(i) : this.sendBuffer.push(i), this }, l.prototype.packet = function (e) { e.nsp = this.nsp, this.io.packet(e) }, l.prototype.onopen = function () { c("transport is open - connecting"), "/" != this.nsp && this.packet({ type: r.CONNECT }) }, l.prototype.onclose = function (e) { c("close (%s)", e), this.connected = !1, this.disconnected = !0, delete this.id, this.emit("disconnect", e) }, l.prototype.onpacket = function (e) { if (e.nsp == this.nsp) switch (e.type) { case r.CONNECT: this.onconnect(); break; case r.EVENT: case r.BINARY_EVENT: this.onevent(e); break; case r.ACK: case r.BINARY_ACK: this.onack(e); break; case r.DISCONNECT: this.ondisconnect(); break; case r.ERROR: this.emit("error", e.data) } }, l.prototype.onevent = function (e) { var t = e.data || []; c("emitting event %j", t), null != e.id && (c("attaching ack callback to event"), t.push(this.ack(e.id))), this.connected ? u.apply(this, t) : this.receiveBuffer.push(t) }, l.prototype.ack = function (e) { var t = this, n = !1; return function () { if (!n) { n = !0; var i = o(arguments); c("sending ack %j", i); var a = d(i) ? r.BINARY_ACK : r.ACK; t.packet({ type: a, id: e, data: i }) } } }, l.prototype.onack = function (e) { c("calling ack %s with %j", e.id, e.data), this.acks[e.id].apply(this, e.data), delete this.acks[e.id] }, l.prototype.onconnect = function () { this.connected = !0, this.disconnected = !1, this.emit("connect"), this.emitBuffered() }, l.prototype.emitBuffered = function () { var e; for (e = 0; e < this.receiveBuffer.length; e++)u.apply(this, this.receiveBuffer[e]); for (this.receiveBuffer = [], e = 0; e < this.sendBuffer.length; e++)this.packet(this.sendBuffer[e]); this.sendBuffer = [] }, l.prototype.ondisconnect = function () { c("server disconnect (%s)", this.nsp), this.destroy(), this.onclose("io server disconnect") }, l.prototype.destroy = function () { if (this.subs) { for (var e = 0; e < this.subs.length; e++)this.subs[e].destroy(); this.subs = null } this.io.destroy(this) }, l.prototype.close = l.prototype.disconnect = function () { return this.connected && (c("performing disconnect (%s)", this.nsp), this.packet({ type: r.DISCONNECT })), this.destroy(), this.connected && this.onclose("io client disconnect"), this } }, { "./on": 66, "component-bind": 7, "component-emitter": 8, debug: 69, "has-binary": 41, "socket.io-parser": 71, "to-array": 75 }], 68: [function (e, t, n) { (function (n) { var r = e("parseuri"), i = e("debug")("socket.io-client:url"); t.exports = function (e, t) { var o = e, t = t || n.location; null == e && (e = t.protocol + "//" + t.host); "string" == typeof e && ("/" == e.charAt(0) && (e = "/" == e.charAt(1) ? t.protocol + e : t.hostname + e), /^(https?|wss?):\/\//.test(e) || (i("protocol-less url %s", e), e = void 0 !== t ? t.protocol + "//" + e : "https://" + e), i("parse %s", e), o = r(e)); o.port || (/^(http|ws)$/.test(o.protocol) ? o.port = "80" : /^(http|ws)s$/.test(o.protocol) && (o.port = "443")); return o.path = o.path || "/", o.id = o.protocol + "://" + o.host + ":" + o.port, o.href = o.protocol + "://" + o.host + (t && t.port == o.port ? "" : ":" + o.port), o } }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, { debug: 69, parseuri: 54 }], 69: [function (e, t, n) { function r(e) { return r.enabled(e) ? function (t) { var n; t = (n = t) instanceof Error ? n.stack || n.message : n; var i = new Date, o = i - (r[e] || i); r[e] = i, t = e + " " + t + " +" + r.humanize(o), window.console && console.log && Function.prototype.apply.call(console.log, console, arguments) } : function () { } } t.exports = r, r.names = [], r.skips = [], r.enable = function (e) { try { localStorage.debug = e } catch (e) { } for (var t = (e || "").split(/[\s,]+/), n = t.length, i = 0; i < n; i++)"-" === (e = t[i].replace("*", ".*?"))[0] ? r.skips.push(new RegExp("^" + e.substr(1) + "$")) : r.names.push(new RegExp("^" + e + "$")) }, r.disable = function () { r.enable("") }, r.humanize = function (e) { return e >= 36e5 ? (e / 36e5).toFixed(1) + "h" : e >= 6e4 ? (e / 6e4).toFixed(1) + "m" : e >= 1e3 ? (e / 1e3 | 0) + "s" : e + "ms" }, r.enabled = function (e) { for (var t = 0, n = r.skips.length; t < n; t++)if (r.skips[t].test(e)) return !1; for (t = 0, n = r.names.length; t < n; t++)if (r.names[t].test(e)) return !0; return !1 }; try { window.localStorage && r.enable(localStorage.debug) } catch (e) { } }, {}], 70: [function (e, t, n) { (function (t) { var r = e("isarray"), i = e("./is-buffer"); n.deconstructPacket = function (e) { var t = [], n = e.data; var o = e; return o.data = function e(n) { if (!n) return n; if (i(n)) { var o = { _placeholder: !0, num: t.length }; return t.push(n), o } if (r(n)) { for (var a = new Array(n.length), s = 0; s < n.length; s++)a[s] = e(n[s]); return a } if ("object" == typeof n && !(n instanceof Date)) { a = {}; for (var c in n) a[c] = e(n[c]); return a } return n }(n), o.attachments = t.length, { packet: o, buffers: t } }, n.reconstructPacket = function (e, t) { return e.data = function e(n) { if (n && n._placeholder) return t[n.num]; if (r(n)) { for (var i = 0; i < n.length; i++)n[i] = e(n[i]); return n } if (n && "object" == typeof n) { for (var o in n) n[o] = e(n[o]); return n } return n }(e.data), e.attachments = void 0, e }, n.removeBlobs = function (e, n) { var o = 0, a = e; !function e(s, c, d) { if (!s) return s; if (t.Blob && s instanceof Blob || t.File && s instanceof File) { o++; var p = new FileReader; p.onload = function () { d ? d[c] = this.result : a = this.result, --o || n(a) }, p.readAsArrayBuffer(s) } else if (r(s)) for (var u = 0; u < s.length; u++)e(s[u], u, s); else if (s && "object" == typeof s && !i(s)) for (var l in s) e(s[l], l, s) }(a), o || n(a) } }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, { "./is-buffer": 72, isarray: 74 }], 71: [function (e, t, n) { var r = e("debug")("socket.io-parser"), i = e("json3"), o = (e("isarray"), e("component-emitter")), a = e("./binary"), s = e("./is-buffer"); function c() { } function d(e) { var t = "", o = !1; return t += e.type, n.BINARY_EVENT != e.type && n.BINARY_ACK != e.type || (t += e.attachments, t += "-"), e.nsp && "/" != e.nsp && (o = !0, t += e.nsp), null != e.id && (o && (t += ",", o = !1), t += e.id), null != e.data && (o && (t += ","), t += i.stringify(e.data)), r("encoded %j as %s", e, t), t } function p() { this.reconstructor = null } function u(e) { this.reconPack = e, this.buffers = [] } function l(e) { return { type: n.ERROR, data: "parser error" } } n.protocol = 4, n.types = ["CONNECT", "DISCONNECT", "EVENT", "BINARY_EVENT", "ACK", "BINARY_ACK", "ERROR"], n.CONNECT = 0, n.DISCONNECT = 1, n.EVENT = 2, n.ACK = 3, n.ERROR = 4, n.BINARY_EVENT = 5, n.BINARY_ACK = 6, n.Encoder = c, n.Decoder = p, c.prototype.encode = function (e, t) { (r("encoding packet %j", e), n.BINARY_EVENT == e.type || n.BINARY_ACK == e.type) ? function (e, t) { a.removeBlobs(e, function (e) { var n = a.deconstructPacket(e), r = d(n.packet), i = n.buffers; i.unshift(r), t(i) }) }(e, t) : t([d(e)]) }, o(p.prototype), p.prototype.add = function (e) { var t; if ("string" == typeof e) t = function (e) { var t = {}, o = 0; if (t.type = Number(e.charAt(0)), null == n.types[t.type]) return l(); if (n.BINARY_EVENT == t.type || n.BINARY_ACK == t.type) { for (var a = ""; "-" != e.charAt(++o) && (a += e.charAt(o), o != e.length);); if (a != Number(a) || "-" != e.charAt(o)) throw new Error("Illegal attachments"); t.attachments = Number(a) } if ("/" == e.charAt(o + 1)) for (t.nsp = ""; ++o;) { var s = e.charAt(o); if ("," == s) break; if (t.nsp += s, o == e.length) break } else t.nsp = "/"; var c = e.charAt(o + 1); if ("" !== c && Number(c) == c) { for (t.id = ""; ++o;) { var s = e.charAt(o); if (null == s || Number(s) != s) { --o; break } if (t.id += e.charAt(o), o == e.length) break } t.id = Number(t.id) } if (e.charAt(++o)) try { t.data = i.parse(e.substr(o)) } catch (e) { return l() } return r("decoded %s as %j", e, t), t }(e), n.BINARY_EVENT == t.type || n.BINARY_ACK == t.type ? (this.reconstructor = new u(t), 0 === this.reconstructor.reconPack.attachments && this.emit("decoded", t)) : this.emit("decoded", t); else { if (!s(e) && !e.base64) throw new Error("Unknown type: " + e); if (!this.reconstructor) throw new Error("got binary data when not reconstructing a packet"); (t = this.reconstructor.takeBinaryData(e)) && (this.reconstructor = null, this.emit("decoded", t)) } }, p.prototype.destroy = function () { this.reconstructor && this.reconstructor.finishedReconstruction() }, u.prototype.takeBinaryData = function (e) { if (this.buffers.push(e), this.buffers.length == this.reconPack.attachments) { var t = a.reconstructPacket(this.reconPack, this.buffers); return this.finishedReconstruction(), t } return null }, u.prototype.finishedReconstruction = function () { this.reconPack = null, this.buffers = [] } }, { "./binary": 70, "./is-buffer": 72, "component-emitter": 8, debug: 73, isarray: 74, json3: 45 }], 72: [function (e, t, n) { (function (e) { t.exports = function (t) { return e.Buffer && e.Buffer.isBuffer(t) || e.ArrayBuffer && t instanceof ArrayBuffer } }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, {}], 73: [function (e, t, n) { arguments[4][69][0].apply(n, arguments) }, { dup: 69 }], 74: [function (e, t, n) { arguments[4][42][0].apply(n, arguments) }, { dup: 42 }], 75: [function (e, t, n) { t.exports = function (e, t) { for (var n = [], r = (t = t || 0) || 0; r < e.length; r++)n[r - t] = e[r]; return n } }, {}], 76: [function (e, t, n) { var r = e("util"), i = (e("webrtc-adapter"), e("wildemitter")); function o(e) { return { type: e.type, sdp: e.sdp } } function a(e) { var t = { label: e.id }; return e.getAudioTracks().length && (t.audio = e.getAudioTracks().map(function (e) { return e.id })), e.getVideoTracks().length && (t.video = e.getVideoTracks().map(function (e) { return e.id })), t } function s(e, t) { var n = this; i.call(this), this.peerconnection = new window.RTCPeerConnection(e, t), this.trace = function (e, t) { n.emit("PeerConnectionTrace", { time: new Date, type: e, value: t || "" }) }, this.onicecandidate = null, this.peerconnection.onicecandidate = function (e) { n.trace("onicecandidate", e.candidate), null !== n.onicecandidate && n.onicecandidate(e) }, this.onaddstream = null, this.peerconnection.onaddstream = function (e) { n.trace("onaddstream", a(e.stream)), null !== n.onaddstream && n.onaddstream(e) }, this.onremovestream = null, this.peerconnection.onremovestream = function (e) { n.trace("onremovestream", a(e.stream)), null !== n.onremovestream && n.onremovestream(e) }, this.onsignalingstatechange = null, this.peerconnection.onsignalingstatechange = function (e) { n.trace("onsignalingstatechange", n.signalingState), null !== n.onsignalingstatechange && n.onsignalingstatechange(e) }, this.oniceconnectionstatechange = null, this.peerconnection.oniceconnectionstatechange = function (e) { n.trace("oniceconnectionstatechange", n.iceConnectionState), null !== n.oniceconnectionstatechange && n.oniceconnectionstatechange(e) }, this.onnegotiationneeded = null, this.peerconnection.onnegotiationneeded = function (e) { n.trace("onnegotiationneeded"), null !== n.onnegotiationneeded && n.onnegotiationneeded(e) }, n.ondatachannel = null, this.peerconnection.ondatachannel = function (e) { n.trace("ondatachannel", e), null !== n.ondatachannel && n.ondatachannel(e) }, this.getLocalStreams = this.peerconnection.getLocalStreams.bind(this.peerconnection), this.getRemoteStreams = this.peerconnection.getRemoteStreams.bind(this.peerconnection) } r.inherits(s, i), ["signalingState", "iceConnectionState", "localDescription", "remoteDescription"].forEach(function (e) { Object.defineProperty(s.prototype, e, { get: function () { return this.peerconnection[e] } }) }), s.prototype.addStream = function (e) { this.trace("addStream", a(e)), this.peerconnection.addStream(e) }, s.prototype.removeStream = function (e) { this.trace("removeStream", a(e)), this.peerconnection.removeStream(e) }, s.prototype.createDataChannel = function (e, t) { return this.trace("createDataChannel", e, t), this.peerconnection.createDataChannel(e, t) }, s.prototype.setLocalDescription = function (e, t, n) { var r = this; return this.trace("setLocalDescription", o(e)), this.peerconnection.setLocalDescription(e).then(function () { r.trace("setLocalDescriptionOnSuccess"), t && t() }, function (e) { r.trace("setLocalDescriptionOnFailure", e), n && n(e) }) }, s.prototype.setRemoteDescription = function (e, t, n) { var r = this; return this.trace("setRemoteDescription", o(e)), this.peerconnection.setRemoteDescription(e).then(function () { r.trace("setRemoteDescriptionOnSuccess"), t && t() }, function (e) { r.trace("setRemoteDescriptionOnFailure", e), n && n(e) }) }, s.prototype.close = function () { this.trace("stop"), "closed" != this.peerconnection.signalingState && this.peerconnection.close() }, s.prototype.createOffer = function (e, t, n) { var r = this; return this.trace("createOffer", n), this.peerconnection.createOffer(n).then(function (t) { r.trace("createOfferOnSuccess", o(t)), e && e(t) }, function (e) { r.trace("createOfferOnFailure", e), t && t(e) }) }, s.prototype.createAnswer = function (e, t, n) { var r = this; return this.trace("createAnswer", n), this.peerconnection.createAnswer(n).then(function (t) { r.trace("createAnswerOnSuccess", o(t)), e && e(t) }, function (e) { r.trace("createAnswerOnFailure", e), t && t(e) }) }, s.prototype.addIceCandidate = function (e, t, n) { var r = this; return this.trace("addIceCandidate", e), this.peerconnection.addIceCandidate(e).then(function () { t && t() }, function (e) { r.trace("addIceCandidateOnFailure", e), n && n(e) }) }, s.prototype.getStats = function () { this.peerconnection.getStats.apply(this.peerconnection, arguments) }, t.exports = s }, { util: 89, "webrtc-adapter": 77, wildemitter: 100 }], 77: [function (e, t, n) { arguments[4][30][0].apply(n, arguments) }, { "./chrome/chrome_shim": 78, "./edge/edge_shim": 80, "./firefox/firefox_shim": 82, "./safari/safari_shim": 84, "./utils": 85, dup: 30 }], 78: [function (e, t, n) { arguments[4][31][0].apply(n, arguments) }, { "../utils.js": 85, "./getusermedia": 79, dup: 31 }], 79: [function (e, t, n) { arguments[4][32][0].apply(n, arguments) }, { "../utils.js": 85, dup: 32 }], 80: [function (e, t, n) { arguments[4][33][0].apply(n, arguments) }, { "../utils": 85, "./getusermedia": 81, dup: 33, sdp: 62 }], 81: [function (e, t, n) { arguments[4][34][0].apply(n, arguments) }, { dup: 34 }], 82: [function (e, t, n) { arguments[4][35][0].apply(n, arguments) }, { "../utils": 85, "./getusermedia": 83, dup: 35 }], 83: [function (e, t, n) { arguments[4][36][0].apply(n, arguments) }, { "../utils": 85, dup: 36 }], 84: [function (e, t, n) { arguments[4][37][0].apply(n, arguments) }, { dup: 37 }], 85: [function (e, t, n) { arguments[4][38][0].apply(n, arguments) }, { dup: 38 }], 86: [function (e, t, n) { (function (e) { !function (r) { var i = "object" == typeof n && n, o = "object" == typeof t && t && t.exports == i && t, a = "object" == typeof e && e; a.global !== a && a.window !== a || (r = a); var s, c, d, p = String.fromCharCode; function u(e) { for (var t, n, r = [], i = 0, o = e.length; i < o;)(t = e.charCodeAt(i++)) >= 55296 && t <= 56319 && i < o ? 56320 == (64512 & (n = e.charCodeAt(i++))) ? r.push(((1023 & t) << 10) + (1023 & n) + 65536) : (r.push(t), i--) : r.push(t); return r } function l(e) { if (e >= 55296 && e <= 57343) throw Error("Lone surrogate U+" + e.toString(16).toUpperCase() + " is not a scalar value") } function f(e, t) { return p(e >> t & 63 | 128) } function h(e) { if (0 == (4294967168 & e)) return p(e); var t = ""; return 0 == (4294965248 & e) ? t = p(e >> 6 & 31 | 192) : 0 == (4294901760 & e) ? (l(e), t = p(e >> 12 & 15 | 224), t += f(e, 6)) : 0 == (4292870144 & e) && (t = p(e >> 18 & 7 | 240), t += f(e, 12), t += f(e, 6)), t += p(63 & e | 128) } function m() { if (d >= c) throw Error("Invalid byte index"); var e = 255 & s[d]; if (d++ , 128 == (192 & e)) return 63 & e; throw Error("Invalid continuation byte") } function g() { var e, t; if (d > c) throw Error("Invalid byte index"); if (d == c) return !1; if (e = 255 & s[d], d++ , 0 == (128 & e)) return e; if (192 == (224 & e)) { if ((t = (31 & e) << 6 | m()) >= 128) return t; throw Error("Invalid continuation byte") } if (224 == (240 & e)) { if ((t = (15 & e) << 12 | m() << 6 | m()) >= 2048) return l(t), t; throw Error("Invalid continuation byte") } if (240 == (248 & e) && (t = (15 & e) << 18 | m() << 12 | m() << 6 | m()) >= 65536 && t <= 1114111) return t; throw Error("Invalid UTF-8 detected") } var v = { version: "2.0.0", encode: function (e) { for (var t = u(e), n = t.length, r = -1, i = ""; ++r < n;)i += h(t[r]); return i }, decode: function (e) { s = u(e), c = s.length, d = 0; for (var t, n = []; !1 !== (t = g());)n.push(t); return function (e) { for (var t, n = e.length, r = -1, i = ""; ++r < n;)(t = e[r]) > 65535 && (i += p((t -= 65536) >>> 10 & 1023 | 55296), t = 56320 | 1023 & t), i += p(t); return i }(n) } }; if (i && !i.nodeType) if (o) o.exports = v; else { var y = {}.hasOwnProperty; for (var w in v) y.call(v, w) && (i[w] = v[w]) } else r.utf8 = v }(this) }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, {}], 87: [function (e, t, n) { "function" == typeof Object.create ? t.exports = function (e, t) { e.super_ = t, e.prototype = Object.create(t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } }) } : t.exports = function (e, t) { e.super_ = t; var n = function () { }; n.prototype = t.prototype, e.prototype = new n, e.prototype.constructor = e } }, {}], 88: [function (e, t, n) { t.exports = function (e) { return e && "object" == typeof e && "function" == typeof e.copy && "function" == typeof e.fill && "function" == typeof e.readUInt8 } }, {}], 89: [function (e, t, n) { (function (t, r) { var i = /%[sdj%]/g; n.format = function (e) { if (!v(e)) { for (var t = [], n = 0; n < arguments.length; n++)t.push(s(arguments[n])); return t.join(" ") } n = 1; for (var r = arguments, o = r.length, a = String(e).replace(i, function (e) { if ("%%" === e) return "%"; if (n >= o) return e; switch (e) { case "%s": return String(r[n++]); case "%d": return Number(r[n++]); case "%j": try { return JSON.stringify(r[n++]) } catch (e) { return "[Circular]" } default: return e } }), c = r[n]; n < o; c = r[++n])m(c) || !b(c) ? a += " " + c : a += " " + s(c); return a }, n.deprecate = function (e, i) { if (y(r.process)) return function () { return n.deprecate(e, i).apply(this, arguments) }; if (!0 === t.noDeprecation) return e; var o = !1; return function () { if (!o) { if (t.throwDeprecation) throw new Error(i); t.traceDeprecation ? console.trace(i) : console.error(i), o = !0 } return e.apply(this, arguments) } }; var o, a = {}; function s(e, t) { var r = { seen: [], stylize: d }; return arguments.length >= 3 && (r.depth = arguments[2]), arguments.length >= 4 && (r.colors = arguments[3]), h(t) ? r.showHidden = t : t && n._extend(r, t), y(r.showHidden) && (r.showHidden = !1), y(r.depth) && (r.depth = 2), y(r.colors) && (r.colors = !1), y(r.customInspect) && (r.customInspect = !0), r.colors && (r.stylize = c), p(r, e, r.depth) } function c(e, t) { var n = s.styles[t]; return n ? "[" + s.colors[n][0] + "m" + e + "[" + s.colors[n][1] + "m" : e } function d(e, t) { return e } function p(e, t, r) { if (e.customInspect && t && k(t.inspect) && t.inspect !== n.inspect && (!t.constructor || t.constructor.prototype !== t)) { var i = t.inspect(r, e); return v(i) || (i = p(e, i, r)), i } var o = function (e, t) { if (y(t)) return e.stylize("undefined", "undefined"); if (v(t)) { var n = "'" + JSON.stringify(t).replace(/^"|"$/g, "").replace(/'/g, "\\'").replace(/\\"/g, '"') + "'"; return e.stylize(n, "string") } if (g(t)) return e.stylize("" + t, "number"); if (h(t)) return e.stylize("" + t, "boolean"); if (m(t)) return e.stylize("null", "null") }(e, t); if (o) return o; var a, s = Object.keys(t), c = (a = {}, s.forEach(function (e, t) { a[e] = !0 }), a); if (e.showHidden && (s = Object.getOwnPropertyNames(t)), S(t) && (s.indexOf("message") >= 0 || s.indexOf("description") >= 0)) return u(t); if (0 === s.length) { if (k(t)) { var d = t.name ? ": " + t.name : ""; return e.stylize("[Function" + d + "]", "special") } if (w(t)) return e.stylize(RegExp.prototype.toString.call(t), "regexp"); if (C(t)) return e.stylize(Date.prototype.toString.call(t), "date"); if (S(t)) return u(t) } var b, T = "", E = !1, P = ["{", "}"]; (f(t) && (E = !0, P = ["[", "]"]), k(t)) && (T = " [Function" + (t.name ? ": " + t.name : "") + "]"); return w(t) && (T = " " + RegExp.prototype.toString.call(t)), C(t) && (T = " " + Date.prototype.toUTCString.call(t)), S(t) && (T = " " + u(t)), 0 !== s.length || E && 0 != t.length ? r < 0 ? w(t) ? e.stylize(RegExp.prototype.toString.call(t), "regexp") : e.stylize("[Object]", "special") : (e.seen.push(t), b = E ? function (e, t, n, r, i) { for (var o = [], a = 0, s = t.length; a < s; ++a)x(t, String(a)) ? o.push(l(e, t, n, r, String(a), !0)) : o.push(""); return i.forEach(function (i) { i.match(/^\d+$/) || o.push(l(e, t, n, r, i, !0)) }), o }(e, t, r, c, s) : s.map(function (n) { return l(e, t, r, c, n, E) }), e.seen.pop(), function (e, t, n) { if (e.reduce(function (e, t) { return 0, t.indexOf("\n") >= 0 && 0, e + t.replace(/\u001b\[\d\d?m/g, "").length + 1 }, 0) > 60) return n[0] + ("" === t ? "" : t + "\n ") + " " + e.join(",\n  ") + " " + n[1]; return n[0] + t + " " + e.join(", ") + " " + n[1] }(b, T, P)) : P[0] + T + P[1] } function u(e) { return "[" + Error.prototype.toString.call(e) + "]" } function l(e, t, n, r, i, o) { var a, s, c; if ((c = Object.getOwnPropertyDescriptor(t, i) || { value: t[i] }).get ? s = c.set ? e.stylize("[Getter/Setter]", "special") : e.stylize("[Getter]", "special") : c.set && (s = e.stylize("[Setter]", "special")), x(r, i) || (a = "[" + i + "]"), s || (e.seen.indexOf(c.value) < 0 ? (s = m(n) ? p(e, c.value, null) : p(e, c.value, n - 1)).indexOf("\n") > -1 && (s = o ? s.split("\n").map(function (e) { return "  " + e }).join("\n").substr(2) : "\n" + s.split("\n").map(function (e) { return "   " + e }).join("\n")) : s = e.stylize("[Circular]", "special")), y(a)) { if (o && i.match(/^\d+$/)) return s; (a = JSON.stringify("" + i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/) ? (a = a.substr(1, a.length - 2), a = e.stylize(a, "name")) : (a = a.replace(/'/g, "\\'").replace(/\\"/g, '"').replace(/(^"|"$)/g, "'"), a = e.stylize(a, "string")) } return a + ": " + s } function f(e) { return Array.isArray(e) } function h(e) { return "boolean" == typeof e } function m(e) { return null === e } function g(e) { return "number" == typeof e } function v(e) { return "string" == typeof e } function y(e) { return void 0 === e } function w(e) { return b(e) && "[object RegExp]" === T(e) } function b(e) { return "object" == typeof e && null !== e } function C(e) { return b(e) && "[object Date]" === T(e) } function S(e) { return b(e) && ("[object Error]" === T(e) || e instanceof Error) } function k(e) { return "function" == typeof e } function T(e) { return Object.prototype.toString.call(e) } function E(e) { return e < 10 ? "0" + e.toString(10) : e.toString(10) } n.debuglog = function (e) { if (y(o) && (o = t.env.NODE_DEBUG || ""), e = e.toUpperCase(), !a[e]) if (new RegExp("\\b" + e + "\\b", "i").test(o)) { var r = t.pid; a[e] = function () { var t = n.format.apply(n, arguments); console.error("%s %d: %s", e, r, t) } } else a[e] = function () { }; return a[e] }, n.inspect = s, s.colors = { bold: [1, 22], italic: [3, 23], underline: [4, 24], inverse: [7, 27], white: [37, 39], grey: [90, 39], black: [30, 39], blue: [34, 39], cyan: [36, 39], green: [32, 39], magenta: [35, 39], red: [31, 39], yellow: [33, 39] }, s.styles = { special: "cyan", number: "yellow", boolean: "yellow", undefined: "grey", null: "bold", string: "green", date: "magenta", regexp: "red" }, n.isArray = f, n.isBoolean = h, n.isNull = m, n.isNullOrUndefined = function (e) { return null == e }, n.isNumber = g, n.isString = v, n.isSymbol = function (e) { return "symbol" == typeof e }, n.isUndefined = y, n.isRegExp = w, n.isObject = b, n.isDate = C, n.isError = S, n.isFunction = k, n.isPrimitive = function (e) { return null === e || "boolean" == typeof e || "number" == typeof e || "string" == typeof e || "symbol" == typeof e || void 0 === e }, n.isBuffer = e("./support/isBuffer"); var P = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]; function x(e, t) { return Object.prototype.hasOwnProperty.call(e, t) } n.log = function () { var e, t; console.log("%s - %s", (e = new Date, t = [E(e.getHours()), E(e.getMinutes()), E(e.getSeconds())].join(":"), [e.getDate(), P[e.getMonth()], t].join(" ")), n.format.apply(n, arguments)) }, n.inherits = e("inherits"), n._extend = function (e, t) { if (!t || !b(t)) return e; for (var n = Object.keys(t), r = n.length; r--;)e[n[r]] = t[n[r]]; return e } }).call(this, e("_process"), "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, { "./support/isBuffer": 88, _process: 55, inherits: 87 }], 90: [function (e, t, n) { arguments[4][30][0].apply(n, arguments) }, { "./chrome/chrome_shim": 91, "./edge/edge_shim": 93, "./firefox/firefox_shim": 95, "./safari/safari_shim": 97, "./utils": 98, dup: 30 }], 91: [function (e, t, n) { "use strict"; var r = e("../utils.js").log, i = e("../utils.js").browserDetails, o = { shimMediaStream: function () { window.MediaStream = window.MediaStream || window.webkitMediaStream }, shimOnTrack: function () { "object" != typeof window || !window.RTCPeerConnection || "ontrack" in window.RTCPeerConnection.prototype || Object.defineProperty(window.RTCPeerConnection.prototype, "ontrack", { get: function () { return this._ontrack }, set: function (e) { var t = this; this._ontrack && (this.removeEventListener("track", this._ontrack), this.removeEventListener("addstream", this._ontrackpoly)), this.addEventListener("track", this._ontrack = e), this.addEventListener("addstream", this._ontrackpoly = function (e) { e.stream.addEventListener("addtrack", function (n) { var r = new Event("track"); r.track = n.track, r.receiver = { track: n.track }, r.streams = [e.stream], t.dispatchEvent(r) }), e.stream.getTracks().forEach(function (t) { var n = new Event("track"); n.track = t, n.receiver = { track: t }, n.streams = [e.stream], this.dispatchEvent(n) }.bind(this)) }.bind(this)) } }) }, shimSourceObject: function () { "object" == typeof window && (!window.HTMLMediaElement || "srcObject" in window.HTMLMediaElement.prototype || Object.defineProperty(window.HTMLMediaElement.prototype, "srcObject", { get: function () { return this._srcObject }, set: function (e) { var t = this; this._srcObject = e, this.src && URL.revokeObjectURL(this.src), e ? (this.src = URL.createObjectURL(e), e.addEventListener("addtrack", function () { t.src && URL.revokeObjectURL(t.src), t.src = URL.createObjectURL(e) }), e.addEventListener("removetrack", function () { t.src && URL.revokeObjectURL(t.src), t.src = URL.createObjectURL(e) })) : this.src = "" } })) }, shimPeerConnection: function () { window.RTCPeerConnection = function (e, t) { r("PeerConnection"), e && e.iceTransportPolicy && (e.iceTransports = e.iceTransportPolicy); var n = new webkitRTCPeerConnection(e, t), i = n.getStats.bind(n); return n.getStats = function (e, t, n) { var r = this, o = arguments; if (arguments.length > 0 && "function" == typeof e) return i(e, t); var a = function (e) { var t = {}; return e.result().forEach(function (e) { var n = { id: e.id, timestamp: e.timestamp, type: e.type }; e.names().forEach(function (t) { n[t] = e.stat(t) }), t[n.id] = n }), t }, s = function (e, t) { var n = new Map(Object.keys(e).map(function (t) { return [t, e[t]] })); return t = t || e, Object.keys(t).forEach(function (e) { n[e] = t[e] }), n }; if (arguments.length >= 2) { return i.apply(this, [function (e) { o[1](s(a(e))) }, arguments[0]]) } return new Promise(function (t, n) { 1 === o.length && "object" == typeof e ? i.apply(r, [function (e) { t(s(a(e))) }, n]) : i.apply(r, [function (e) { t(s(a(e), e.result())) }, n]) }).then(t, n) }, n }, window.RTCPeerConnection.prototype = webkitRTCPeerConnection.prototype, webkitRTCPeerConnection.generateCertificate && Object.defineProperty(window.RTCPeerConnection, "generateCertificate", { get: function () { return webkitRTCPeerConnection.generateCertificate } }), ["createOffer", "createAnswer"].forEach(function (e) { var t = webkitRTCPeerConnection.prototype[e]; webkitRTCPeerConnection.prototype[e] = function () { var e = this; if (arguments.length < 1 || 1 === arguments.length && "object" == typeof arguments[0]) { var n = 1 === arguments.length ? arguments[0] : void 0; return new Promise(function (r, i) { t.apply(e, [r, i, n]) }) } return t.apply(this, arguments) } }), i.version < 51 && ["setLocalDescription", "setRemoteDescription", "addIceCandidate"].forEach(function (e) { var t = webkitRTCPeerConnection.prototype[e]; webkitRTCPeerConnection.prototype[e] = function () { var e = arguments, n = this, r = new Promise(function (r, i) { t.apply(n, [e[0], r, i]) }); return e.length < 2 ? r : r.then(function () { e[1].apply(null, []) }, function (t) { e.length >= 3 && e[2].apply(null, [t]) }) } }), ["setLocalDescription", "setRemoteDescription", "addIceCandidate"].forEach(function (e) { var t = webkitRTCPeerConnection.prototype[e]; webkitRTCPeerConnection.prototype[e] = function () { return arguments[0] = new ("addIceCandidate" === e ? RTCIceCandidate : RTCSessionDescription)(arguments[0]), t.apply(this, arguments) } }); var e = RTCPeerConnection.prototype.addIceCandidate; RTCPeerConnection.prototype.addIceCandidate = function () { return arguments[0] ? e.apply(this, arguments) : (arguments[1] && arguments[1].apply(null), Promise.resolve()) } } }; t.exports = { shimMediaStream: o.shimMediaStream, shimOnTrack: o.shimOnTrack, shimSourceObject: o.shimSourceObject, shimPeerConnection: o.shimPeerConnection, shimGetUserMedia: e("./getusermedia") } }, { "../utils.js": 98, "./getusermedia": 92 }], 92: [function (e, t, n) { "use strict"; var r = e("../utils.js").log; t.exports = function () { var e = function (e) { if ("object" != typeof e || e.mandatory || e.optional) return e; var t = {}; return Object.keys(e).forEach(function (n) { if ("require" !== n && "advanced" !== n && "mediaSource" !== n) { var r = "object" == typeof e[n] ? e[n] : { ideal: e[n] }; void 0 !== r.exact && "number" == typeof r.exact && (r.min = r.max = r.exact); var i = function (e, t) { return e ? e + t.charAt(0).toUpperCase() + t.slice(1) : "deviceId" === t ? "sourceId" : t }; if (void 0 !== r.ideal) { t.optional = t.optional || []; var o = {}; "number" == typeof r.ideal ? (o[i("min", n)] = r.ideal, t.optional.push(o), (o = {})[i("max", n)] = r.ideal, t.optional.push(o)) : (o[i("", n)] = r.ideal, t.optional.push(o)) } void 0 !== r.exact && "number" != typeof r.exact ? (t.mandatory = t.mandatory || {}, t.mandatory[i("", n)] = r.exact) : ["min", "max"].forEach(function (e) { void 0 !== r[e] && (t.mandatory = t.mandatory || {}, t.mandatory[i(e, n)] = r[e]) }) } }), e.advanced && (t.optional = (t.optional || []).concat(e.advanced)), t }, t = function (t, n) { if ((t = JSON.parse(JSON.stringify(t))) && t.audio && (t.audio = e(t.audio)), t && "object" == typeof t.video) { var i = t.video.facingMode; if ((i = i && ("object" == typeof i ? i : { ideal: i })) && ("user" === i.exact || "environment" === i.exact || "user" === i.ideal || "environment" === i.ideal) && (!navigator.mediaDevices.getSupportedConstraints || !navigator.mediaDevices.getSupportedConstraints().facingMode) && (delete t.video.facingMode, "environment" === i.exact || "environment" === i.ideal)) return navigator.mediaDevices.enumerateDevices().then(function (o) { var a = (o = o.filter(function (e) { return "videoinput" === e.kind })).find(function (e) { return -1 !== e.label.toLowerCase().indexOf("back") }) || o.length && o[o.length - 1]; return a && (t.video.deviceId = i.exact ? { exact: a.deviceId } : { ideal: a.deviceId }), t.video = e(t.video), r("chrome: " + JSON.stringify(t)), n(t) }); t.video = e(t.video) } return r("chrome: " + JSON.stringify(t)), n(t) }, n = function (e) { return { name: { PermissionDeniedError: "NotAllowedError", ConstraintNotSatisfiedError: "OverconstrainedError" }[e.name] || e.name, message: e.message, constraint: e.constraintName, toString: function () { return this.name + (this.message && ": ") + this.message } } }; navigator.getUserMedia = function (e, r, i) { t(e, function (e) { navigator.webkitGetUserMedia(e, r, function (e) { i(n(e)) }) }) }; var i = function (e) { return new Promise(function (t, n) { navigator.getUserMedia(e, t, n) }) }; if (navigator.mediaDevices || (navigator.mediaDevices = { getUserMedia: i, enumerateDevices: function () { return new Promise(function (e) { var t = { audio: "audioinput", video: "videoinput" }; return MediaStreamTrack.getSources(function (n) { e(n.map(function (e) { return { label: e.label, kind: t[e.kind], deviceId: e.id, groupId: "" } })) }) }) } }), navigator.mediaDevices.getUserMedia) { var o = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices); navigator.mediaDevices.getUserMedia = function (e) { return t(e, function (e) { return o(e).then(function (t) { if (e.audio && !t.getAudioTracks().length || e.video && !t.getVideoTracks().length) throw t.getTracks().forEach(function (e) { e.stop() }), new DOMException("", "NotFoundError"); return t }, function (e) { return Promise.reject(n(e)) }) }) } } else navigator.mediaDevices.getUserMedia = function (e) { return i(e) }; void 0 === navigator.mediaDevices.addEventListener && (navigator.mediaDevices.addEventListener = function () { r("Dummy mediaDevices.addEventListener called.") }), void 0 === navigator.mediaDevices.removeEventListener && (navigator.mediaDevices.removeEventListener = function () { r("Dummy mediaDevices.removeEventListener called.") }) } }, { "../utils.js": 98 }], 93: [function (e, t, n) { "use strict"; var r = e("sdp"), i = e("../utils").browserDetails, o = { shimPeerConnection: function () { if (window.RTCIceGatherer) { window.RTCIceCandidate || (window.RTCIceCandidate = function (e) { return e }), window.RTCSessionDescription || (window.RTCSessionDescription = function (e) { return e }); var e = Object.getOwnPropertyDescriptor(MediaStreamTrack.prototype, "enabled"); Object.defineProperty(MediaStreamTrack.prototype, "enabled", { set: function (t) { e.set.call(this, t); var n = new Event("enabled"); n.enabled = t, this.dispatchEvent(n) } }) } window.RTCPeerConnection = function (e) { var t = this, n = document.createDocumentFragment(); if (["addEventListener", "removeEventListener", "dispatchEvent"].forEach(function (e) { t[e] = n[e].bind(n) }), this.onicecandidate = null, this.onaddstream = null, this.ontrack = null, this.onremovestream = null, this.onsignalingstatechange = null, this.oniceconnectionstatechange = null, this.onnegotiationneeded = null, this.ondatachannel = null, this.localStreams = [], this.remoteStreams = [], this.getLocalStreams = function () { return t.localStreams }, this.getRemoteStreams = function () { return t.remoteStreams }, this.localDescription = new RTCSessionDescription({ type: "", sdp: "" }), this.remoteDescription = new RTCSessionDescription({ type: "", sdp: "" }), this.signalingState = "stable", this.iceConnectionState = "new", this.iceGatheringState = "new", this.iceOptions = { gatherPolicy: "all", iceServers: [] }, e && e.iceTransportPolicy) switch (e.iceTransportPolicy) { case "all": case "relay": this.iceOptions.gatherPolicy = e.iceTransportPolicy; break; case "none": throw new TypeError('iceTransportPolicy "none" not supported') }if (this.usingBundle = e && "max-bundle" === e.bundlePolicy, e && e.iceServers) { var r = JSON.parse(JSON.stringify(e.iceServers)); this.iceOptions.iceServers = r.filter(function (e) { if (e && e.urls) { var t = e.urls; return "string" == typeof t && (t = [t]), !!(t = t.filter(function (e) { return 0 === e.indexOf("turn:") && -1 !== e.indexOf("transport=udp") && -1 === e.indexOf("turn:[") || 0 === e.indexOf("stun:") && i.version >= 14393 })[0]) } return !1 }) } this._config = e, this.transceivers = [], this._localIceCandidatesBuffer = [] }, window.RTCPeerConnection.prototype._emitBufferedCandidates = function () { var e = this, t = r.splitSections(e.localDescription.sdp); this._localIceCandidatesBuffer.forEach(function (n) { if (!n.candidate || 0 === Object.keys(n.candidate).length) for (var r = 1; r < t.length; r++)-1 === t[r].indexOf("\r\na=end-of-candidates\r\n") && (t[r] += "a=end-of-candidates\r\n"); else -1 === n.candidate.candidate.indexOf("typ endOfCandidates") && (t[n.candidate.sdpMLineIndex + 1] += "a=" + n.candidate.candidate + "\r\n"); (e.localDescription.sdp = t.join(""), e.dispatchEvent(n), null !== e.onicecandidate && e.onicecandidate(n), n.candidate || "complete" === e.iceGatheringState) || e.transceivers.every(function (e) { return e.iceGatherer && "completed" === e.iceGatherer.state }) && (e.iceGatheringState = "complete") }), this._localIceCandidatesBuffer = [] }, window.RTCPeerConnection.prototype.getConfiguration = function () { return this._config }, window.RTCPeerConnection.prototype.addStream = function (e) { var t = e.clone(); e.getTracks().forEach(function (e, n) { var r = t.getTracks()[n]; e.addEventListener("enabled", function (e) { r.enabled = e.enabled }) }), this.localStreams.push(t), this._maybeFireNegotiationNeeded() }, window.RTCPeerConnection.prototype.removeStream = function (e) { var t = this.localStreams.indexOf(e); t > -1 && (this.localStreams.splice(t, 1), this._maybeFireNegotiationNeeded()) }, window.RTCPeerConnection.prototype.getSenders = function () { return this.transceivers.filter(function (e) { return !!e.rtpSender }).map(function (e) { return e.rtpSender }) }, window.RTCPeerConnection.prototype.getReceivers = function () { return this.transceivers.filter(function (e) { return !!e.rtpReceiver }).map(function (e) { return e.rtpReceiver }) }, window.RTCPeerConnection.prototype._getCommonCapabilities = function (e, t) { var n = { codecs: [], headerExtensions: [], fecMechanisms: [] }; return e.codecs.forEach(function (e) { for (var r = 0; r < t.codecs.length; r++) { var i = t.codecs[r]; if (e.name.toLowerCase() === i.name.toLowerCase() && e.clockRate === i.clockRate) { i.numChannels = Math.min(e.numChannels, i.numChannels), n.codecs.push(i), i.rtcpFeedback = i.rtcpFeedback.filter(function (t) { for (var n = 0; n < e.rtcpFeedback.length; n++)if (e.rtcpFeedback[n].type === t.type && e.rtcpFeedback[n].parameter === t.parameter) return !0; return !1 }); break } } }), e.headerExtensions.forEach(function (e) { for (var r = 0; r < t.headerExtensions.length; r++) { var i = t.headerExtensions[r]; if (e.uri === i.uri) { n.headerExtensions.push(i); break } } }), n }, window.RTCPeerConnection.prototype._createIceAndDtlsTransports = function (e, t) { var n = this, i = new RTCIceGatherer(n.iceOptions), o = new RTCIceTransport(i); i.onlocalcandidate = function (a) { var s = new Event("icecandidate"); s.candidate = { sdpMid: e, sdpMLineIndex: t }; var c = a.candidate, d = !c || 0 === Object.keys(c).length; d ? (void 0 === i.state && (i.state = "completed"), s.candidate.candidate = "candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates") : (c.component = "RTCP" === o.component ? 2 : 1, s.candidate.candidate = r.writeCandidate(c)); var p = r.splitSections(n.localDescription.sdp); -1 === s.candidate.candidate.indexOf("typ endOfCandidates") ? p[s.candidate.sdpMLineIndex + 1] += "a=" + s.candidate.candidate + "\r\n" : p[s.candidate.sdpMLineIndex + 1] += "a=end-of-candidates\r\n", n.localDescription.sdp = p.join(""); var u = n.transceivers.every(function (e) { return e.iceGatherer && "completed" === e.iceGatherer.state }); switch (n.iceGatheringState) { case "new": n._localIceCandidatesBuffer.push(s), d && u && n._localIceCandidatesBuffer.push(new Event("icecandidate")); break; case "gathering": n._emitBufferedCandidates(), n.dispatchEvent(s), null !== n.onicecandidate && n.onicecandidate(s), u && (n.dispatchEvent(new Event("icecandidate")), null !== n.onicecandidate && n.onicecandidate(new Event("icecandidate")), n.iceGatheringState = "complete") } }, o.onicestatechange = function () { n._updateConnectionState() }; var a = new RTCDtlsTransport(o); return a.ondtlsstatechange = function () { n._updateConnectionState() }, a.onerror = function () { a.state = "failed", n._updateConnectionState() }, { iceGatherer: i, iceTransport: o, dtlsTransport: a } }, window.RTCPeerConnection.prototype._transceive = function (e, t, n) { var i = this._getCommonCapabilities(e.localCapabilities, e.remoteCapabilities); t && e.rtpSender && (i.encodings = e.sendEncodingParameters, i.rtcp = { cname: r.localCName }, e.recvEncodingParameters.length && (i.rtcp.ssrc = e.recvEncodingParameters[0].ssrc), e.rtpSender.send(i)), n && e.rtpReceiver && ("video" === e.kind && e.recvEncodingParameters && e.recvEncodingParameters.forEach(function (e) { delete e.rtx }), i.encodings = e.recvEncodingParameters, i.rtcp = { cname: e.cname }, e.sendEncodingParameters.length && (i.rtcp.ssrc = e.sendEncodingParameters[0].ssrc), e.rtpReceiver.receive(i)) }, window.RTCPeerConnection.prototype.setLocalDescription = function (e) { var t, n, i = this; if ("offer" === e.type) this._pendingOffer && (t = r.splitSections(e.sdp), n = t.shift(), t.forEach(function (e, t) { var n = r.parseRtpParameters(e); i._pendingOffer[t].localCapabilities = n }), this.transceivers = this._pendingOffer, delete this._pendingOffer); else if ("answer" === e.type) { t = r.splitSections(i.remoteDescription.sdp), n = t.shift(); var o = r.matchPrefix(n, "a=ice-lite").length > 0; t.forEach(function (e, t) { var a = i.transceivers[t], s = a.iceGatherer, c = a.iceTransport, d = a.dtlsTransport, p = a.localCapabilities, u = a.remoteCapabilities; if (!("0" === e.split("\n", 1)[0].split(" ", 2)[1]) && !a.isDatachannel) { var l = r.getIceParameters(e, n); if (o) { var f = r.matchPrefix(e, "a=candidate:").map(function (e) { return r.parseCandidate(e) }).filter(function (e) { return "1" === e.component }); f.length && c.setRemoteCandidates(f) } var h = r.getDtlsParameters(e, n); o && (h.role = "server"), i.usingBundle && 0 !== t || (c.start(s, l, o ? "controlling" : "controlled"), d.start(h)); var m = i._getCommonCapabilities(p, u); i._transceive(a, m.codecs.length > 0, !1) } }) } switch (this.localDescription = { type: e.type, sdp: e.sdp }, e.type) { case "offer": this._updateSignalingState("have-local-offer"); break; case "answer": this._updateSignalingState("stable"); break; default: throw new TypeError('unsupported type "' + e.type + '"') }var a = arguments.length > 1 && "function" == typeof arguments[1]; if (a) { var s = arguments[1]; window.setTimeout(function () { s(), "new" === i.iceGatheringState && (i.iceGatheringState = "gathering"), i._emitBufferedCandidates() }, 0) } var c = Promise.resolve(); return c.then(function () { a || ("new" === i.iceGatheringState && (i.iceGatheringState = "gathering"), window.setTimeout(i._emitBufferedCandidates.bind(i), 500)) }), c }, window.RTCPeerConnection.prototype.setRemoteDescription = function (e) { var t = this, n = new MediaStream, i = [], o = r.splitSections(e.sdp), a = o.shift(), s = r.matchPrefix(a, "a=ice-lite").length > 0; switch (this.usingBundle = r.matchPrefix(a, "a=group:BUNDLE ").length > 0, o.forEach(function (o, c) { var d = r.splitLines(o)[0].substr(2).split(" "), p = d[0], u = "0" === d[1], l = r.getDirection(o, a), f = r.matchPrefix(o, "a=mid:"); if (f = f.length ? f[0].substr(6) : r.generateIdentifier(), "application" !== p || "DTLS/SCTP" !== d[2]) { var h, m, g, v, y, w, b, C, S, k, T, E, P, x = r.parseRtpParameters(o); u || (T = r.getIceParameters(o, a), (E = r.getDtlsParameters(o, a)).role = "client"), C = r.parseRtpEncodingParameters(o); var R = r.matchPrefix(o, "a=ssrc:").map(function (e) { return r.parseSsrcMedia(e) }).filter(function (e) { return "cname" === e.attribute })[0]; R && (P = R.value); var O = r.matchPrefix(o, "a=end-of-candidates", a).length > 0, D = r.matchPrefix(o, "a=candidate:").map(function (e) { return r.parseCandidate(e) }).filter(function (e) { return "1" === e.component }); if ("offer" !== e.type || u) "answer" !== e.type || u || (m = (h = t.transceivers[c]).iceGatherer, g = h.iceTransport, v = h.dtlsTransport, y = h.rtpSender, w = h.rtpReceiver, b = h.sendEncodingParameters, S = h.localCapabilities, t.transceivers[c].recvEncodingParameters = C, t.transceivers[c].remoteCapabilities = x, t.transceivers[c].cname = P, (s || O) && D.length && g.setRemoteCandidates(D), t.usingBundle && 0 !== c || (g.start(m, T, "controlling"), v.start(E)), t._transceive(h, "sendrecv" === l || "recvonly" === l, "sendrecv" === l || "sendonly" === l), !w || "sendrecv" !== l && "sendonly" !== l ? delete h.rtpReceiver : (k = w.track, i.push([k, w]), n.addTrack(k))); else { var j, M = t.usingBundle && c > 0 ? { iceGatherer: t.transceivers[0].iceGatherer, iceTransport: t.transceivers[0].iceTransport, dtlsTransport: t.transceivers[0].dtlsTransport } : t._createIceAndDtlsTransports(f, c); if (O && M.iceTransport.setRemoteCandidates(D), (S = RTCRtpReceiver.getCapabilities(p)).codecs = S.codecs.filter(function (e) { return "rtx" !== e.name }), b = [{ ssrc: 1001 * (2 * c + 2) }], k = (w = new RTCRtpReceiver(M.dtlsTransport, p)).track, i.push([k, w]), n.addTrack(k), t.localStreams.length > 0 && t.localStreams[0].getTracks().length >= c) "audio" === p ? j = t.localStreams[0].getAudioTracks()[0] : "video" === p && (j = t.localStreams[0].getVideoTracks()[0]), j && (y = new RTCRtpSender(j, M.dtlsTransport)); t.transceivers[c] = { iceGatherer: M.iceGatherer, iceTransport: M.iceTransport, dtlsTransport: M.dtlsTransport, localCapabilities: S, remoteCapabilities: x, rtpSender: y, rtpReceiver: w, kind: p, mid: f, cname: P, sendEncodingParameters: b, recvEncodingParameters: C }, t._transceive(t.transceivers[c], !1, "sendrecv" === l || "sendonly" === l) } } else t.transceivers[c] = { mid: f, isDatachannel: !0 } }), this.remoteDescription = { type: e.type, sdp: e.sdp }, e.type) { case "offer": this._updateSignalingState("have-remote-offer"); break; case "answer": this._updateSignalingState("stable"); break; default: throw new TypeError('unsupported type "' + e.type + '"') }return n.getTracks().length && (t.remoteStreams.push(n), window.setTimeout(function () { var e = new Event("addstream"); e.stream = n, t.dispatchEvent(e), null !== t.onaddstream && window.setTimeout(function () { t.onaddstream(e) }, 0), i.forEach(function (r) { var i = r[0], o = r[1], a = new Event("track"); a.track = i, a.receiver = o, a.streams = [n], t.dispatchEvent(e), null !== t.ontrack && window.setTimeout(function () { t.ontrack(a) }, 0) }) }, 0)), arguments.length > 1 && "function" == typeof arguments[1] && window.setTimeout(arguments[1], 0), Promise.resolve() }, window.RTCPeerConnection.prototype.close = function () { this.transceivers.forEach(function (e) { e.iceTransport && e.iceTransport.stop(), e.dtlsTransport && e.dtlsTransport.stop(), e.rtpSender && e.rtpSender.stop(), e.rtpReceiver && e.rtpReceiver.stop() }), this._updateSignalingState("closed") }, window.RTCPeerConnection.prototype._updateSignalingState = function (e) { this.signalingState = e; var t = new Event("signalingstatechange"); this.dispatchEvent(t), null !== this.onsignalingstatechange && this.onsignalingstatechange(t) }, window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function () { var e = new Event("negotiationneeded"); this.dispatchEvent(e), null !== this.onnegotiationneeded && this.onnegotiationneeded(e) }, window.RTCPeerConnection.prototype._updateConnectionState = function () { var e, t = { new: 0, closed: 0, connecting: 0, checking: 0, connected: 0, completed: 0, failed: 0 }; if (this.transceivers.forEach(function (e) { t[e.iceTransport.state]++ , t[e.dtlsTransport.state]++ }), t.connected += t.completed, e = "new", t.failed > 0 ? e = "failed" : t.connecting > 0 || t.checking > 0 ? e = "connecting" : t.disconnected > 0 ? e = "disconnected" : t.new > 0 ? e = "new" : (t.connected > 0 || t.completed > 0) && (e = "connected"), e !== this.iceConnectionState) { this.iceConnectionState = e; var n = new Event("iceconnectionstatechange"); this.dispatchEvent(n), null !== this.oniceconnectionstatechange && this.oniceconnectionstatechange(n) } }, window.RTCPeerConnection.prototype.createOffer = function () { var e, t = this; if (this._pendingOffer) throw new Error("createOffer called while there is a pending offer."); 1 === arguments.length && "function" != typeof arguments[0] ? e = arguments[0] : 3 === arguments.length && (e = arguments[2]); var n = [], i = 0, o = 0; if (this.localStreams.length && (i = this.localStreams[0].getAudioTracks().length, o = this.localStreams[0].getVideoTracks().length), e) { if (e.mandatory || e.optional) throw new TypeError("Legacy mandatory/optional constraints not supported."); void 0 !== e.offerToReceiveAudio && (i = e.offerToReceiveAudio), void 0 !== e.offerToReceiveVideo && (o = e.offerToReceiveVideo) } for (this.localStreams.length && this.localStreams[0].getTracks().forEach(function (e) { n.push({ kind: e.kind, track: e, wantReceive: "audio" === e.kind ? i > 0 : o > 0 }), "audio" === e.kind ? i-- : "video" === e.kind && o-- }); i > 0 || o > 0;)i > 0 && (n.push({ kind: "audio", wantReceive: !0 }), i--), o > 0 && (n.push({ kind: "video", wantReceive: !0 }), o--); var a = r.writeSessionBoilerplate(), s = []; n.forEach(function (e, n) { var i, o, a = e.track, c = e.kind, d = r.generateIdentifier(), p = t.usingBundle && n > 0 ? { iceGatherer: s[0].iceGatherer, iceTransport: s[0].iceTransport, dtlsTransport: s[0].dtlsTransport } : t._createIceAndDtlsTransports(d, n), u = RTCRtpSender.getCapabilities(c); u.codecs = u.codecs.filter(function (e) { return "rtx" !== e.name }), u.codecs.forEach(function (e) { "H264" === e.name && void 0 === e.parameters["level-asymmetry-allowed"] && (e.parameters["level-asymmetry-allowed"] = "1") }); var l = [{ ssrc: 1001 * (2 * n + 1) }]; a && (i = new RTCRtpSender(a, p.dtlsTransport)), e.wantReceive && (o = new RTCRtpReceiver(p.dtlsTransport, c)), s[n] = { iceGatherer: p.iceGatherer, iceTransport: p.iceTransport, dtlsTransport: p.dtlsTransport, localCapabilities: u, remoteCapabilities: null, rtpSender: i, rtpReceiver: o, kind: c, mid: d, sendEncodingParameters: l, recvEncodingParameters: null } }), this.usingBundle && (a += "a=group:BUNDLE " + s.map(function (e) { return e.mid }).join(" ") + "\r\n"), n.forEach(function (e, n) { var i = s[n]; a += r.writeMediaSection(i, i.localCapabilities, "offer", t.localStreams[0]) }), this._pendingOffer = s; var c = new RTCSessionDescription({ type: "offer", sdp: a }); return arguments.length && "function" == typeof arguments[0] && window.setTimeout(arguments[0], 0, c), Promise.resolve(c) }, window.RTCPeerConnection.prototype.createAnswer = function () { var e = this, t = r.writeSessionBoilerplate(); this.usingBundle && (t += "a=group:BUNDLE " + this.transceivers.map(function (e) { return e.mid }).join(" ") + "\r\n"), this.transceivers.forEach(function (n) { if (n.isDatachannel) t += "m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:" + n.mid + "\r\n"; else { var i = e._getCommonCapabilities(n.localCapabilities, n.remoteCapabilities); t += r.writeMediaSection(n, i, "answer", e.localStreams[0]) } }); var n = new RTCSessionDescription({ type: "answer", sdp: t }); return arguments.length && "function" == typeof arguments[0] && window.setTimeout(arguments[0], 0, n), Promise.resolve(n) }, window.RTCPeerConnection.prototype.addIceCandidate = function (e) { if (e) { var t = e.sdpMLineIndex; if (e.sdpMid) for (var n = 0; n < this.transceivers.length; n++)if (this.transceivers[n].mid === e.sdpMid) { t = n; break } var i = this.transceivers[t]; if (i) { var o = Object.keys(e.candidate).length > 0 ? r.parseCandidate(e.candidate) : {}; if ("tcp" === o.protocol && (0 === o.port || 9 === o.port)) return; if ("1" !== o.component) return; "endOfCandidates" === o.type && (o = {}), i.iceTransport.addRemoteCandidate(o); var a = r.splitSections(this.remoteDescription.sdp); a[t + 1] += (o.type ? e.candidate.trim() : "a=end-of-candidates") + "\r\n", this.remoteDescription.sdp = a.join("") } } else this.transceivers.forEach(function (e) { e.iceTransport.addRemoteCandidate({}) }); return arguments.length > 1 && "function" == typeof arguments[1] && window.setTimeout(arguments[1], 0), Promise.resolve() }, window.RTCPeerConnection.prototype.getStats = function () { var e = []; this.transceivers.forEach(function (t) { ["rtpSender", "rtpReceiver", "iceGatherer", "iceTransport", "dtlsTransport"].forEach(function (n) { t[n] && e.push(t[n].getStats()) }) }); var t = arguments.length > 1 && "function" == typeof arguments[1] && arguments[1]; return new Promise(function (n) { var r = new Map; Promise.all(e).then(function (e) { e.forEach(function (e) { Object.keys(e).forEach(function (t) { r.set(t, e[t]), r[t] = e[t] }) }), t && window.setTimeout(t, 0, r), n(r) }) }) } } }; t.exports = { shimPeerConnection: o.shimPeerConnection, shimGetUserMedia: e("./getusermedia") } }, { "../utils": 98, "./getusermedia": 94, sdp: 62 }], 94: [function (e, t, n) { arguments[4][34][0].apply(n, arguments) }, { dup: 34 }], 95: [function (e, t, n) { "use strict"; var r = e("../utils").browserDetails, i = { shimOnTrack: function () { "object" != typeof window || !window.RTCPeerConnection || "ontrack" in window.RTCPeerConnection.prototype || Object.defineProperty(window.RTCPeerConnection.prototype, "ontrack", { get: function () { return this._ontrack }, set: function (e) { this._ontrack && (this.removeEventListener("track", this._ontrack), this.removeEventListener("addstream", this._ontrackpoly)), this.addEventListener("track", this._ontrack = e), this.addEventListener("addstream", this._ontrackpoly = function (e) { e.stream.getTracks().forEach(function (t) { var n = new Event("track"); n.track = t, n.receiver = { track: t }, n.streams = [e.stream], this.dispatchEvent(n) }.bind(this)) }.bind(this)) } }) }, shimSourceObject: function () { "object" == typeof window && (!window.HTMLMediaElement || "srcObject" in window.HTMLMediaElement.prototype || Object.defineProperty(window.HTMLMediaElement.prototype, "srcObject", { get: function () { return this.mozSrcObject }, set: function (e) { this.mozSrcObject = e } })) }, shimPeerConnection: function () { if ("object" == typeof window && (window.RTCPeerConnection || window.mozRTCPeerConnection)) { window.RTCPeerConnection || (window.RTCPeerConnection = function (e, t) { if (r.version < 38 && e && e.iceServers) { for (var n = [], i = 0; i < e.iceServers.length; i++) { var o = e.iceServers[i]; if (o.hasOwnProperty("urls")) for (var a = 0; a < o.urls.length; a++) { var s = { url: o.urls[a] }; 0 === o.urls[a].indexOf("turn") && (s.username = o.username, s.credential = o.credential), n.push(s) } else n.push(e.iceServers[i]) } e.iceServers = n } return new mozRTCPeerConnection(e, t) }, window.RTCPeerConnection.prototype = mozRTCPeerConnection.prototype, mozRTCPeerConnection.generateCertificate && Object.defineProperty(window.RTCPeerConnection, "generateCertificate", { get: function () { return mozRTCPeerConnection.generateCertificate } }), window.RTCSessionDescription = mozRTCSessionDescription, window.RTCIceCandidate = mozRTCIceCandidate), ["setLocalDescription", "setRemoteDescription", "addIceCandidate"].forEach(function (e) { var t = RTCPeerConnection.prototype[e]; RTCPeerConnection.prototype[e] = function () { return arguments[0] = new ("addIceCandidate" === e ? RTCIceCandidate : RTCSessionDescription)(arguments[0]), t.apply(this, arguments) } }); var e = RTCPeerConnection.prototype.addIceCandidate; if (RTCPeerConnection.prototype.addIceCandidate = function () { return arguments[0] ? e.apply(this, arguments) : (arguments[1] && arguments[1].apply(null), Promise.resolve()) }, r.version < 48) { var t = RTCPeerConnection.prototype.getStats; RTCPeerConnection.prototype.getStats = function (e, n, r) { return t.apply(this, [e || null]).then(function (e) { return t = e, n = new Map, Object.keys(t).forEach(function (e) { n.set(e, t[e]), n[e] = t[e] }), n; var t, n }).then(n, r) } } } } }; t.exports = { shimOnTrack: i.shimOnTrack, shimSourceObject: i.shimSourceObject, shimPeerConnection: i.shimPeerConnection, shimGetUserMedia: e("./getusermedia") } }, { "../utils": 98, "./getusermedia": 96 }], 96: [function (e, t, n) { "use strict"; var r = e("../utils").log, i = e("../utils").browserDetails; t.exports = function () { var e = function (e) { return { name: { SecurityError: "NotAllowedError", PermissionDeniedError: "NotAllowedError" }[e.name] || e.name, message: { "The operation is insecure.": "The request is not allowed by the user agent or the platform in the current context." }[e.message] || e.message, constraint: e.constraint, toString: function () { return this.name + (this.message && ": ") + this.message } } }, t = function (t, n, o) { var a = function (e) { if ("object" != typeof e || e.require) return e; var t = []; return Object.keys(e).forEach(function (n) { if ("require" !== n && "advanced" !== n && "mediaSource" !== n) { var r = e[n] = "object" == typeof e[n] ? e[n] : { ideal: e[n] }; if (void 0 === r.min && void 0 === r.max && void 0 === r.exact || t.push(n), void 0 !== r.exact && ("number" == typeof r.exact ? r.min = r.max = r.exact : e[n] = r.exact, delete r.exact), void 0 !== r.ideal) { e.advanced = e.advanced || []; var i = {}; "number" == typeof r.ideal ? i[n] = { min: r.ideal, max: r.ideal } : i[n] = r.ideal, e.advanced.push(i), delete r.ideal, Object.keys(r).length || delete e[n] } } }), t.length && (e.require = t), e }; return t = JSON.parse(JSON.stringify(t)), i.version < 38 && (r("spec: " + JSON.stringify(t)), t.audio && (t.audio = a(t.audio)), t.video && (t.video = a(t.video)), r("ff37: " + JSON.stringify(t))), navigator.mozGetUserMedia(t, n, function (t) { o(e(t)) }) }; if (navigator.mediaDevices || (navigator.mediaDevices = { getUserMedia: function (e) { return new Promise(function (n, r) { t(e, n, r) }) }, addEventListener: function () { }, removeEventListener: function () { } }), navigator.mediaDevices.enumerateDevices = navigator.mediaDevices.enumerateDevices || function () { return new Promise(function (e) { e([{ kind: "audioinput", deviceId: "default", label: "", groupId: "" }, { kind: "videoinput", deviceId: "default", label: "", groupId: "" }]) }) }, i.version < 41) { var n = navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices); navigator.mediaDevices.enumerateDevices = function () { return n().then(void 0, function (e) { if ("NotFoundError" === e.name) return []; throw e }) } } if (i.version < 49) { var o = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices); navigator.mediaDevices.getUserMedia = function (t) { return o(t).then(function (e) { if (t.audio && !e.getAudioTracks().length || t.video && !e.getVideoTracks().length) throw e.getTracks().forEach(function (e) { e.stop() }), new DOMException("The object can not be found here.", "NotFoundError"); return e }, function (t) { return Promise.reject(e(t)) }) } } navigator.getUserMedia = function (e, n, r) { if (i.version < 44) return t(e, n, r); console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"), navigator.mediaDevices.getUserMedia(e).then(n, r) } } }, { "../utils": 98 }], 97: [function (e, t, n) { "use strict"; var r = { shimGetUserMedia: function () { navigator.getUserMedia = navigator.webkitGetUserMedia } }; t.exports = { shimGetUserMedia: r.shimGetUserMedia } }, {}], 98: [function (e, t, n) { "use strict"; var r = !0, i = { disableLog: function (e) { return "boolean" != typeof e ? new Error("Argument type: " + typeof e + ". Please use a boolean.") : (r = e, e ? "adapter.js logging disabled" : "adapter.js logging enabled") }, log: function () { if ("object" == typeof window) { if (r) return; "undefined" != typeof console && "function" == typeof console.log && console.log.apply(console, arguments) } }, extractVersion: function (e, t, n) { var r = e.match(t); return r && r.length >= n && parseInt(r[n], 10) }, detectBrowser: function () { var e = {}; if (e.browser = null, e.version = null, "undefined" == typeof window || !window.navigator) return e.browser = "Not a browser.", e; if (navigator.mozGetUserMedia) e.browser = "firefox", e.version = this.extractVersion(navigator.userAgent, /Firefox\/([0-9]+)\./, 1); else if (navigator.webkitGetUserMedia) if (window.webkitRTCPeerConnection) e.browser = "chrome", e.version = this.extractVersion(navigator.userAgent, /Chrom(e|ium)\/([0-9]+)\./, 2); else { if (!navigator.userAgent.match(/Version\/(\d+).(\d+)/)) return e.browser = "Unsupported webkit-based browser with GUM support but no WebRTC support.", e; e.browser = "safari", e.version = this.extractVersion(navigator.userAgent, /AppleWebKit\/([0-9]+)\./, 1) } else { if (!navigator.mediaDevices || !navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)) return e.browser = "Not a supported browser.", e; e.browser = "edge", e.version = this.extractVersion(navigator.userAgent, /Edge\/(\d+).(\d+)$/, 2) } return e } }; t.exports = { log: i.log, disableLog: i.disableLog, browserDetails: i.detectBrowser(), extractVersion: i.extractVersion } }, {}], 99: [function (e, t, n) { var r, i; window.mozRTCPeerConnection || navigator.mozGetUserMedia ? (r = "moz", i = parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1], 10)) : (window.webkitRTCPeerConnection || navigator.webkitGetUserMedia) && (r = "webkit", i = navigator.userAgent.match(/Chrom(e|ium)/) && parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2], 10)); var o = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection, a = window.mozRTCIceCandidate || window.RTCIceCandidate, s = window.mozRTCSessionDescription || window.RTCSessionDescription, c = window.webkitMediaStream || window.MediaStream, d = "https:" === window.location.protocol && ("webkit" === r && i >= 26 || "moz" === r && i >= 33), p = window.AudioContext || window.webkitAudioContext, u = document.createElement("video"), l = u && u.canPlayType && "probably" === u.canPlayType('video/webm; codecs="vp8", vorbis'), f = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.msGetUserMedia || navigator.mozGetUserMedia; t.exports = { prefix: r, browserVersion: i, support: !!o && !!f, supportRTCPeerConnection: !!o, supportVp8: l, supportGetUserMedia: !!f, supportDataChannel: !!(o && o.prototype && o.prototype.createDataChannel), supportWebAudio: !(!p || !p.prototype.createMediaStreamSource), supportMediaStream: !(!c || !c.prototype.removeTrack), supportScreenSharing: !!d, AudioContext: p, PeerConnection: o, SessionDescription: s, IceCandidate: a, MediaStream: c, getUserMedia: f } }, {}], 100: [function (e, t, n) { function r() { } t.exports = r, r.mixin = function (e) { var t = e.prototype || e; t.isWildEmitter = !0, t.on = function (e, t, n) { this.callbacks = this.callbacks || {}; var r = 3 === arguments.length, i = r ? arguments[1] : void 0, o = r ? arguments[2] : arguments[1]; return o._groupName = i, (this.callbacks[e] = this.callbacks[e] || []).push(o), this }, t.once = function (e, t, n) { var r = this, i = 3 === arguments.length, o = i ? arguments[1] : void 0, a = i ? arguments[2] : arguments[1]; return this.on(e, o, function t() { r.off(e, t), a.apply(this, arguments) }), this }, t.releaseGroup = function (e) { var t, n, r, i; this.callbacks = this.callbacks || {}; for (t in this.callbacks) for (n = 0, r = (i = this.callbacks[t]).length; n < r; n++)i[n]._groupName === e && (i.splice(n, 1), n-- , r--); return this }, t.off = function (e, t) { this.callbacks = this.callbacks || {}; var n, r = this.callbacks[e]; return r ? 1 === arguments.length ? (delete this.callbacks[e], this) : (n = r.indexOf(t), r.splice(n, 1), 0 === r.length && delete this.callbacks[e], this) : this }, t.emit = function (e) { this.callbacks = this.callbacks || {}; var t, n, r, i = [].slice.call(arguments, 1), o = this.callbacks[e], a = this.getWildcardCallbacks(e); if (o) for (t = 0, n = (r = o.slice()).length; t < n && r[t]; ++t)r[t].apply(this, i); if (a) for (n = a.length, t = 0, n = (r = a.slice()).length; t < n && r[t]; ++t)r[t].apply(this, [e].concat(i)); return this }, t.getWildcardCallbacks = function (e) { this.callbacks = this.callbacks || {}; var t, n, r = []; for (t in this.callbacks) n = t.split("*"), ("*" === t || 2 === n.length && e.slice(0, n[0].length) === n[0]) && (r = r.concat(this.callbacks[t])); return r } }, r.mixin(r) }, {}], 101: [function (e, t, n) { var r = function () { return this }(), i = r.WebSocket || r.MozWebSocket; function o(e, t, n) { return t ? new i(e, t) : new i(e) } t.exports = i ? o : null, i && (o.prototype = i.prototype) }, {}], 102: [function (e, t, n) { var r = e("util"), i = e("webrtcsupport"), o = e("rtcpeerconnection"), a = e("wildemitter"), s = e("filetransfer"), c = "https://simplewebrtc.com/protocol/filetransfer#inband-v1"; function d(e) { var t = this; a.call(this), this.id = e.id, this.parent = e.parent, this.type = e.type || "video", this.oneway = e.oneway || !1, this.sharemyscreen = e.sharemyscreen || !1, this.browserPrefix = e.prefix, this.stream = e.stream, this.enableDataChannels = void 0 === e.enableDataChannels ? this.parent.config.enableDataChannels : e.enableDataChannels, this.receiveMedia = e.receiveMedia || this.parent.config.receiveMedia, this.channels = {}, this.sid = e.sid || Date.now().toString(), this.pc = new o(this.parent.config.peerConnectionConfig, this.parent.config.peerConnectionConstraints), this.pc.on("ice", this.onIceCandidate.bind(this)), this.pc.on("endOfCandidates", function (e) { t.send("endOfCandidates", e) }), this.pc.on("offer", function (e) { t.parent.config.nick && (e.nick = t.parent.config.nick), t.send("offer", e) }), this.pc.on("answer", function (e) { t.parent.config.nick && (e.nick = t.parent.config.nick), t.send("answer", e) }), this.pc.on("addStream", this.handleRemoteStreamAdded.bind(this)), this.pc.on("addChannel", this.handleDataChannelAdded.bind(this)), this.pc.on("removeStream", this.handleStreamRemoved.bind(this)), this.pc.on("negotiationNeeded", this.emit.bind(this, "negotiationNeeded")), this.pc.on("iceConnectionStateChange", this.emit.bind(this, "iceConnectionStateChange")), this.pc.on("iceConnectionStateChange", function () { switch (t.pc.iceConnectionState) { case "failed": "offer" === t.pc.pc.peerconnection.localDescription.type && (t.parent.emit("iceFailed", t), t.send("connectivityError")) } }), this.pc.on("signalingStateChange", this.emit.bind(this, "signalingStateChange")), this.logger = this.parent.logger, "screen" === e.type ? this.parent.localScreen && this.sharemyscreen && (this.logger.log("adding local screen stream to peer connection"), this.pc.addStream(this.parent.localScreen), this.broadcaster = e.broadcaster) : this.parent.localStreams.forEach(function (e) { t.pc.addStream(e) }), this.on("channelOpen", function (e) { e.protocol === c && (e.onmessage = function (n) { var r = JSON.parse(n.data), i = new s.Receiver; i.receive(r, e), t.emit("fileTransfer", r, i), i.on("receivedFile", function (e, t) { i.channel.close() }) }) }), this.on("*", function () { t.parent.emit.apply(t.parent, arguments) }) } r.inherits(d, a), d.prototype.handleMessage = function (e) { var t = this; if (this.logger.log("getting", e.type, e), e.prefix && (this.browserPrefix = e.prefix), "offer" === e.type) this.nick || (this.nick = e.payload.nick), delete e.payload.nick, this.pc.handleOffer(e.payload, function (e) { e || t.pc.answer(function (e, t) { }) }); else if ("answer" === e.type) this.nick || (this.nick = e.payload.nick), delete e.payload.nick, this.pc.handleAnswer(e.payload); else if ("candidate" === e.type) this.pc.processIce(e.payload); else if ("connectivityError" === e.type) this.parent.emit("connectivityError", t); else if ("mute" === e.type) this.parent.emit("mute", { id: e.from, name: e.payload.name }); else if ("unmute" === e.type) this.parent.emit("unmute", { id: e.from, name: e.payload.name }); else if ("endOfCandidates" === e.type) { (this.pc.pc.peerconnection.transceivers || []).forEach(function (e) { e.iceTransport && e.iceTransport.addRemoteCandidate({}) }) } }, d.prototype.send = function (e, t) { var n = { to: this.id, sid: this.sid, broadcaster: this.broadcaster, roomType: this.type, type: e, payload: t, prefix: i.prefix }; this.logger.log("sending", e, n), this.parent.emit("message", n) }, d.prototype.sendDirectly = function (e, t, n) { var r = { type: t, payload: n }; this.logger.log("sending via datachannel", e, t, r); var i = this.getDataChannel(e); return "open" == i.readyState && (i.send(JSON.stringify(r)), !0) }, d.prototype._observeDataChannel = function (e) { var t = this; e.onclose = this.emit.bind(this, "channelClose", e), e.onerror = this.emit.bind(this, "channelError", e), e.onmessage = function (n) { t.emit("channelMessage", t, e.label, JSON.parse(n.data), e, n) }, e.onopen = this.emit.bind(this, "channelOpen", e) }, d.prototype.getDataChannel = function (e, t) { if (!i.supportDataChannel) return this.emit("error", new Error("createDataChannel not supported")); var n = this.channels[e]; return t || (t = {}), n || (n = this.channels[e] = this.pc.createDataChannel(e, t), this._observeDataChannel(n), n) }, d.prototype.onIceCandidate = function (e) { if (!this.closed) if (e) { var t = this.parent.config.peerConnectionConfig; "moz" === i.prefix && t && t.iceTransports && e.candidate && e.candidate.candidate && e.candidate.candidate.indexOf(t.iceTransports) < 0 ? this.logger.log("Ignoring ice candidate not matching pcConfig iceTransports type: ", t.iceTransports) : this.send("candidate", e) } else this.logger.log("End of candidates.") }, d.prototype.start = function () { this.enableDataChannels && this.getDataChannel("simplewebrtc"), this.pc.offer(this.receiveMedia, function (e, t) { }) }, d.prototype.icerestart = function () { var e = this.receiveMedia; e.mandatory.IceRestart = !0, this.pc.offer(e, function (e, t) { }) }, d.prototype.end = function () { this.closed || (this.pc.close(), this.handleStreamRemoved()) }, d.prototype.handleRemoteStreamAdded = function (e) { var t = this; this.stream ? this.logger.warn("Already have a remote stream") : (this.stream = e.stream, this.stream.getTracks().forEach(function (e) { e.addEventListener("ended", function () { var e, n; e = t.stream, n = !0, e.getTracks().forEach(function (e) { n = "ended" === e.readyState && n }), n && t.end() }) }), this.parent.emit("peerStreamAdded", this)) }, d.prototype.handleStreamRemoved = function () { var e = this.parent.peers.indexOf(this); e > -1 && (this.parent.peers.splice(e, 1), this.closed = !0, this.parent.emit("peerStreamRemoved", this)) }, d.prototype.handleDataChannelAdded = function (e) { this.channels[e.label] = e, this._observeDataChannel(e) }, d.prototype.sendFile = function (e) { var t = new s.Sender, n = this.getDataChannel("filetransfer" + (new Date).getTime(), { protocol: c }); return n.onopen = function () { n.send(JSON.stringify({ size: e.size, name: e.name })), t.send(e, n) }, n.onclose = function () { console.log("sender received transfer"), t.emit("complete") }, t }, t.exports = d }, { filetransfer: 26, rtcpeerconnection: 56, util: 89, webrtcsupport: 99, wildemitter: 100 }], 103: [function (e, t, n) { var r = e("./webrtc"), i = e("wildemitter"), o = e("webrtcsupport"), a = e("attachmediastream"), s = e("mockconsole"), c = e("./socketioconnection"); function d(e) { var t, n, d = this, p = e || {}, u = this.config = { url: "https://sandbox.simplewebrtc.com:443/", socketio: {}, connection: null, debug: !1, localVideoEl: "", remoteVideosEl: "", enableDataChannels: !0, autoRequestMedia: !1, autoRemoveVideos: !0, adjustPeerVolume: !1, peerVolumeWhenSpeaking: .25, media: { video: !0, audio: !0 }, receiveMedia: { offerToReceiveAudio: 1, offerToReceiveVideo: 1 }, localVideo: { autoplay: !0, mirror: !0, muted: !0 } }; this.logger = e.debug ? e.logger || console : e.logger || s; for (t in p) p.hasOwnProperty(t) && (this.config[t] = p[t]); this.capabilities = o, i.call(this), (n = null === this.config.connection ? this.connection = new c(this.config) : this.connection = this.config.connection).on("connect", function () { d.emit("connectionReady", n.getSessionid()), d.sessionReady = !0, d.testReadiness() }), n.on("message", function (e) { var t, n = d.webrtc.getPeers(e.from, e.roomType); "offer" === e.type ? (n.length && n.forEach(function (n) { n.sid == e.sid && (t = n) }), t || (t = d.webrtc.createPeer({ id: e.from, sid: e.sid, type: e.roomType, enableDataChannels: d.config.enableDataChannels && "screen" !== e.roomType, sharemyscreen: "screen" === e.roomType && !e.broadcaster, broadcaster: "screen" !== e.roomType || e.broadcaster ? null : d.connection.getSessionid() }), d.emit("createdPeer", t)), t.handleMessage(e)) : n.length && n.forEach(function (t) { e.sid ? t.sid === e.sid && t.handleMessage(e) : t.handleMessage(e) }) }), n.on("remove", function (e) { e.id !== d.connection.getSessionid() && d.webrtc.removePeers(e.id, e.type) }), e.logger = this.logger, e.debug = !1, this.webrtc = new r(e), ["mute", "unmute", "pauseVideo", "resumeVideo", "pause", "resume", "sendToAll", "sendDirectlyToAll", "getPeers"].forEach(function (e) { d[e] = d.webrtc[e].bind(d.webrtc) }), this.webrtc.on("*", function () { d.emit.apply(d, arguments) }), u.debug && this.on("*", this.logger.log.bind(this.logger, "SimpleWebRTC event:")), this.webrtc.on("localStream", function () { d.testReadiness() }), this.webrtc.on("message", function (e) { d.connection.emit("message", e) }), this.webrtc.on("peerStreamAdded", this.handlePeerStreamAdded.bind(this)), this.webrtc.on("peerStreamRemoved", this.handlePeerStreamRemoved.bind(this)), this.config.adjustPeerVolume && (this.webrtc.on("speaking", this.setVolumeForAll.bind(this, this.config.peerVolumeWhenSpeaking)), this.webrtc.on("stoppedSpeaking", this.setVolumeForAll.bind(this, 1))), n.on("stunservers", function (e) { }), n.on("turnservers", function (e) { }), this.webrtc.on("iceFailed", function (e) { }), this.webrtc.on("connectivityError", function (e) { }), this.webrtc.on("audioOn", function () { d.webrtc.sendToAll("unmute", { name: "audio" }) }), this.webrtc.on("audioOff", function () { d.webrtc.sendToAll("mute", { name: "audio" }) }), this.webrtc.on("videoOn", function () { d.webrtc.sendToAll("unmute", { name: "video" }) }), this.webrtc.on("videoOff", function () { d.webrtc.sendToAll("mute", { name: "video" }) }), this.webrtc.on("localScreen", function (e) { var t = document.createElement("video"), n = d.getRemoteVideoContainer(); t.oncontextmenu = function () { return !1 }, t.id = "localScreen", a(e, t), n && n.appendChild(t), d.emit("localScreenAdded", t), d.connection.emit("shareScreen"), d.webrtc.peers.forEach(function (e) { var t; "video" === e.type && (t = d.webrtc.createPeer({ id: e.id, type: "screen", sharemyscreen: !0, enableDataChannels: !1, receiveMedia: { offerToReceiveAudio: 0, offerToReceiveVideo: 0 }, broadcaster: d.connection.getSessionid() }), d.emit("createdPeer", t), t.start()) }) }), this.webrtc.on("localScreenStopped", function (e) { d.getLocalScreen() && d.stopScreenShare() }), this.webrtc.on("channelMessage", function (e, t, n) { "volume" == n.type && d.emit("remoteVolumeChange", e, n.volume) }), this.config.autoRequestMedia && this.startLocalVideo() } d.prototype = Object.create(i.prototype, { constructor: { value: d } }), d.prototype.leaveRoom = function () { if (this.roomName) { for (this.connection.emit("leave"); this.webrtc.peers.length;)this.webrtc.peers[0].end(); this.getLocalScreen() && this.stopScreenShare(), this.emit("leftRoom", this.roomName), this.roomName = void 0 } }, d.prototype.disconnect = function () { this.connection.disconnect(), delete this.connection }, d.prototype.handlePeerStreamAdded = function (e) { var t = this, n = this.getRemoteVideoContainer(), r = a(e.stream); e.videoEl = r, r.id = this.getDomId(e), n && n.appendChild(r), this.emit("videoAdded", r, e), window.setTimeout(function () { t.webrtc.isAudioEnabled() || e.send("mute", { name: "audio" }), t.webrtc.isVideoEnabled() || e.send("mute", { name: "video" }) }, 250) }, d.prototype.handlePeerStreamRemoved = function (e) { var t = this.getRemoteVideoContainer(), n = e.videoEl; this.config.autoRemoveVideos && t && n && t.removeChild(n), n && this.emit("videoRemoved", n, e) }, d.prototype.getDomId = function (e) { return [e.id, e.type, e.broadcaster ? "broadcasting" : "incoming"].join("_") }, d.prototype.setVolumeForAll = function (e) { this.webrtc.peers.forEach(function (t) { t.videoEl && (t.videoEl.volume = e) }) }, d.prototype.joinRoom = function (e, t) { var n = this; this.roomName = e, this.connection.emit("join", e, function (r, i) { var o, a, s, c; if (r) n.emit("error", r); else for (o in i.clients) { a = i.clients[o]; for (s in a) a[s] && (c = n.webrtc.createPeer({ id: o, type: s, enableDataChannels: n.config.enableDataChannels && "screen" !== s, receiveMedia: { offerToReceiveAudio: "screen" !== s && n.config.receiveMedia.offerToReceiveAudio ? 1 : 0, offerToReceiveVideo: n.config.receiveMedia.offerToReceiveVideo } }), n.emit("createdPeer", c), c.start()) } t && t(r, i), n.emit("joinedRoom", e) }) }, d.prototype.getEl = function (e) { return "string" == typeof e ? document.getElementById(e) : e }, d.prototype.startLocalVideo = function () { var e = this; this.webrtc.startLocalMedia(this.config.media, function (t, n) { t ? e.emit("localMediaError", t) : a(n, e.getLocalVideoContainer(), e.config.localVideo) }) }, d.prototype.stopLocalVideo = function () { this.webrtc.stopLocalMedia() }, d.prototype.getLocalVideoContainer = function () { var e = this.getEl(this.config.localVideoEl); if (e && "VIDEO" === e.tagName) return e.oncontextmenu = function () { return !1 }, e; if (e) { var t = document.createElement("video"); return t.oncontextmenu = function () { return !1 }, e.appendChild(t), t } }, d.prototype.getRemoteVideoContainer = function () { return this.getEl(this.config.remoteVideosEl) }, d.prototype.shareScreen = function (e) { this.webrtc.startScreenShare(e) }, d.prototype.getLocalScreen = function () { return this.webrtc.localScreen }, d.prototype.stopScreenShare = function () { this.connection.emit("unshareScreen"); var e = document.getElementById("localScreen"), t = this.getRemoteVideoContainer(); this.config.autoRemoveVideos && t && e && t.removeChild(e), e && this.emit("videoRemoved", e), this.getLocalScreen() && this.webrtc.stopScreenShare(), this.webrtc.peers.forEach(function (e) { e.broadcaster && e.end() }) }, d.prototype.testReadiness = function () { this.sessionReady && (this.config.media.video || this.config.media.audio ? this.webrtc.localStreams.length > 0 && this.emit("readyToCall", this.connection.getSessionid()) : this.emit("readyToCall", this.connection.getSessionid())) }, d.prototype.createRoom = function (e, t) { this.roomName = e, 2 === arguments.length ? this.connection.emit("create", e, t) : this.connection.emit("create", e) }, d.prototype.sendFile = function () { if (!o.dataChannel) return this.emit("error", new Error("DataChannelNotSupported")) }, t.exports = d }, { "./socketioconnection": 104, "./webrtc": 105, attachmediastream: 3, mockconsole: 50, webrtcsupport: 99, wildemitter: 100 }], 104: [function (e, t, n) { var r = e("socket.io-client"); function i(e) { this.connection = r.connect(e.url, e.socketio) } i.prototype.on = function (e, t) { this.connection.on(e, t) }, i.prototype.emit = function () { this.connection.emit.apply(this.connection, arguments) }, i.prototype.getSessionid = function () { return this.connection.id }, i.prototype.disconnect = function () { return this.connection.disconnect() }, t.exports = i }, { "socket.io-client": 63 }], 105: [function (e, t, n) { var r = e("util"), i = e("webrtcsupport"), o = e("mockconsole"), a = e("localmedia"), s = e("./peer"); function c(e) { var t, n = this, r = e || {}; this.config = { debug: !1, peerConnectionConfig: { iceServers: [{ urls: ["stun:turn.goto-rtc.com:5060"], username: "citrixturnuser", credential: "turnpassword" }, { urls: ["turn:turn.goto-rtc.com:5060?transport=udp", "turn:turn.goto-rtc.com:443?transport=tcp", "turn:turn.goto-rtc.com:5060?transport=tcp"], username: "citrixturnuser", credential: "turnpassword" }] }, peerConnectionConstraints: { optional: [{ googIPv6: "true" }] }, receiveMedia: { offerToReceiveAudio: 1, offerToReceiveVideo: 1 }, enableDataChannels: !0 }; this.logger = e.debug ? e.logger || console : e.logger || o; for (t in r) r.hasOwnProperty(t) && (this.config[t] = r[t]); i.support || this.logger.error("Your browser doesn't seem to support WebRTC"), this.peers = [], a.call(this, this.config), this.on("speaking", function () { n.hardMuted || n.peers.forEach(function (e) { if (e.enableDataChannels) { var t = e.getDataChannel("hark"); if ("open" != t.readyState) return; t.send(JSON.stringify({ type: "speaking" })) } }) }), this.on("stoppedSpeaking", function () { n.hardMuted || n.peers.forEach(function (e) { if (e.enableDataChannels) { var t = e.getDataChannel("hark"); if ("open" != t.readyState) return; t.send(JSON.stringify({ type: "stoppedSpeaking" })) } }) }), this.on("volumeChange", function (e, t) { n.hardMuted || n.peers.forEach(function (t) { if (t.enableDataChannels) { var n = t.getDataChannel("hark"); if ("open" != n.readyState) return; n.send(JSON.stringify({ type: "volume", volume: e })) } }) }), this.config.debug && this.on("*", function (e, t, r) { (n.config.logger === o ? console : n.logger).log("event:", e, t, r) }) } r.inherits(c, a), c.prototype.createPeer = function (e) { var t; return e.parent = this, t = new s(e), this.peers.push(t), t }, c.prototype.removePeers = function (e, t) { this.getPeers(e, t).forEach(function (e) { e.end() }) }, c.prototype.getPeers = function (e, t) { return this.peers.filter(function (n) { return !(e && n.id !== e || t && n.type !== t) }) }, c.prototype.sendToAll = function (e, t) { this.peers.forEach(function (n) { n.send(e, t) }) }, c.prototype.sendDirectlyToAll = function (e, t, n) { this.peers.forEach(function (r) { r.enableDataChannels && r.sendDirectly(e, t, n) }) }, t.exports = c }, { "./peer": 102, localmedia: 46, mockconsole: 50, util: 89, webrtcsupport: 99 }] }, {}, [103])(103) });